/*!@license
* Infragistics.Web.ClientUI Combo localization resources 15.1.20151.1005
*
* Copyright (c) 2011-2015 Infragistics Inc.
*
* http://www.infragistics.com/
*
*/
(function($){$.ig=$.ig||{};if(!$.ig.Combo){$.ig.Combo={locale:{noMatchFoundText:"No Results",dropDownButtonTitle:"Show drop-down",clearButtonTitle:"Clear value",placeHolder:"select...",notSuported:"Operation not supported",errorNoSupportedTextsType:"No Supported Texts Type. Supported Filtering Texts are String and Array.",errorUnrecognizedHighlightMatchesMode:"Unrecognized Highlight Matches Mode. Supported values are multi, contains, startsWith, full and null."}}}})(jQuery);/*!@license
* Infragistics.Web.ClientUI Combo 15.1.20151.1005
*
* Copyright (c) 2011-2015 Infragistics Inc.
* 
* http://www.infragistics.com/
* 
* Depends on:
* jquery-1.8.3.js
* jquery.ui.core.js
* jquery.ui.widget.js
* infragistics.templating.js
* infragistics.util.js
* infragistics.dataSource.js
*
* Example to use:
*   <script type="text/javascript">
*   $(function () {
*       $('#combo').igCombo();
*   });
*   </script>
*   <input id="combo" />
*/
(function($){$.widget("ui.igCombo",{options:{width:null,height:null,dropDownWidth:null,dataSource:null,dataSourceType:null,dataSourceUrl:null,responseTotalRecCountKey:null,responseDataKey:null,responseDataType:null,responseContentType:null,requestType:"GET",valueKey:null,textKey:null,itemTemplate:null,inputName:null,animationShowDuration:100,animationHideDuration:100,dropDownAttachedToBody:true,filteringType:"local",filterExprUrlKey:null,filteringCondition:"contains",filteringLogic:"OR",noMatchFoundText:null,loadOnDemandSettings:{enabled:false,pageSize:16},visibleItemsCount:15,placeHolder:null,mode:"editable",virtualization:false,multiSelection:{enabled:false,addWithKeyModifier:false,showCheckboxes:false,itemSeparator:", "},validatorOptions:null,highlightMatchesMode:"multi",caseSensitive:false,autoSelectFirstMatch:true,closeDropDownOnBlur:true,delayFilteringOnKeyUp:250,tabIndex:null,dropDownOnFocus:false,closeDropDownOnSelect:true,selectItemBySpaceKey:false,initialSelectedItems:[{index:-1,value:null}],preventSubmitOnEnter:true,format:"auto",enableClearButton:true,dropDownButtonTitle:null,clearButtonTitle:null},events:{rendered:"rendered",dataBinding:"dataBinding",dataBound:"dataBound",filtering:"filtering",filtered:"filtered",itemsRendering:"itemsRendering",itemsRendered:"itemsRendered",dropDownOpening:"dropDownOpening",dropDownOpened:"dropDownOpened",dropDownClosing:"dropDownClosing",dropDownClosed:"dropDownClosed",selectionChanging:"selectionChanging",selectionChanged:"selectionChanged"},css:{comboWrapper:"ui-igcombo-wrapper",combo:"ui-igcombo ui-widget ui-state-default ui-corner-all ui-unselectable",dropDownMode:"ui-igcombo-mode-dropdown",readOnlyMode:"ui-igcombo-mode-readonly",readOnlyListMode:"ui-igcombo-mode-readonlylist",textBox:"ui-igcombo-textbox ui-state-default ui-corner-all",field:"ui-igcombo-field ui-corner-all",fieldHolder:"ui-igcombo-fieldholder",fieldHolderLTR:"ui-igcombo-fieldholder-ltr ui-corner-left",fieldHolderRTL:"ui-igcombo-fieldholder-rtl ui-corner-right",button:"ui-igcombo-button ui-state-default ui-unselectable",buttonIcon:"ui-igcombo-buttonicon ui-icon-triangle-1-s ui-icon",buttonLTR:"ui-igcombo-button-ltr ui-corner-right",buttonRTL:"ui-igcombo-button-rtl ui-corner-left",clear:"ui-igcombo-clear ui-unselectable",clearHover:"ui-igcombo-clear-hover ui-state-hover",clearIcon:"ui-igcombo-clearicon ui-icon-circle-close ui-icon",list:"ui-igcombo-list ui-widget ui-widget-content ui-corner-all",dropDownOverflow:"ui-igcombo-dropdown-overflow",listItemHolder:"ui-igcombo-listitemholder",listItem:"ui-igcombo-listitem ui-state-default ui-unselectable",itemInFocus:"ui-igcombo-item-in-focus",listItemHighlighted:"ui-igcombo-highlight",noMatchFound:"ui-igcombo-nomatchfound",listItemTextWithCheckbox:"ui-igcombo-listitemtextwithcheckbox",checkbox:"ui-igcombo-checkbox ui-state-default ui-corner-all ui-igcheckbox-small",checkboxOff:"ui-icon ui-igcombo-checkbox-off ui-igcheckbox-small-off",checkboxOn:"ui-icon ui-icon-check ui-igcombo-checkbox-on ui-igcheckbox-small-on",hiddenField:"ui-igcombo-hidden-field",hover:"ui-state-hover",active:"ui-state-active",focus:"ui-state-focus",unselectable:"ui-unselectable",noTopCorners:"ui-igcombo-no-top-corners",noBottomCorners:"ui-igcombo-no-bottom-corners",noBorder:"ui-igcombo-no-border",scrollHolder:"ui-igcombo-scrollholder ui-unselectable",scroll:"ui-igcombo-scroll ui-unselectable",loading:"ui-igcombo-loading",hidden:"ui-helper-hidden",disabled:"ui-state-disabled"},_createWidget:function(options){var mode;if(options){mode=options.mode;if(options.multiSelection&&options.multiSelection.enabled&&options.closeDropDownOnSelect===undefined){options.closeDropDownOnSelect=false}if(mode==="readonly"||mode==="readonlylist"||mode==="dropdown"&&!(options.multiSelection&&options.multiSelection.enabled)&&options.enableClearButton===undefined){options.enableClearButton=false}}$.Widget.prototype._createWidget.apply(this,arguments)},_create:function(){this._options={$comboWrapper:null,$combo:null,$input:null,$hiddenInput:null,$fieldCont:null,$clearCont:null,$clearIcon:null,$dropDownBtnCont:null,$dropDownBtnIcon:null,$dropDownCont:null,$dropDownScrollCont:null,$dropDownScroll:null,$dropDownList:null,$loading:null,$noMatchFound:null,$initialShiftDownItem:$(),$itemsToSelectOnShiftUpDown:$(),$itemsToSelectOnShiftClick:$(),selectedValues:[],keyNavItemValue:null,autoSelectedItemValue:null,inputVal:"",highlightElement:"span",ltr:true,listAboveCombo:false,dropDownOpened:false,deltaItemsForLoadOnDemand:5,loadingBegan:false,shiftKeyCode:16,validator:null,disableScroll:false,shiftDown:false,nameAttribute:"",internalSelChangeSubs:null,initialDataBinding:true,remoteFilteringTriggerEvt:null,preventInputBlur:false,mouseDownStartedFromListItem:false,cachedRecords:[],strDataSource:null,updateInputValuesOnRemoteFilter:false,expression:null};this._handlers={windowResize:$.proxy(this._windowResize,this),documentMouseUp:$.proxy(this._documentMouseUp,this),inputFocus:$.proxy(this._inputFocus,this),inputBlur:$.proxy(this._inputBlur,this),inputClick:$.proxy(this._inputClick,this),inputKeyDown:$.proxy(this._inputKeyDown,this),inputPaste:$.proxy(this._inputPaste,this),inputKeyUp:$.proxy(this._inputKeyUp,this),inputMouseDown:$.proxy(this._inputMouseDown,this)};this._analyzeOptions();this._analyzeInitialElem();this._render();this.validator();this._attachEvents();this.dataBind()},_analyzeOptions:function(){var key,options=this.options,lod=options.loadOnDemandSettings,firstDataItem=this.options.dataSource&&this.options.dataSource[0];if(options.mode!=="editable"&&options.mode!=="dropdown"&&options.mode!=="readonly"&&options.mode!=="readonlylist"){options.mode="editable"}options.inputName=this.element.attr("name")||options.inputName||this.element.attr("id");if(lod&&lod.enabled&&lod.pageSize&&options.loadOnDemandSettings.pageSize<5){lod.pageSize=5}else if(lod&&lod.enabled&&!lod.pageSize){lod.pageSize=this.options.visibleItemsCount+1}if(!options.textKey){if(options.valueKey){options.textKey=options.valueKey}else if(firstDataItem&&$.type(firstDataItem)==="object"){for(key in firstDataItem){if(firstDataItem.hasOwnProperty(key)){options.textKey=key;break}}}}if(!options.valueKey){options.valueKey=options.textKey}if(!options.textKey&&!options.valueKey){options.textKey="text";options.valueKey="value"}if(options.filteringType!=="local"&&options.filteringType!=="remote"&&options.filteringType!=="none"){options.filteringType="none"}this.options.noMatchFoundText=this.options.noMatchFoundText||$.ig.Combo&&$.ig.Combo.locale&&$.ig.Combo.locale.noMatchFoundText||"No Results";this.options.placeHolder=this.options.placeHolder||$.ig.Combo&&$.ig.Combo.locale&&$.ig.Combo.locale.placeHolder||"select..";this.options.clearButtonTitle=this.options.clearButtonTitle||$.ig.Combo&&$.ig.Combo.locale&&$.ig.Combo.locale.clearButtonTitle||"Clear value";this.options.dropDownButtonTitle=this.options.dropDownButtonTitle||$.ig.Combo&&$.ig.Combo.locale&&$.ig.Combo.locale.dropDownButtonTitle||"Show drop-down"},_analyzeInitialElem:function(){var element=this.element,_options=this._options;if(element.is("div")||element.is("span")){_options.$comboWrapper=element}else if(element.is("input")){_options.$input=element;_options.nameAttribute=element.attr("name");element.removeAttr("name")}else if(element.is("select")){element.hide();_options.nameAttribute=element.attr("name");element.removeAttr("name")}else{}},_setupInput:function(){var _options=this._options;_options.$input.attr("placeholder",this.options.placeHolder);if(this.options.mode!=="editable"){_options.$input.attr({readonly:true,unselectable:"on"}).addClass(this.css.unselectable)}},_setInputVal:function(val){this._options.inputVal=val},_render:function(){var css=this.css,options=this.options,_options=this._options,$comboWrapper=(_options.$comboWrapper||$("<div>")).addClass(css.comboWrapper),$combo=$("<div>").addClass(css.combo).attr("unselectable","on"),$input=(_options.$input||$('<input type="text">')).addClass(css.field).attr({tabIndex:options.tabIndex,autocomplete:"off"}),$hiddenInput=$('<input type="hidden">').addClass(css.hiddenField),$fieldCont=$("<div>").addClass(css.fieldHolder),$clearCont=$("<div>").addClass(css.clear).attr({unselectable:"on",title:options.clearButtonTitle}),$clearIcon=$("<div>").addClass(css.clearIcon),$dropDownBtnCont=$("<div>").addClass(css.button).attr({unselectable:"on",title:options.dropDownButtonTitle}),$dropDownBtnIcon=$("<div>").addClass(css.buttonIcon),$dropDownCont=$("<div>").addClass(css.list).width(options.dropDownWidth),$dropDownList=$("<ul>").addClass(css.listItemHolder),$dropDownScrollCont=$("<div>").addClass(css.scrollHolder).attr("unselectable","on"),$dropDownScroll=$("<div>").addClass(css.scroll).attr("unselectable","on"),$loading=$("<div>").addClass(css.loading);switch(options.mode){case"dropdown":$combo.addClass(css.dropDownMode);break;case"readonlylist":$combo.addClass(css.readOnlyListMode);break;case"readonly":$combo.addClass(css.readOnlyMode);$comboWrapper.addClass(css.disabled);break}if(_options.ltr){$fieldCont.addClass(css.fieldHolderLTR);$dropDownBtnCont.addClass(css.buttonLTR)}else{$fieldCont.addClass(css.fieldHolderRTL);$dropDownBtnCont.addClass(css.buttonRTL)}if(_options.listAboveCombo){$dropDownCont.addClass(css.noBottomCorners)}else{$dropDownCont.addClass(css.noTopCorners)}$clearIcon.appendTo($clearCont);$dropDownBtnIcon.appendTo($dropDownBtnCont);$dropDownList.appendTo($dropDownCont);if(options.virtualization){if($.ig.util.isIE||$.ig.util.isFF){$dropDownScrollCont.width($.ig.util.getScrollWidth()+1)}$dropDownCont.addClass(css.dropDownOverflow);$dropDownScrollCont.insertBefore($dropDownList);$dropDownScroll.appendTo($dropDownScrollCont)}if(this.element.is("input")){$input.wrap($fieldCont);$fieldCont=$input.parent();$fieldCont.wrap($combo);$combo=$fieldCont.parent();$combo.wrap($comboWrapper);$comboWrapper=$combo.parent();$clearCont.prependTo($combo);$dropDownBtnCont.prependTo($combo)}else{$input.appendTo($fieldCont);$dropDownBtnCont.appendTo($combo);$clearCont.appendTo($combo);$fieldCont.appendTo($combo);$combo.appendTo($comboWrapper)}$clearCont.hide();if(!options.enableClearButton){$clearCont.remove()}$hiddenInput.attr("name",options.inputName).appendTo($combo);$dropDownCont.height(0).addClass(css.noBorder);if(options.dropDownAttachedToBody){$dropDownCont.appendTo($("body"))}else{$dropDownCont.appendTo($comboWrapper)}if(this.element.is("select")){$comboWrapper.insertBefore(this.element)}$comboWrapper.outerWidth(options.width);$comboWrapper.outerHeight(options.height);_options.$comboWrapper=$comboWrapper;_options.$combo=$combo;_options.$input=$input;_options.$hiddenInput=$hiddenInput;_options.$fieldCont=$fieldCont;_options.$clearCont=$clearCont;_options.$clearIcon=$clearIcon;_options.$dropDownBtnCont=$dropDownBtnCont;_options.$dropDownBtnIcon=$dropDownBtnIcon;_options.$dropDownCont=$dropDownCont;_options.$dropDownList=$dropDownList;_options.$loading=$loading;if(options.dropDownAttachedToBody){this._resizeDropDown()}this._setInputVal($input.val());if(options.virtualization){_options.$dropDownScrollCont=$dropDownScrollCont;_options.$dropDownScroll=$dropDownScroll}this._setupInput();this._triggerRendered()},_resizeDropDown:function(){var $combo=this._options.$combo,comboOffset=$combo.offset(),width=this.options.dropDownWidth||$combo.outerWidth();this._options.$dropDownCont.outerWidth(width).css({left:comboOffset.left,top:comboOffset.top+$combo.outerHeight()})},_itemInnerMarkup:function(data){var unwrappedData,dataItem,unwrappedDataItem;unwrappedData=this._unwrapData(data);dataItem=unwrappedData[this.options.textKey];unwrappedDataItem=this._unwrapData(dataItem);unwrappedDataItem=this._formatItem(unwrappedDataItem);return this.options.itemTemplate?$.ig.tmpl(this.options.itemTemplate,data):unwrappedDataItem},_formatItem:function(item){if($.ig&&$.ig.formatter){if(this.options.format==="auto"&&($.type(item)==="date"||$.type(item)==="number")){item=$.ig.formatter(item,null,null)}else if(this._formatEnabled()){item=$.ig.formatter(item,null,this.options.format)}}return item},_formatEnabled:function(){return!(this.options.format===""||this.options.format===null||this.options.format==="none")},_itemMarkup:function(data){var css=this.css,markup='<li class="'+css.listItem+'" unselectable="on">',innerMarkup=this._itemInnerMarkup(data);if(this._checkBoxesEnabled()){markup+='<span class="'+css.checkbox+'">'+'<span class="'+css.checkboxOff+'"></span>'+"</span>"+'<div class="'+css.listItemTextWithCheckbox+'">'+innerMarkup+"</div>"}else{markup+=innerMarkup}markup+="</li>";return markup},_renderItems:function(success,msg,data){var $items,unwrappedDataViewItem,unwrappedDataViewValue,noCancel,i,options=this.options,_options=this._options,dataView=data.dataView(),len=this._isPossibleToVirtualize()?options.visibleItemsCount:dataView.length,itemsMarkup="";if(success!==null){this._triggerDataBound(success,msg)}noCancel=this._triggerItemsRendering();if(noCancel){if(len>0){for(i=0;i<len;i++){itemsMarkup+=this._itemMarkup(dataView[i])}}else{itemsMarkup+='<li unselectable="on" class="'+this.css.noMatchFound+'">'+options.noMatchFoundText+"</li>"}_options.$dropDownList.html(itemsMarkup);$items=this._$items();for(i=0;i<len;i++){unwrappedDataViewItem=this._unwrapData(dataView[i]);unwrappedDataViewValue=this._unwrapData(unwrappedDataViewItem[this.options.valueKey]);$items.eq(i).data("value",unwrappedDataViewValue)}if(len>0){this._setDropDownMaxHeight()}if(options.virtualization){_options.$dropDownScroll.height(data.totalLocalRecordsCount()*this._calculateDropDownItemHeight())}if(_options.initialDataBinding){this._handleInitialSelection();_options.initialDataBinding=false}this._triggerItemsRendered()}},_handleRemoteFiltering:function(success,msg,data){var $items,selectedValues,_options=this._options,event=_options.remoteFilteringTriggerEvt;this._renderItems(success,msg,data);$items=this._$items();selectedValues=_options.selectedValues;_options.selectedValues=[];this.value(selectedValues,{focusCombo:true,keepFiltering:true,keepInputText:true,keepNavItem:true});this._updateSelection(event);this._updateHighlighting();if(this.options.virtualization){this._updateVirtualScrollVisibility()}if(this.options.multiSelection.enabled){this._setKeyNavigationItem(this._options.keyNavItemValue,true,false,true)}if(_options.updateInputValuesOnRemoteFilter){this._updateInputValues();_options.updateInputValuesOnRemoteFilter=false}if(_options.inputVal){_options.$clearCont.show()}else{_options.$clearCont.hide()}if(_options.validator){_options.validator._evt(event)}if(event){this._triggerFiltered(event);_options.remoteFilteringTriggerEvt=null}},_handleLocalFilteringWithVirt:function(data){var $items,selectedValues,_options=this._options;this._renderItems(null,null,data);$items=this._$items();selectedValues=_options.selectedValues;_options.selectedValues=[];this.value(selectedValues,{focusCombo:true,keepFiltering:true,keepInputText:true});this._updateHighlighting()},_handleLoadOnDemand:function(err,success,data){var $items,selectedValues,_options=this._options;this._renderItems(err,success,data);$items=this._$items();selectedValues=_options.selectedValues;_options.selectedValues=[];this.value(selectedValues,{focusCombo:true,keepFiltering:true,keepInputText:true});this._updateHighlighting();if(this.options.multiSelection.enabled){this._setKeyNavigationItem(this._options.keyNavItemValue,true,false,true)}if(this.options.filteringType!=="remote"&&_options.expression){this._updateFiltering()}},_updateItem:function($item,data){var innerMarkup=this._itemInnerMarkup(data),unwrappedDataItem,unwrappedDataValue;if(this._checkBoxesEnabled()){$item.find("."+this.css.listItemTextWithCheckbox).html(innerMarkup)}else{$item.html(innerMarkup)}unwrappedDataItem=this._unwrapData(data);unwrappedDataValue=this._unwrapData(unwrappedDataItem[this.options.valueKey]);$item.data("value",unwrappedDataValue);return this},_$items:function(){return this._options.$dropDownList.find("."+this.css.listItem.split(" ",1)[0])},_$elementFromValue:function(value){var curItem,i,j,$items=this._$items(),itemsLen=$items.length,matchFound=false,result=$();if($.type(value)!=="array"){value=[value]}for(i=0;i<value.length;i++){for(j=0;j<itemsLen&&!matchFound;j++){curItem=$items.eq(j);if(curItem.data("value")===value[i]){result=result.add(curItem);matchFound=true}}}return result},_$elementsFromItems:function(items){var i,result=$();if($.type(items)!=="array"){items=[items]}for(i=0;i<items.length;i++){result=result.add(items[i].element)}return result},_$selectedItems:function(){var i,selItems=this.selectedItems(),$selItems=$(),len=selItems.length;for(i=0;i<len;i++){$selItems=$selItems.add(selItems[i].element)}return $selItems},_filterValues:function(values1,values2){return values1.filter(function(value){return $.inArray(value,values2)===-1})},_filterItems:function(items1,items2){var result,valKey=this.options.valueKey,self=this;result=items1.filter(function(item){var i,unwrappedDataItem,unwrappedDataValue,unwrappedDataItemToCompare,unwrappedDataValueToCompare,matchFound=false;unwrappedDataItem=self._unwrapData(item.data);unwrappedDataValue=self._unwrapData(unwrappedDataItem[valKey]);for(i=0;i<items2.length&&!matchFound;i++){unwrappedDataItemToCompare=self._unwrapData(items2[i].data);unwrappedDataValueToCompare=self._unwrapData(unwrappedDataItemToCompare[valKey]);if(unwrappedDataValue===unwrappedDataValueToCompare){matchFound=true}}return!matchFound});return result},_valuesFromData:function(data){var unwrappedDataItem,unwrappedDataValue,i,len=data.length,valKey=this.options.valueKey,values=[];for(i=0;i<len;i++){unwrappedDataItem=this._unwrapData(data[i]);unwrappedDataValue=this._unwrapData(unwrappedDataItem[valKey]);values.push(unwrappedDataValue)}return values},_dataFromItems:function(items){var len,i,data=[];for(i=0,len=items.length;i<len;i++){data.push(items[i].data)}return data},_valuesFromElements:function($items){var i,values=[];for(i=0;i<$items.length;i++){values.push($items.eq(i).data("value"))}return values},_valuesFromItems:function(item){var i,unwrappedDataItem,unwrappedDataValue,values=[],valueKey=this.options.valueKey;if(!item){return}if($.type(item)!=="array"){item=[item]}for(i=0;i<item.length;i++){unwrappedDataItem=this._unwrapData(item[i].data);unwrappedDataValue=this._unwrapData(unwrappedDataItem[valueKey]);values.push(unwrappedDataValue)}return values},_dataIndexByValue:function(value){var result,i,data=this.options.dataSource.data(),len=data.length,valKey=this.options.valueKey,matchFound=false,unwrappedDataItem,unwrappedDataValue;for(i=0;i<len&&!matchFound;i++){unwrappedDataItem=this._unwrapData(data[i]);unwrappedDataValue=this._unwrapData(unwrappedDataItem[valKey]);if(unwrappedDataValue===value){result=i;matchFound=true}}return result},_$keyNavItem:function(){return this._$elementFromValue(this._options.keyNavItemValue)},_moveCarretToInputEnd:function(){var range,input=this._options.$input[0];if($.ig.util.isWebKit&&this._options.$input.is(":focus")){this._options.preventInputBlur=true;input.blur()}input.focus();if(typeof input.selectionStart==="number"&&!$.ig.util.isIE){input.selectionStart=input.selectionEnd=input.value.length}else if(typeof input.createTextRange!=="undefined"){range=input.createTextRange();range.collapse(false);range.select()}},_refreshVisualStylesForItem:function($item,value){if(this.isValueSelected(value)){this._addItemSelectionStyles($item)}else{this._removeItemSelectionStyles($item)}if(this.options.multiSelection.enabled){if(this._options.keyNavItemValue===value){$item.addClass(this.css.itemInFocus)}else{$item.removeClass(this.css.itemInFocus)}}},_handleInitialSelection:function(){var curSelItem,selectOptions,selectedOptions,curIndex,i,unwrappedDataItem,unwrappedDataValue,selItems=this.options.initialSelectedItems,data=this.options.dataSource.data(),valueKey=this.options.valueKey,valuesToSel=[],mode=this.options.mode;if($.type(selItems)==="array"){for(i=0;i<selItems.length;i++){curSelItem=selItems[i];curIndex=curSelItem.index;if(curIndex>=0&&data.length>=curIndex){unwrappedDataItem=this._unwrapData(data[curIndex]);unwrappedDataValue=this._unwrapData(unwrappedDataItem[valueKey]);valuesToSel.push(unwrappedDataValue)}else if(curSelItem.value!==undefined&&curSelItem.value!==null){valuesToSel.push(curSelItem.value)}}}if(this.element.is("select")){selectOptions=this.element.find("option");selectedOptions=selectOptions.filter(":selected");for(i=0;i<selectedOptions.length;i++){unwrappedDataItem=this._unwrapData(data[selectOptions.index(selectedOptions.eq(i))]);unwrappedDataValue=this._unwrapData(unwrappedDataItem[valueKey]);valuesToSel.push(unwrappedDataValue)}}if((mode==="dropdown"&&!this.options.multiSelection.enabled||mode==="readonly"||mode==="readonlylist")&&valuesToSel.length===0){unwrappedDataItem=this._unwrapData(data[0]);if(unwrappedDataItem){unwrappedDataValue=this._unwrapData(unwrappedDataItem[valueKey]);valuesToSel.push(unwrappedDataValue)}}if(valuesToSel.length>0){this.value(valuesToSel,{additive:true})}},_checkBoxesEnabled:function(){return this.options.multiSelection.enabled&&this.options.multiSelection.showCheckboxes},_isPossibleToVirtualize:function(){return this.options.virtualization&&this.options.dataSource.dataView().length>this.options.visibleItemsCount},_areItemsLowerInVir:function(){return this.options.virtualization&&this.options.dataSource.dataView().length<=this.options.visibleItemsCount},_areItemsLower:function(){return this.options.dataSource.dataView().length<this.options.visibleItemsCount},_calculateDropDownHeight:function(itemHeight,allItemsCount){return itemHeight*allItemsCount},_calculateDropDownItemHeight:function(){return this._$items().first().outerHeight()},_isEnabledFiltering:function(){return this.options.filteringType!=="none"},_updateItems:function(offset){var self=this,options=this.options,_options=this._options,dataView=options.dataSource.dataView(),$items=this._$items();offset=offset||0;this._unhighlight();$items.each(function(i){var $this=$items.eq(i),realOffset=i+offset,curData=dataView[realOffset];if(curData){self._updateItem($this,curData)._refreshVisualStylesForItem($this,curData[options.valueKey])}});if(_options.inputVal){this._highlight(_options.inputVal)}},_toggleDropDownState:function(event){if(this._options.dropDownOpened){this.closeDropDown(null,event)}else{this.openDropDown(null,true,event)}},_lastValAfterItemSep:function(){return this._options.inputVal.split(this.options.multiSelection.itemSeparator).pop()},_startsWith:function(text,fragment){return fragment!==""&&text.indexOf(fragment)===0},_endsPartialyWithItemSep:function(text){var separator=this.options.multiSelection.itemSeparator,i=separator.length,matchFound=0;for(;i>0&&!matchFound;i--){if(text.endsWith(separator.slice(0,i))){matchFound=i}}return matchFound},_filterItemSeparator:function(text){return text.slice(0,text.length-this._endsPartialyWithItemSep(text))},_separatedInputValues:function(){var result=this._options.inputVal.split(this.options.multiSelection.itemSeparator);result[result.length-1]=this._filterItemSeparator(result[result.length-1]);return result},_updateSelection:function(event){var valLen,dataLen,curVal,curData,curDataValue,curText,matchFound,isLastValue,unwrappedData,i,j,options=this.options,_options=this._options,val=_options.inputVal,data=options.dataSource.data(),textKey=options.textKey,valueKey=options.valueKey,justSelectedValues=[],multiSelect=options.multiSelection.enabled;if(options.filteringType==="remote"){data=_options.cachedRecords.concat(data)}dataLen=data.length;if(multiSelect){val=this._separatedInputValues(val)}else{val=[val]}if(options.autoSelectFirstMatch){_options.autoSelectedItemValue=null}unwrappedData=this._unwrapData(data);for(i=0,valLen=val.length;i<valLen;i++){curVal=val[i];matchFound=false;isLastValue=i===valLen-1;if(!options.caseSensitive){curVal=curVal.toLowerCase()}for(j=0;j<dataLen&&!matchFound;j++){curData=this._unwrapData(unwrappedData[j]);curText=this._unwrapData(curData[textKey]).toString();curDataValue=this._unwrapData(curData[valueKey]);if(!options.caseSensitive){curText=curText.toLowerCase()}if(options.autoSelectFirstMatch){if(this._startsWith(curText,curVal)){if(multiSelect){if($.inArray(curDataValue,justSelectedValues)===-1){if(isLastValue){this._setKeyNavigationItem(curDataValue,true,true,true)}else{this.value(curDataValue,{additive:true,focusCombo:true,keepInputText:true,keepHighlighting:true,keepFiltering:true},event)}matchFound=true}if(!isLastValue){justSelectedValues.push(curDataValue)}}else{this.value(curDataValue,{focusCombo:true,keepInputText:true,keepHighlighting:true,keepFiltering:true},event);_options.autoSelectedItemValue=curDataValue;matchFound=true;justSelectedValues.push(curDataValue)}}}else if(curText===curVal){if(multiSelect){if($.inArray(curDataValue,justSelectedValues)===-1){if(isLastValue){this._setKeyNavigationItem(curDataValue,true,true,true)}else{this.value(curDataValue,{additive:true,focusCombo:true,keepInputText:true,keepHighlighting:true,keepFiltering:true},event)}matchFound=true}if(!isLastValue){justSelectedValues.push(curDataValue)}}else{this.value(curDataValue,{additive:true,focusCombo:true,keepInputText:true,keepHighlighting:true,keepFiltering:true},event);matchFound=true;justSelectedValues.push(curDataValue)}}}}this.deselectByValue(this._filterValues(_options.selectedValues,justSelectedValues),{focusCombo:true,keepInputText:true},event);if(multiSelect&&_options.inputVal.endsWith(options.multiSelection.itemSeparator)){this._updateInputValues(false)}},_positionItemInVisibleArea:function($item){var $dropDown=this._options.$dropDownCont,dropDownHeight=this._options.$dropDownCont.height(),dropDownTop=$dropDown.offset().top,itemTop=$item.offset().top,itemHeight=$item.outerHeight(true),dropDownScrollTop=this.listScrollTop();if(dropDownTop>itemTop){this.listScrollTop(this._$items().filter(":visible").index($item)*itemHeight)}if(itemTop+itemHeight>dropDownHeight+dropDownTop){this.listScrollTop(itemTop+itemHeight+dropDownScrollTop-dropDownHeight-dropDownTop)}},_setKeyNavigationItem:function(value,addStyles,clearPrevItem,clearInitialShiftItem){var $item,$prevKeyNavItem;if(value instanceof $){$item=value;value=$item.data("value")}else{$item=this._$elementFromValue(value)}clearInitialShiftItem=clearInitialShiftItem&&!this._options.shiftDown;if(clearPrevItem){$prevKeyNavItem=this._$elementFromValue(this._options.keyNavItemValue);if($prevKeyNavItem.length>0){$prevKeyNavItem.removeClass(this.css.itemInFocus)}}if(addStyles&&$item.length>0){$item.addClass(this.css.itemInFocus)}if(clearInitialShiftItem&&this._options.$initialShiftDownItem.length>0){this._options.$initialShiftDownItem=$()}this._options.keyNavItemValue=value},_navigateToItem:function($item,addStyles,clearPrevItem,event){if($item.length===0){return}if(!this.options.multiSelection.enabled){this.select($item,{focusCombo:true,keepFiltering:true},event)}else{this._setKeyNavigationItem($item,addStyles,clearPrevItem,true)}this._positionItemInVisibleArea($item)},_prevVisibleItem:function($item){do{$item=$item.prev()}while(!$item.is(":visible")&&$item.length>0);return $item},_nextVisibleItem:function($item){do{$item=$item.next()}while(!$item.is(":visible")&&$item.length>0);return $item},_visibleItemByIndex:function(index){return this._$items().filter(":visible").eq(index)},_handleInputChange:function(openDropDown,event){var delay,self=this,options=this.options,_options=this._options,curVal=_options.$input.val();if(curVal!==_options.inputVal){this._setInputVal(curVal);if(options.filteringType==="local"){clearTimeout($.data(this,"timer"));_options.disableScroll=true}else if(options.filteringType==="remote"){clearTimeout($.data(this,"timer"))}if(options.filteringType==="remote"){delay=event&&event.keyCode===$.ui.keyCode.ENTER?0:options.delayFilteringOnKeyUp;_options.$input.data("timer",setTimeout(function(){self._updateFiltering(event)},delay))}else{if(options.filteringType==="local"){this._updateFiltering(event);_options.$input.data("timer",setTimeout(function(){_options.disableScroll=false},options.delayFilteringOnKeyUp))}if(curVal){_options.$clearCont.show()}else{_options.$clearCont.hide()}this._updateHighlighting();this._updateSelection(event);if(_options.validator){_options.validator._evt(event)}}if(openDropDown){this.openDropDown(null,false,event)}}},_handleShiftNavigation:function($itemToNavigate,event){var _options=this._options,$keyNavItem=this._$keyNavItem();if($itemToNavigate.is(_options.$itemsToSelectOnShiftUpDown)){$keyNavItem.removeClass(this.css.itemInFocus);_options.$itemsToSelectOnShiftUpDown=_options.$itemsToSelectOnShiftUpDown.not($keyNavItem)}else{$itemToNavigate.addClass(this.css.itemInFocus);_options.$itemsToSelectOnShiftUpDown=_options.$itemsToSelectOnShiftUpDown.add($itemToNavigate)}this._navigateToItem($itemToNavigate,false,false,event)},_handleShiftUp:function(event){var _options=this._options;if(_options.$itemsToSelectOnShiftUpDown.length>1){this.select(_options.$itemsToSelectOnShiftUpDown,{additive:true,focusCombo:true,keepNavItem:true,keepFiltering:true},event);_options.$itemsToSelectOnShiftUpDown.removeClass(this.css.itemInFocus)}_options.$itemsToSelectOnShiftUpDown=$();_options.shiftDown=false},_handleShiftClick:function(event){var _options=this._options;if(_options.$itemsToSelectOnShiftClick.length>1){this.select(_options.$itemsToSelectOnShiftClick,{additive:true,focusCombo:true,keepNavItem:true,keepFiltering:true},event);_options.$itemsToSelectOnShiftClick.removeClass(this.css.itemInFocus);this._setKeyNavigationItem($(event.target),false,true,false)}_options.$itemsToSelectOnShiftClick=$()},_handleKeyNavigation:function(event){var $item,index,multiSelect,closeDropDown,isAutoSelectedActive,$lastSelectedItem,options=this.options,_options=this._options,multiSelection=options.multiSelection.enabled,$keyNavItem=this._$keyNavItem(),$visibleItems=this._$items().filter(":visible"),currentScrollTop=this.listScrollTop(),activeIndex=this.activeIndex(),itemHeight=this._calculateDropDownItemHeight();if(event.keyCode===$.ui.keyCode.ESCAPE){if(options.multiSelection.enabled){if(this._lastValAfterItemSep().length===0){this.closeDropDown(null,event)}else{this._updateInputValues();this.clearFiltering(event);this._unhighlight()}}else{if(_options.inputVal.length===0){this.closeDropDown(null,event)}else if(_options.selectedValues.length===0){this._updateInputValues();this.clearFiltering(event);this._unhighlight()}else if(_options.autoSelectedItemValue){this.deselectByValue(_options.autoSelectedItemValue,null,event);this.clearFiltering(event);this._unhighlight()}else{this.closeDropDown(null,event)}}event.preventDefault()}if(event.keyCode===$.ui.keyCode.DOWN){if(event.altKey||!_options.dropDownOpened){this.openDropDown(null,true,event)}else{$item=$keyNavItem.length>0?this._nextVisibleItem($keyNavItem):$visibleItems.eq(0);if(event.shiftKey&&multiSelection&&_options.dropDownOpened){this._handleShiftNavigation($item,event)}else{this._navigateToItem($item,true,true,event)}if(options.virtualization&&activeIndex>=options.visibleItemsCount-1){this.listScrollTop(currentScrollTop+itemHeight+1)}}event.preventDefault()}if(event.keyCode===$.ui.keyCode.UP){if(_options.dropDownOpened){if(event.altKey||$keyNavItem.length===0||_options.keyNavItemValue===options.dataSource.dataView()[0][options.valueKey]){this.closeDropDown(null,event)}else{$item=this._prevVisibleItem($keyNavItem);if(event.shiftKey&&multiSelection&&_options.dropDownOpened){this._handleShiftNavigation($item,event)}else{this._navigateToItem($item,true,true,event)}if(options.virtualization&&activeIndex-1<0){this.listScrollTop(currentScrollTop-itemHeight-1)}}}event.preventDefault()}if(event.keyCode===$.ui.keyCode.ENTER||options.selectItemBySpaceKey&&event.keyCode===$.ui.keyCode.SPACE){if(event.shiftKey&&_options.$itemsToSelectOnShiftUpDown.length===1){$lastSelectedItem=this._$elementFromValue(_options.selectedValues[_options.selectedValues.length-1]);this.select(this._itemsBetweenTwoItems($keyNavItem,$lastSelectedItem),{additive:true})
}else{isAutoSelectedActive=$keyNavItem.is(_options.$autoSelectedItem);multiSelect=multiSelection&&(!options.multiSelection.addWithKeyModifier||event.ctrlKey||isAutoSelectedActive);if(multiSelect&&this.isSelected($keyNavItem)&&!isAutoSelectedActive){this.deselect($keyNavItem,{focusCombo:true},event)}else{closeDropDown=multiSelect?false:options.closeDropDownOnSelect;this.select($keyNavItem,{additive:multiSelect,closeDropDown:closeDropDown,focusCombo:true},event)}}if(event.keyCode===$.ui.keyCode.ENTER&&options.preventSubmitOnEnter||event.keyCode===$.ui.keyCode.SPACE){event.preventDefault()}}if(event.keyCode===$.ui.keyCode.HOME&&event.ctrlKey&&_options.dropDownOpened){this._navigateToItem($visibleItems.first(),true,true,event);event.preventDefault()}if(event.keyCode===$.ui.keyCode.END&&event.ctrlKey&&_options.dropDownOpened){this._navigateToItem($visibleItems.last(),true,true,event);event.preventDefault()}if(event.keyCode===$.ui.keyCode.PAGE_UP&&_options.dropDownOpened){index=-options.visibleItemsCount+1;if($keyNavItem.length>0){index+=$visibleItems.index($keyNavItem)}if(index<0){index=0}this._navigateToItem($visibleItems.eq(index),true,true,event);event.preventDefault()}if(event.keyCode===$.ui.keyCode.PAGE_DOWN&&_options.dropDownOpened){index=options.visibleItemsCount-1;if($keyNavItem.length>0){index+=$visibleItems.index($keyNavItem)}if(index>$visibleItems.length-1){index=$visibleItems.length-1}this._navigateToItem($visibleItems.eq(index),true,true,event);event.preventDefault()}if(event.keyCode===_options.shiftKeyCode&&multiSelection&&_options.dropDownOpened&&!_options.shiftDown){_options.shiftDown=true;if(_options.$initialShiftDownItem.length>0){this._setKeyNavigationItem(_options.$initialShiftDownItem,true,true,false)}else{_options.$initialShiftDownItem=$keyNavItem}_options.$itemsToSelectOnShiftUpDown=$keyNavItem;$keyNavItem.addClass(this.css.itemInFocus)}},_itemsBetweenTwoItems:function($item1,$item2){var firstIndex,sndIndex,temp,$items=this._$items(),$result=$();firstIndex=$items.index($item1);sndIndex=$items.index($item2);if(firstIndex>sndIndex){temp=firstIndex;firstIndex=sndIndex;sndIndex=temp}for(;firstIndex<=sndIndex;firstIndex++){$result=$result.add(this._visibleItemByIndex(firstIndex))}return $result},_windowResize:function(){if(this.options.dropDownAttachedToBody){this._resizeDropDown()}},_documentMouseUp:function(){var _options=this._options;if(_options.$itemsToSelectOnShiftClick.length>0){_options.$itemsToSelectOnShiftClick=$()}_options.mouseDownStartedFromListItem=false},_inputFocus:function(event){var mode=this.options.mode;if(this.options.disabled){return}if(mode==="editable"||mode==="dropdown"){this._options.$combo.addClass(this.css.active)}if(this.options.dropDownOnFocus&&mode==="editable"){this.openDropDown(null,true,event)}},_inputBlur:function(event){var _options=this._options,$activeEl=$(document.activeElement);if(this.options.disabled){return}if($activeEl.is(_options.$dropDownCont)||$activeEl.is(_options.$dropDownBtnIcon)||$activeEl.is(_options.$clearIcon)){_options.preventInputBlur=true;_options.$input.focus()}if(!_options.preventInputBlur){if(this.options.mode==="editable"||this.options.mode==="dropdown"){_options.$combo.removeClass(this.css.active)}if(this.options.closeDropDownOnBlur){this.closeDropDown(null,event)}if(!_options.dropDownOpened){if(_options.validator){_options.validator._evt(event,null,1)}}}else{_options.preventInputBlur=false}},_inputClick:function(event){if(this.options.disabled){return}if(this.options.mode==="dropdown"||this.options.mode==="readonlylist"){this._toggleDropDownState(event)}},_inputKeyDown:function(event){if(this.options.disabled){return}if(this.options.mode==="editable"||this.options.mode==="dropdown"){this._handleKeyNavigation(event)}},_inputPaste:function(event){var self=this;if(this.options.disabled){return}if(this.options.mode==="editable"){setTimeout(function(){self._handleInputChange(!self._options.dropDownOpened,event)},0)}},_inputKeyUp:function(event){if(this.options.disabled){return}if(this.options.mode==="editable"){this._handleInputChange(!this._options.dropDownOpened,event)}if(this.options.mode==="editable"||this.options.mode==="dropdown"){if(event.keyCode===this._options.shiftKeyCode&&this.options.multiSelection.enabled){this._handleShiftUp(event)}}},_inputMouseDown:function(event){if(this.options.disabled){return}if(!this._options.$input.is(":focus")){this._options.$input.focus();this._moveCarretToInputEnd();event.preventDefault()}},_attachEvents:function(){var self=this,css=this.css,options=this.options,_options=this._options,_handlers=this._handlers;$(window).on({resize:_handlers.windowResize});$(document).on({mouseup:_handlers.documentMouseUp});_options.$combo.on({mouseenter:function(){if(options.disabled){return}if(options.mode!=="readonly"){_options.$combo.addClass(css.hover)}},mouseleave:function(){if(options.disabled){return}_options.$combo.removeClass(css.hover);if(!((options.mode==="editable"||options.mode==="dropdown")&&_options.$input.is(":focus"))){_options.$combo.removeClass(css.active)}},mousedown:function(){if(options.disabled){return}if(options.mode!=="readonly"){_options.$combo.addClass(css.active)}},mouseup:function(){if(options.disabled){return}if(options.mode==="readonlylist"){_options.$combo.removeClass(css.active)}}});_options.$dropDownBtnCont.on({mouseenter:function(){if(options.disabled){return}if(options.mode!=="readonly"){_options.$dropDownBtnCont.addClass(css.hover)}},mouseleave:function(){if(options.disabled){return}if(options.mode!=="readonly"){_options.$dropDownBtnCont.removeClass(css.hover)}},mousedown:function(event){if(options.disabled){return}event.preventDefault()},click:function(event){if(options.disabled||!(self._$items().length>0||_options.$dropDownCont.find("."+css.noMatchFound).length>0)){return}if(options.mode!=="readonly"){if(_options.dropDownOpened){self.closeDropDown(null,event);self._moveCarretToInputEnd()}else{self.openDropDown(null,true,event)}}event.stopPropagation()}});_options.$clearCont.on({mouseenter:function(){if(options.disabled){return}if(options.mode!=="readonly"){_options.$clearCont.addClass(css.clearHover)}},mouseleave:function(){if(options.disabled){return}if(options.mode!=="readonly"){_options.$clearCont.removeClass(css.clearHover)}},mousedown:function(event){if(options.disabled){return}event.preventDefault()},click:function(event){if(options.disabled||_options.loadingBegan){return}if(options.mode==="editable"||options.mode==="dropdown"){_options.$clearCont.hide();self.clearInput(event);self._moveCarretToInputEnd()}}});_options.$input.on({focus:_handlers.inputFocus,blur:_handlers.inputBlur,click:_handlers.inputClick,keydown:_handlers.inputKeyDown,paste:_handlers.inputPaste,keyup:_handlers.inputKeyUp,mousedown:_handlers.inputMouseDown});_options.$dropDownCont.on({mouseenter:function(){var $this,$prevItems;if(options.disabled){return}if(options.mode==="editable"||options.mode==="dropdown"){$this=$(this);if(_options.$itemsToSelectOnShiftClick.length>0){$prevItems=_options.$itemsToSelectOnShiftClick;_options.$itemsToSelectOnShiftClick=self._itemsBetweenTwoItems(self._$keyNavItem(),$this);$prevItems.not(_options.$itemsToSelectOnShiftClick).removeClass(css.itemInFocus);_options.$itemsToSelectOnShiftClick.addClass(css.itemInFocus)}else{$this.addClass(css.hover);if(_options.mouseDownStartedFromListItem){$this.addClass(css.itemInFocus)}}}},mouseleave:function(){var $this;if(options.disabled){return}if(options.mode==="editable"||options.mode==="dropdown"){$this=$(this);$this.removeClass(css.hover);if(!($this.is(self._$keyNavItem())||$this.is(_options.$itemsToSelectOnShiftUpDown))){$this.removeClass(css.itemInFocus)}if(_options.$itemsToSelectOnShiftClick.length>0){_options.$itemsToSelectOnShiftClick.removeClass(css.itemInFocus)}}},mousedown:function(event){var $this,$keyNavItem;if(options.disabled){return}if(options.mode==="editable"||options.mode==="dropdown"){if(event.which===1){$this=$(this);$keyNavItem=self._$keyNavItem();if(event.shiftKey&&options.multiSelection.enabled){if(_options.$initialShiftDownItem.length>0&&!$keyNavItem.is(_options.$initialShiftDownItem)){self._setKeyNavigationItem(_options.$initialShiftDownItem,true,true,false)}if($keyNavItem.length===0){self._setKeyNavigationItem(self._$items().filter(":visible").eq(0),true,false,false)}_options.$itemsToSelectOnShiftClick=self._itemsBetweenTwoItems($this,$keyNavItem);_options.$itemsToSelectOnShiftClick.addClass(css.itemInFocus)}else{$this.addClass(css.itemInFocus)}_options.mouseDownStartedFromListItem=true}}},mouseup:function(event){var $this,multiSelect,closeDropDown;if(options.disabled){return}if(options.mode==="editable"||options.mode==="dropdown"){if(_options.mouseDownStartedFromListItem&&event.which===1){$this=$(this);if(event.shiftKey&&options.multiSelection.enabled){self._handleShiftClick(event)}else{multiSelect=options.multiSelection.enabled&&(!options.multiSelection.addWithKeyModifier||event.ctrlKey);closeDropDown=multiSelect?false:options.closeDropDownOnSelect;if(multiSelect&&self.isSelected($this)&&!self._$keyNavItem().is(_options.$autoSelectedItem)){self.deselect($this,{focusCombo:true},event)}else{self.select($this,{additive:multiSelect,closeDropDown:closeDropDown,focusCombo:true},event)}}$this.removeClass(css.itemInFocus)}}}},"."+css.listItem.split(" ",1)[0]);_options.$dropDownCont.on({mousedown:function(event){if(options.disabled){return}event.preventDefault()},scroll:function(){if(options.disabled){return}_options.$loading.css({top:self.listScrollTop()});if(!(_options.loadingBegan||_options.disableScroll)){self._callNextChunk(_options.$dropDownCont,self._calculateDropDownItemHeight())}}});if(_options.$dropDownScrollCont){_options.$dropDownScrollCont.on("scroll",function(){if(options.disabled){return}self._scrollVirtualization($(this))});_options.$dropDownCont.on("mousewheel DOMMouseScroll",function(event){var currentScrollTop=self.listScrollTop(),itemHeight=self._calculateDropDownItemHeight();if(options.disabled){return}if(event.originalEvent.wheelDelta>0||event.originalEvent.detail<0){self.listScrollTop(currentScrollTop-itemHeight)}else{self.listScrollTop(currentScrollTop+itemHeight)}})}},_scrollVirtualization:function($this){var calculatedDropDownItemHeight,offset,options=this.options,_options=this._options;if(!options.virtualization||_options.loadingBegan){return}if(options.filteringType==="local"&&_options.inputVal!==""&&_options.expression!==undefined&&_options.expression!==null){options.dataSource.filter(_options.expression,options.filteringLogic,true)}calculatedDropDownItemHeight=this._calculateDropDownItemHeight();offset=this._calculateOffsetItems(options.dataSource.dataView(),calculatedDropDownItemHeight);this._updateItems(offset);options.dataSource.settings.callback=function(err,success,data){_options.$dropDownScroll.height(data.totalLocalRecordsCount()*calculatedDropDownItemHeight)};this._callNextChunk($this,calculatedDropDownItemHeight)},_calculateOffsetItems:function(dataView,calculatedDropDownItemHeight){var offset,containerRatio,itemRatio;containerRatio=this.listScrollTop()/this._options.$dropDownScrollCont.prop("scrollHeight");itemRatio=calculatedDropDownItemHeight/this._calculateDropDownHeight(calculatedDropDownItemHeight,dataView.length);offset=parseInt(containerRatio/itemRatio,10);return offset},_callNextChunk:function($element,calculatedDropDownItemHeight){var delta=this._options.deltaItemsForLoadOnDemand*calculatedDropDownItemHeight;if(this.listScrollTop()+$element.innerHeight()+delta>=$element.prop("scrollHeight")){this._nextChunk()}},_setOption:function(option,value){var options=this.options,_options=this._options;if(options[option]===value){return}if(option==="multiSelection"){value=$.extend(true,{},options.multiSelection,value)}if(option==="loadOnDemandSettings"){value=$.extend(true,{},options.loadOnDemandSettings,value)}if(option==="disabled"){_options.$comboWrapper.toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!value).attr("aria-disabled",value);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus");if(value){_options.$input.attr("readonly",true)}else{_options.$input.removeAttr("readonly")}}$.Widget.prototype._setOption.apply(this,arguments);this._analyzeOptions();switch(option){case"width":_options.$comboWrapper.outerWidth(value);if(options.dropDownAttachedToBody){this._resizeDropDown()}break;case"height":_options.$comboWrapper.outerHeight(value);if(options.dropDownAttachedToBody){this._resizeDropDown()}break;case"dropDownWidth":this._resizeDropDown();break;case"itemTemplate":this._renderItems(null,null,this.options.dataSource);break;case"inputName":_options.$hiddenInput.attr("name",value);break;case"visibleItemsCount":this._setDropDownMaxHeight();break;case"placeHolder":_options.$input.attr("placeholder",value);break;case"multiSelection":this.value(this._options.selectedValues[0]);this._renderItems(null,null,this.options.dataSource);this.clearInput();break;case"tabIndex":this._options.$input.attr("tabIndex",value);break;case"validatorOptions":this.validator();break;case"dropDownButtonTitle":_options.$dropDownBtnCont.attr("title",value);break;case"clearButtonTitle":_options.$clearCont.attr("title",value);break;case"dataSource":case"dataSourceType":case"dataSourceUrl":case"responseTotalRecCountKey":case"responseDataKey":case"responseDataType":case"responseContentType":case"requestType":case"filteringType":case"filterExprUrlKey":case"filteringCondition":case"filteringLogic":case"loadOnDemandSettings":case"valueKey":case"textKey":this.dataBind();break;case"dropDownAttachedToBody":case"mode":case"virtualization":case"enableClearButton":case"format":throw new Error($.ig.Combo.locale.notSuported)}},_initDataSource:function(){var dataSourceOptions,schema,pagingOptions,curData,len,i,self=this,lod=this.options.loadOnDemandSettings,options=this.options,isStringDataSource=$.type(options.dataSource)==="string",url=options.dataSourceUrl;if(!options.dataSource&&this.element.is("select")){options.dataSource=this.element[0];schema=this._initSelectSchema()}else if(!options.dataSource&&url){options.dataSource=url;isStringDataSource=true}if($.type(options.dataSource)==="function"){options.dataSource=options.dataSource()}if(!(options.dataSource&&this._isInstanceOfDataSource(options.dataSource))){if($.type(options.dataSource)==="array"&&($.type(options.dataSource[0])==="number"||$.type(options.dataSource[0])==="string"||$.type(options.dataSource[0])==="date")){for(i=0,len=options.dataSource.length;i<len;i++){curData=options.dataSource[i];options.dataSource[i]={};options.dataSource[i][options.textKey]=curData;options.dataSource[i][options.valueKey]=curData}}if(!schema&&options.dataSource){schema=this._initSchema(options.dataSource[0])}dataSourceOptions={callback:this._renderItems,callee:this,dataSource:options.dataSource,type:options.dataSourceType||undefined,requestType:options.requestType||"GET",responseContentType:options.responseContentType||null,responseDataType:options.responseDataType||null,responseDataKey:options.responseDataKey||null,responseTotalRecCountKey:options.responseTotalRecCountKey||null,localSchemaTransform:false,schema:schema||null,dataBinding:function(){if(!self._options.dropDownOpened||self._options.loadingBegan){return}self._options.loadingBegan=true;self._options.$loading.insertBefore(self._options.$dropDownList)},dataBound:function(){self._options.$loading.remove();self._options.loadingBegan=false;if(self.options.filteringType==="remote"&&self._options.dropDownOpened){self._updateVirtualScrollVisibility()}}};if(lod&&lod.enabled&&(url||isStringDataSource)){pagingOptions={enabled:true,appendPage:true,pageSize:lod.pageSize,pageIndex:0,pageSizeUrlKey:lod.pageSizeUrlKey||null,pageIndexUrlKey:lod.pageIndexUrlKey||null};$.extend(dataSourceOptions,{paging:pagingOptions})}if($.type(options.dataSource)==="string"&&!options.dataSourceType&&$.ig.util.isJsonpUrl(options.dataSource)){this._options.strDataSource=options.dataSource;options.dataSource=new $.ig.JSONPDataSource(dataSourceOptions)}else{options.dataSource=new $.ig.DataSource(dataSourceOptions)}if(url){options.dataSource.settings.dataSource=url;options.dataSource.settings.type="remoteUrl";options.dataSource._runtimeType=options.dataSource.analyzeDataSource();options.dataSource.settings.urlParamsEncoded=$.proxy(function(data,params){params=params?params.filteringParams:null;if(params){params.textKey=options.textKey||options.valueKey;params.valueKey=options.valueKey;if(!options.caseSensitive){params.toLower="1"}if(options.compactData){params.compact="1"}}},this)}var _aNull=function(v,nan){return v===null||v===undefined||nan&&typeof v==="number"&&isNaN(v)};options.dataSource._responseData=function(data){var len=data?data.length:0,count=len>0?data[len-1][":totals:"]:null;if(count){data.pop();count=count.split(":");options.dataSource.totalRecordsCount(_aNull(len=parseInt(count[0],10),true)?0:len);len=_aNull(len=parseInt(count[1],10),true)?0:len;if(len){options._totalAll=len}}}}},_isInstanceOfDataSource:function(ds){return typeof ds._xmlToArray==="function"&&typeof ds._encodePkParams==="function"},_nextChunk:function(){var lod=this.options.loadOnDemandSettings,ds=this.options.dataSource;if(lod&&ds&&lod.enabled){ds.settings.paging.appendPage=true;if(!this.options.virtualization){this.options.dataSource.settings.callback=this._handleLoadOnDemand}ds.nextPage()}return this},_initSelectSchema:function(){var schema={};schema.fields=[{name:this.options.valueKey,type:"string"},{name:this.options.textKey,type:"string"}];return schema},_initSchema:function(firstDsRow){var field,schema={fields:[]};for(field in firstDsRow){if(firstDsRow.hasOwnProperty(field)){schema.fields.push({name:field,type:$.type(firstDsRow[field])})}}return schema},_generateExpressions:function(texts){var i,expressions=[];if($.type(texts)==="string"){if(texts.length>0||this._options.expression&&this._options.expression.length>0){expressions.push({fieldName:this.options.textKey,expr:texts,cond:this.options.filteringCondition})}}else if($.type(texts)==="array"){for(i=0;i<texts.length;i++){if($.type(texts[i])==="string"){expressions.push({fieldName:this.options.textKey,expr:texts[i],cond:this.options.filteringCondition,logic:this.options.filteringLogic})}else{throw new Error($.ig.igCombo.locale.errorNoSupportedTextType)}}}else{throw new Error($.ig.igCombo.locale.errorNoSupportedTextsType)}return expressions},_generateRegExpPattern:function(texts){var pattern=null,types={multi:function(texts){return"("+texts.join("|")+")"},startsWith:function(texts){return"^("+texts.join("|")+")"},full:function(texts){return"^"+texts.join("|")+"$"},contains:function(texts){return texts.join("|")}};if($.type(texts)==="string"){texts=[texts]}texts=$.grep(texts,function(text){return text!==""});texts=$.map(texts,function(text){return text.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")});if(texts.length>0){if($.type(types[this.options.highlightMatchesMode])==="function"){pattern=types[this.options.highlightMatchesMode](texts)}else{throw new Error($.ig.igCombo.locale.errorUnrecognizedHighlightMatchesMode)}}return pattern},_highlight:function(texts){var pattern,regex,highlightElement=this._options.highlightElement,highlightCssClass=this.css.listItemHighlighted,regExpFlag=this.options.caseSensitive?"":"i";if(this.options.itemTemplate){return}if(this.options.highlightMatchesMode===null){return this}if(this.options.highlightMatchesMode!=="contains"){regExpFlag+="g"}pattern=this._generateRegExpPattern(texts);if(!pattern){return this}regex=new RegExp(pattern,regExpFlag);return this._options.$dropDownCont.find("."+this.css.listItemHolder+" *").each(function(){$(this).contents().filter(function(){return this.nodeType===3&&regex.test(this.nodeValue)}).replaceWith(function(){return(this.nodeValue||"").replace(regex,function(match){return"<"+highlightElement+' class="'+highlightCssClass+'">'+match+"</"+highlightElement+">"})})})},_unhighlight:function(){if(this.options.highlightMatchesMode===null){return this}return this._options.$dropDownCont.find("."+this.css.listItemHolder+" *").find(this._options.highlightElement+"."+this.css.listItemHighlighted).each(function(){var parent=this.parentNode;parent.replaceChild(this.firstChild,this);parent.normalize()}).end()},_updateFiltering:function(event){var val=this._options.inputVal;if(this.options.multiSelection.enabled){if(this._endsPartialyWithItemSep(val)){val=""}else{val=this._lastValAfterItemSep()}}this.filter(val,event)},_updateHighlighting:function(){var val=this._options.inputVal;if(this.options.multiSelection.enabled){val=this._lastValAfterItemSep(val)}this._unhighlight();this._highlight(val)},_updateInputValues:function(keepInputText){var curData,i,options=this.options,inputVal="",hiddenInputVal="",selectedItems=this.selectedItems(),len=selectedItems?selectedItems.length:0,itemSeparator=options.multiSelection.itemSeparator;for(i=0;i<len;i++){curData=this._unwrapData(selectedItems[i].data);if(i!==0){inputVal+=itemSeparator;hiddenInputVal+=itemSeparator}inputVal+=this._formatItem(this._unwrapData(curData[options.textKey]));hiddenInputVal+=this._unwrapData(curData[options.valueKey])}if(!keepInputText){if(options.multiSelection.enabled&&len>0){inputVal+=itemSeparator}this._options.$input.val(inputVal);this._setInputVal(inputVal);this._options.autoSelectedItemValue=null}this._options.$hiddenInput.val(hiddenInputVal)},_handleLocalFiltering:function(dataSource){var $curItem,curKey,filterItem,i,j,unwrappedDataViewItem,unwrappedDataViewValue,_options=this._options,valKey=this.options.valueKey,dataView=dataSource.dataView(),$items=this._$items(),len=$items.length,dataLen=dataView.length;for(i=0;i<len;i++){$curItem=$items.eq(i);curKey=$curItem.data("value");filterItem=true;for(j=0;j<dataLen&&filterItem;j++){unwrappedDataViewItem=this._unwrapData(dataView[j]);unwrappedDataViewValue=this._unwrapData(unwrappedDataViewItem[valKey]);if(curKey===unwrappedDataViewValue){filterItem=false}}if(filterItem){$curItem.addClass(this.css.hidden)}else{$curItem.removeClass(this.css.hidden)}}if(dataLen===0){if(!_options.$noMatchFound){_options.$noMatchFound=$("<li>").addClass(this.css.noMatchFound).addClass(this.css.unselectable).attr("unselectable","on").html(this.options.noMatchFoundText)}if(_options.$noMatchFound.parent().length===0){_options.$noMatchFound.appendTo(_options.$dropDownList)}}else if(_options.$noMatchFound&&_options.$noMatchFound.parent().length>0){_options.$noMatchFound.detach()}},_setDropDownMaxHeight:function(){var borderHeight,noBorder=this._options.$dropDownCont.hasClass(this.css.noBorder),maxItemsSize=this.options.visibleItemsCount*this._calculateDropDownItemHeight();this._options.$dropDownCont.removeClass(this.css.noBorder);borderHeight=parseInt(this._options.$dropDownCont.css("border-top-width"),10)+parseInt(this._options.$dropDownCont.css("border-bottom-width"),10);if(noBorder){this._options.$dropDownCont.addClass(this.css.noBorder)}this._options.$dropDownCont.css("maxHeight",maxItemsSize+borderHeight)},_updateVirtualScrollVisibility:function(){if(this._isPossibleToVirtualize()){this._options.$dropDownScrollCont.removeClass(this.css.hidden)}else if(this._areItemsLowerInVir()){this._options.$dropDownScrollCont.addClass(this.css.hidden)}},_addItemSelectionStyles:function($items){var $curItem,len,i;for(i=0,len=$items.length;i<len;i++){$curItem=$items.eq(i);$curItem.addClass(this.css.active);if(this._checkBoxesEnabled()){$curItem.find(".ui-igcombo-checkbox .ui-icon").removeClass(this.css.checkboxOff).addClass(this.css.checkboxOn)}}},_removeItemSelectionStyles:function($items){var $curItem,len,i;for(i=0,len=$items.length;i<len;i++){$curItem=$items.eq(i);$curItem.removeClass(this.css.active);if(this._checkBoxesEnabled()){$curItem.find(".ui-igcombo-checkbox .ui-icon").removeClass(this.css.checkboxOn).addClass(this.css.checkboxOff)}}},_callInternalSelChangeSubs:function(){var curCallback,i,callbacks=this._options.internalSelChangeSubs;if($.type(callbacks)==="array"){for(i=0;i<callbacks.length;i++){curCallback=callbacks[i];if(typeof curCallback==="function"){curCallback()}}}},_unwrapData:function(data){if(typeof data==="function"){data=data()}return data},_triggerItemsRendering:function(){var args={owner:this,dataSource:this.options.dataSource};return this._trigger(this.events.itemsRendering,null,args)},_triggerItemsRendered:function(){var args={owner:this,items:this.items(),dataSource:this.options.dataSource};this._trigger(this.events.itemsRendered,null,args)},_triggerRendered:function(){var args={owner:this,element:this._options.$comboWrapper};this._trigger(this.events.rendered,null,args)},_triggerDataBinding:function(){var args={owner:this,dataSource:this.options.dataSource};return this._trigger(this.events.dataBinding,null,args)},_triggerDataBound:function(success,msg){var args={owner:this,success:success,errorMessage:msg,dataSource:this.options.dataSource};this._trigger(this.events.dataBound,null,args)},_triggerFiltering:function(event){var args={owner:this,expression:this._options.expression};return this._trigger(this.events.filtering,event,args)},_triggerFiltered:function(event){var args={owner:this,items:this.filteredItems()};this._trigger(this.events.filtered,event,args)},_triggerDropDownOpening:function(event){var args={owner:this,list:this._options.$dropDownCont};return this._trigger(this.events.dropDownOpening,event,args)},_triggerDropDownOpened:function(event){var args={owner:this,list:this._options.$dropDownCont};this._trigger(this.events.dropDownOpened,event,args)},_triggerDropDownClosing:function(event){var args={owner:this,list:this._options.$dropDownCont};return this._trigger(this.events.dropDownClosing,event,args)},_triggerDropDownClosed:function(event){var args={owner:this,list:this._options.$dropDownCont};this._trigger(this.events.dropDownClosed,event,args)},_triggerSelectionChanging:function(newSelItems,currentSelItems,event){var args={owner:this,items:newSelItems,currentItems:currentSelItems};return this._trigger(this.events.selectionChanging,event,args)},_triggerSelectionChanged:function(newSelItems,oldItems,event){var args={owner:this,items:newSelItems,oldItems:oldItems};this._trigger(this.events.selectionChanged,event,args)},dataBind:function(){var noCancel;this._initDataSource();this._options.cachedRecords=[];noCancel=this._triggerDataBinding();if(noCancel){if(!this._options.initialDataBinding){this.clearInput();this._options.selectedValues=[]}this.options.dataSource.dataBind(this._renderItems,this)}return this},dataForValue:function(value){var data,unwrappedDataItem,unwrappedDataValue,len,i,valKey=this.options.valueKey,cachedRecords=this._options.cachedRecords,matchFound=false,result=null;if(!this.options.dataSource){return null}data=this.options.dataSource.data();for(i=0,len=data.length;i<len&&!matchFound;i++){unwrappedDataItem=this._unwrapData(data[i]);unwrappedDataValue=this._unwrapData(unwrappedDataItem[valKey]);if(unwrappedDataValue===value){result=data[i];matchFound=true}}if(!matchFound&&this.options.filteringType==="remote"){for(i=0,len=cachedRecords.length;i<len&&!matchFound;i++){unwrappedDataItem=this._unwrapData(cachedRecords[i]);unwrappedDataValue=this._unwrapData(unwrappedDataItem[valKey]);if(unwrappedDataValue===value){result=cachedRecords[i];matchFound=true}}}return result},dataForElement:function($element){if(!($element instanceof $&&$element.is(this._$items()))){return null}return this.dataForValue($element.data("value"))},itemsFromElement:function($element){var i,result,$curElement;if(!($element instanceof $&&$element.is(this._$items()))){return null}if($element.length===1){result={element:$element,data:this.dataForElement($element)}}else{result=[];for(i=0;i<$element.length;i++){$curElement=$element.eq(i);result.push({element:$curElement,data:this.dataForElement($curElement)})}}return result},itemsFromValue:function(value){var data,i,result=null;if($.type(value)==="array"){value=$.grep(value,function(val,index){return $.inArray(val,value)===index});for(i=0;i<value.length;i++){data=this.dataForValue(value[i]);if(data){if(!result){result=[]}result.push({element:this._$elementFromValue(value[i]),data:data})}}}else{data=this.dataForValue(value);if(data){result={element:this._$elementFromValue(value),data:data}}}return result},itemsFromIndex:function(index){var value,i,data=this.options.dataSource.data(),dataLen=data.length,valKey=this.options.valueKey;if($.type(index)==="array"){value=[];for(i=0;i<index.length;i++){if(typeof index[i]==="number"&&index[i]>=0&&index[i]<dataLen){value.push(data[index[i]][valKey])}}}else if(typeof index==="number"&&index>=0&&index<dataLen){value=this._unwrapData(this._unwrapData(data[index])[valKey])}return this.itemsFromValue(value)},items:function(){return this.itemsFromValue(this._valuesFromData(this.options.dataSource.data()))},filteredItems:function(){return this.itemsFromValue(this._valuesFromData(this.options.dataSource.dataView()))},selectedItems:function(){return this._options.selectedValues.length>0?this.itemsFromValue(this._options.selectedValues):null},filter:function(texts,event){var noCancel,ds=this.options.dataSource,type=this.options.filteringType,logic=this.options.filteringLogic,filterExprUrlKey=this.options.filterExprUrlKey,paging=ds.settings.paging,filtering=ds.settings.filtering;if(!this._isEnabledFiltering()){return this}noCancel=event?this._triggerFiltering(event):true;if(noCancel){filtering.type=type;filtering.expressions=this._options.expression=this._generateExpressions(texts);filtering.caseSensitive=this.options.caseSensitive;if(type==="local"&&!this.options.virtualization){ds.filter(filtering.expressions,logic,true);this._handleLocalFiltering(ds)}else if(type==="local"&&this.options.virtualization){ds.filter(filtering.expressions,logic,true);this._handleLocalFilteringWithVirt(ds)}else if(type==="remote"){if(paging){paging.pageIndex=0;paging.appendPage=false}if(filterExprUrlKey){filtering.filterExprUrlKey=filterExprUrlKey}this._options.remoteFilteringTriggerEvt=event;ds.dataBind(this._handleRemoteFiltering,this)}if(this._options.dropDownOpened){this.listScrollTop(0)}if(this.options.virtualization&&type!=="remote"){this._updateVirtualScrollVisibility()}if(event&&!this._options.remoteFilteringTriggerEvt){this._triggerFiltered(event)}}return this},clearFiltering:function(event){var type=this.options.filteringType,virtualization=this.options.virtualization,ds=this.options.dataSource;if(!ds||!this._options.expression||this._options.expression.length<=0){this._options.updateInputValuesOnRemoteFilter=false;return}this._options.expression=null;if(type==="local"&&!virtualization&&ds.clearLocalFilter){ds.clearLocalFilter();this._handleLocalFiltering(ds)}else if(type==="local"&&virtualization&&ds.clearLocalFilter){ds.clearLocalFilter();this._handleLocalFilteringWithVirt(ds);if(this._options.dropDownOpened){this.listScrollTop(0)}this._updateVirtualScrollVisibility()}else if(this.options.filteringType==="remote"){this.filter("",event)}return this},openDropDown:function(callback,focusCombo,event){var autoHeight,offset,calculatedDropDownItemHeight,noCancel,self=this,_options=this._options,$ddCont=_options.$dropDownCont;if(focusCombo===undefined){focusCombo=true}if(!_options.dropDownOpened){noCancel=event?this._triggerDropDownOpening(event):true;if(noCancel){_options.dropDownOpened=true;autoHeight=_options.$dropDownList.outerHeight();if(self.options.virtualization){calculatedDropDownItemHeight=self._calculateDropDownItemHeight();offset=self._calculateOffsetItems(self.options.dataSource.dataView(),calculatedDropDownItemHeight);self._updateItems(offset)}if(this.options.dropDownAttachedToBody){this._resizeDropDown()}$ddCont.stop().removeClass(this.css.noBorder).css("overflow","hidden").animate({height:autoHeight},{duration:this.options.animationShowDuration,queue:false,easing:"swing",complete:function(){$ddCont.height("").css("overflow","");if($.type(callback)==="function"){callback()}if(event){self._triggerDropDownOpened(event)
}}});if(focusCombo){this._moveCarretToInputEnd()}}}return this},closeDropDown:function(callback,event){var noCancel,self=this,_options=this._options;if(_options.dropDownOpened&&!_options.loadingBegan){noCancel=event?this._triggerDropDownClosing(event):true;if(noCancel){_options.dropDownOpened=false;_options.$dropDownCont.stop().css("overflow","hidden").animate({height:0},{duration:this.options.animationHideDuration,queue:false,easing:"swing",complete:function(){_options.$dropDownCont.addClass(self.css.noBorder).css("overflow","");if(self.options.filteringType!=="remote"){self._updateInputValues();self._unhighlight();self.clearFiltering(event);if(self.options.multiSelection.enabled){self._setKeyNavigationItem($(),false,true,true)}if(_options.inputVal===""){_options.$clearCont.hide()}if(_options.validator){_options.validator._evt(event,null,1)}}else{_options.updateInputValuesOnRemoteFilter=true;self.clearFiltering(event)}if($.type(callback)==="function"){callback()}if(event){self._triggerDropDownClosed(event)}}})}}return this},clearInput:function(event){this._options.$input.val("");this._setInputVal("");this.deselectAll({focusCombo:true},event);this.clearFiltering(event);this._unhighlight();this._options.$clearCont.hide();this._setKeyNavigationItem($(),false,true,true);return this},isSelected:function($item){return $item instanceof $?this.isValueSelected($item.data("value")):false},isValueSelected:function(value){return $.inArray(value,this._options.selectedValues)!==-1},isIndexSelected:function(index){return this.isValueSelected(this.options.dataSource.data()[index][this.options.valueKey])},value:function(value,options,event){var itemsLen,selectedValues,newSelItems,selAutoSelectedItem,selChanged,additive,prevSelValues,newSelValues,skipEventTrigger,noCancel,i,comboOptions=this.options,_options=this._options,items=this.itemsFromValue(value),prevSelItems=this.selectedItems(),multiSelEnabled=comboOptions.multiSelection.enabled;if(value===undefined){selectedValues=[];if(prevSelItems){for(i=0;i<prevSelItems.length;i++){selectedValues.push(prevSelItems[i].data[this.options.valueKey])}}if(!this.options.multiSelection.enabled){selectedValues=selectedValues.length>0?selectedValues[0]:null}return selectedValues}if(items===null){return this}if($.type(items)!=="array"){items=[items]}options=options||{};additive=options.additive&&multiSelEnabled;itemsLen=items.length;if(itemsLen>1&&!multiSelEnabled){items=items.splice(0,1);itemsLen=1}selectedValues=this._valuesFromItems(items);if(additive){for(i=0;i<itemsLen&&!selChanged;i++){if(!this.isValueSelected(items[i].data[comboOptions.valueKey])){selChanged=true}}}else{prevSelValues=this._valuesFromItems(prevSelItems);if(!($(selectedValues).not(prevSelValues).length===0&&$(prevSelValues).not(selectedValues).length===0)){selChanged=true}}if($.inArray(_options.autoSelectedItemValue,selectedValues)!==-1){selAutoSelectedItem=true;skipEventTrigger=itemsLen===1}if(selChanged||selAutoSelectedItem){if(additive&&prevSelItems){newSelItems=prevSelItems.concat(this._filterItems(items,prevSelItems));newSelValues=this._valuesFromItems(newSelItems)}else{newSelItems=items;newSelValues=selectedValues}if(event&&!skipEventTrigger){noCancel=this._triggerSelectionChanging(newSelItems,prevSelItems)}else{noCancel=true}if(noCancel){_options.selectedValues=newSelValues;if(prevSelItems&&prevSelItems.length>0&&!additive){this._removeItemSelectionStyles(this._$elementsFromItems(this._filterItems(prevSelItems,items)))}this._addItemSelectionStyles(this._$elementsFromItems(newSelItems));this._updateInputValues(options.keepInputText);if(!options.keepHighlighting){this._unhighlight()}_options.$clearCont.show();if(options.focusCombo){this._moveCarretToInputEnd()}if(!options.keepNavItem){this._setKeyNavigationItem(items[itemsLen-1].element?items[itemsLen-1].element:$(),false,true,true)}if(comboOptions.filteringType==="remote"){this._options.cachedRecords=this._dataFromItems(newSelItems)}if(options.closeDropDown){noCancel=event?this._triggerDropDownClosing(event):true;if(noCancel){this.closeDropDown(null,event)}}if(!options.keepFiltering){this.clearFiltering(event)}this._callInternalSelChangeSubs();if(event&&!skipEventTrigger){this._triggerSelectionChanged(newSelItems,prevSelItems,event)}}}else if(options.closeDropDown){noCancel=event?this._triggerDropDownClosing(event):true;if(noCancel){this.closeDropDown(null,event)}}return this},select:function($items,options,event){if($items instanceof $){this.value(this._valuesFromElements($items),options,event)}return this},index:function(index,options,event){var selectedItems,indexes,unwrappedDataItem,unwrappedDataValue,i,items=this.itemsFromIndex(index);if(index===undefined){selectedItems=this.selectedItems();if(selectedItems.length===1){unwrappedDataItem=this._unwrapData(selectedItems[0].data);unwrappedDataValue=this._unwrapData(unwrappedDataItem[this.options.valueKey]);indexes=this._dataIndexByValue(unwrappedDataValue)}else{indexes=[];for(i=0;i<selectedItems.length;i++){unwrappedDataItem=this._unwrapData(selectedItems[i].data);unwrappedDataValue=this._unwrapData(unwrappedDataItem[this.options.valueKey]);indexes.push(this._dataIndexByValue(unwrappedDataValue))}}return indexes}if(items){this.value(this._valuesFromItems(items),options,event)}return this},selectAll:function(options,event){var unwrappedDataItem,unwrappedDataValue,i,data=this.options.dataSource.data(),len=data.length,values=[],valKey=this.options.valueKey;options=options||{};for(i=0;i<len;i++){unwrappedDataItem=this._unwrapData(data[i]);unwrappedDataValue=this._unwrapData(unwrappedDataItem[valKey]);values.push(unwrappedDataValue)}this.value(values,options,event);return this},deselectByValue:function(value,options,event){var items,newSelItems,selChanged,noCancel,len,i,_options=this._options,prevSelItems=this.selectedItems();options=options||{};if(value===undefined&&_options.selectedValues.length===1){value=_options.selectedValues[0]}items=this.itemsFromValue(value);if(items===null){return this}if($.type(items)!=="array"){items=[items]}for(i=0,len=items.length;i<len&&!selChanged;i++){if(this.isValueSelected(items[i].data[this.options.valueKey])){selChanged=true}}if(selChanged){newSelItems=this._filterItems(prevSelItems,items);noCancel=event?this._triggerSelectionChanging(newSelItems,prevSelItems):true;if(noCancel){_options.selectedValues=this._valuesFromItems(newSelItems);this._removeItemSelectionStyles(this._$elementsFromItems(items));this._updateInputValues(options.keepInputText);this._unhighlight();if(_options.inputVal===""){_options.$clearCont.hide()}if(options.focusCombo){this._moveCarretToInputEnd()}if(this.options.filteringType==="remote"){this._options.cachedRecords=this._dataFromItems(newSelItems)}this._callInternalSelChangeSubs();if(event){this._triggerSelectionChanged(newSelItems,prevSelItems,event)}}}return this},deselect:function($items,options,event){if($items===undefined){this.deselectByValue()}if($items instanceof $){$items=$items.filter(this._$items());this.deselectByValue(this._valuesFromElements($items),options,event)}return this},deselectByIndex:function(index,options,event){this.deselectByValue(this._valuesFromItems(this.itemsFromIndex(index)),options,event);return this},deselectAll:function(options,event){this.deselectByValue(this._options.selectedValues,options,event);return this},activeIndex:function(index){if(index===undefined){return this._$items().index(this._$keyNavItem())}this._setKeyNavigationItem(this.itemsFromIndex(index).data[this.options.valueKey],true,true,true);return this},text:function(text){if(text===undefined){return this._options.$input.val()}this._options.$input.val(text);this._handleInputChange(false);return this},listScrollTop:function(value){var $dropDown,_options=this._options;if(value!==undefined&&!_options.dropDownOpened){this.openDropDown()}$dropDown=_options.$dropDownScrollCont||_options.$dropDownCont;if(value===undefined){return $dropDown?$dropDown.prop("scrollTop"):0}if($dropDown){$dropDown.prop("scrollTop",value||0)}return this},listItems:function(){return this._$items()},comboWrapper:function(){return this._options.$comboWrapper},dropDown:function(){return this._options.$dropDownCont},textInput:function(){return this._options.$input},valueInput:function(){return this._options.$hiddenInput},validator:function(destroy){var validatorOptions=this.options.validatorOptions,$input=this._options.$input,validator=this._options.validator;if(validator&&(destroy||!validatorOptions)){validator.destroy();this._options.validator=validator=null}else if(!validator&&!destroy&&validatorOptions&&$input.igValidator){validatorOptions.combo=validatorOptions.element=this._options.$combo;this._options.validator=validator=$input.igValidator(validatorOptions).data("igValidator")}return validator},validate:function(){return this._options.validator?this._options.validator.validate():null},dropDownOpened:function(){return this._options.dropDownOpened},_unsetupInput:function(){var _handlers=this._handlers;this.element.insertAfter(this._options.$comboWrapper);this._options.$comboWrapper.remove();this.element.removeClass(this.css.field).val("").removeAttr("placeholder").removeAttr("tabIndex").attr("name",this._options.nameAttribute);if(this.options.mode!=="editable"){this.element.removeAttr("readonly").removeAttr("unselectable").removeClass(this.css.unselectable)}this.element.off({focus:_handlers.inputFocus,blur:_handlers.inputBlur,click:_handlers.inputClick,keydown:_handlers.inputKeyDown,paste:_handlers.inputPaste,keyup:_handlers.inputKeyUp,mousedown:_handlers.inputMouseDown})},destroy:function(){var _options=this._options,_handlers=this._handlers;this.validator(true);$(window).off("resize",_handlers.windowResize);$(document).off("mouseup",_handlers.documentMouseUp);_options.$dropDownCont.remove();if(this.element.is("input")){this._unsetupInput()}else if(this.element.is("select")){_options.$comboWrapper.remove();this.element.show().attr("name",_options.nameAttribute)}else{this.element.empty().removeClass(this.css.comboWrapper)}_options=null;$.Widget.prototype.destroy.apply(this,arguments);return this}});$.extend($.ui.igCombo,{version:"15.1.20151.1005"})})(jQuery);