/*!@license
* Infragistics.Web.ClientUI Grid localization resources 13.2.20132.2064
*
* Copyright (c) 2011-2014 Infragistics Inc.
*
* http://www.infragistics.com/
*
*/
$.ig=$.ig||{};if(!$.ig.Grid){$.ig.Grid={};$.extend($.ig.Grid,{locale:{noSuchWidget:"No such widget loaded: ",autoGenerateColumnsNoRecords:"autoGenerateColumns is enabled, but there are no records in the data source in order to determine the columns",optionChangeNotSupported:"Changing the following option after the igGrid has been created is not supported:",optionChangeNotScrollingGrid:"The following option cannot be changed after the grid is created because your initial grid is not scrolling and full re-rendering is required:",noPrimaryKeyDefined:"There is no primary key defined for the grid. In order to use features such as Grid Editing, you will need to define a primary key.",indexOutOfRange:"The row index you have specified is out of range.",noSuchColumnDefined:"The specified column key does not match any of the defined grid columns.",columnIndexOutOfRange:"The specified column index is out of range.",recordNotFound:"The record with the specified id could not be found in the data view:",columnNotFound:"No column was found matching key:",colPrefix:"Column ",columnVirtualizationRequiresWidth:"You have virtualization / columnVirtualization set to true, but no width could be inferred for grid columns. You should set one of a) grid width, b) defaultColumnWidth, c) define width for each column",virtualizationRequiresHeight:"You have virtualization set to true which requires grid height to be set too.",colVirtualizationDenied:"columnVirtualization is applicable for fixed virtualization only",noColumnsButAutoGenerateTrue:"You have autoGenerateColumns set to false, but there are no columns defined in the grid. Please set autoGenerateColumns to true, or specify columns manually",noPrimaryKey:"the igHierarchicalGrid widget requires a primary key to be defined.",templatingEnabledButNoTemplate:"You have jQueryTemplating set to true, but there is no rowTemplate defined.",expandTooltip:"Expand Row",collapseTooltip:"Collapse Row",movingNotAllowedOrIncompatible:"Moving of the requested column could not be completed. The column was not found or the result was not compatible with the column layout."}});$.ig.GridFiltering=$.ig.GridFiltering||{};$.extend($.ig.GridFiltering,{locale:{startsWithNullText:"Starts with...",endsWithNullText:"Ends with...",containsNullText:"Contains...",doesNotContainNullText:"Does not contain...",equalsNullText:"Equals...",doesNotEqualNullText:"Does not equal...",greaterThanNullText:"Greater than...",lessThanNullText:"Less than...",greaterThanOrEqualToNullText:"Greater than or equal to...",lessThanOrEqualToNullText:"Less than or equal to...",onNullText:"On...",notOnNullText:"Not on...",afterNullText:"After",beforeNullText:"Before",emptyNullText:"Empty",notEmptyNullText:"Not empty",nullNullText:"Null",notNullNullText:"Not null",startsWithLabel:"Starts with",endsWithLabel:"Ends with",containsLabel:"Contains",doesNotContainLabel:"Does not contain",equalsLabel:"Equals",doesNotEqualLabel:"Does not equal",greaterThanLabel:"Greater than",lessThanLabel:"Less than",greaterThanOrEqualToLabel:"Greater than or equal to",lessThanOrEqualToLabel:"Less than or equal to",trueLabel:"True",falseLabel:"False",afterLabel:"After",beforeLabel:"Before",todayLabel:"Today",yesterdayLabel:"Yesterday",thisMonthLabel:"This month",lastMonthLabel:"Last month",nextMonthLabel:"Next month",thisYearLabel:"This year",lastYearLabel:"Last year",nextYearLabel:"Next year",clearLabel:"Clear Filter",noFilterLabel:"No",onLabel:"On",notOnLabel:"Not on",advancedButtonLabel:"Advanced",filterDialogCaptionLabel:"ADVANCED SEARCH",filterDialogConditionLabel1:"Show records matching ",filterDialogConditionLabel2:" of the following criteria",filterDialogOkLabel:"Search",filterDialogCancelLabel:"Cancel",filterDialogAnyLabel:"ANY",filterDialogAllLabel:"ALL",filterDialogAddLabel:"Add",filterDialogErrorLabel:"Maximum filters count exceeded.",filterSummaryTitleLabel:"Search results",filterSummaryTemplate:"${matches} matching records",filterDialogClearAllLabel:"Clear ALL",tooltipTemplate:"${condition} filter applied",featureChooserText:"Hide Filter",featureChooserTextHide:"Show Filter",featureChooserTextAdvancedFilter:"Advanced Filter",virtualizationSimpleFilteringNotAllowed:"When horizontal virtualization is enabled, simple filtering (filter row) is not supported. Please set mode to 'advanced' and/or do not enable advancedModeEditorsVisible",featureChooserNotReferenced:"Feature Chooser script is not referenced. To avoid receiving this error message please include the file ig.ui.grid.featurechooser.js or use loader or use one of the combined script files."}});$.ig.GridGroupBy=$.ig.GridGroupBy||{};$.extend($.ig.GridGroupBy,{locale:{emptyGroupByAreaContent:"Drag a column here or {0} to Group By",emptyGroupByAreaContentSelectColumns:"select columns",emptyGroupByAreaContentSelectColumnsCaption:"select columns",expandTooltip:"Expand Grouped Row",collapseTooltip:"Collapse Grouped Row",removeButtonTooltip:"Remove Grouped Column",featureChooserText:"Ungroup By",featureChooserTextHide:"Group By",modalDialogCaptionButtonDesc:"Click to sort ascending",modalDialogCaptionButtonAsc:"Click to sort descending",modalDialogCaptionButtonUngroup:"Click to ungroup",modalDialogGroupByButtonText:"Group By",modalDialogCaptionText:"Add to Group By",modalDialogDropDownLabel:"Showing:",modalDialogClearAllButtonLabel:"clear all",modalDialogRootLevelHierarchicalGrid:"root",modalDialogDropDownButtonCaption:"Click to show/hide",modalDialogButtonApplyText:"Apply",modalDialogButtonCancelText:"Cancel"}});$.ig.GridHiding=$.ig.GridHiding||{};$.extend($.ig.GridHiding,{locale:{columnChooserDisplayText:"Column Chooser",hiddenColumnIndicatorTooltipText:"Hidden Column(s)",columnHideText:"Hide",columnChooserCaptionLabel:"Column Chooser",columnChooserCheckboxesHeader:"view",columnChooserColumnsHeader:"column",columnChooserCloseButtonTooltip:"Close",hideColumnIconTooltip:"Hide",featureChooserNotReferenced:"Feature Chooser script is not referenced. To avoid receiving this error message please include the file ig.ui.grid.featurechooser.js or use one of the combined script files.",columnChooserShowText:"Show",columnChooserHideText:"Hide",columnChooserResetButtonLabel:"reset",columnChooserButtonApplyText:"Apply",columnChooserButtonCancelText:"Cancel"}});$.ig.GridPaging=$.ig.GridPaging||{};$.extend($.ig.GridPaging,{locale:{pageSizeDropDownLabel:"Show ",pageSizeDropDownTrailingLabel:"records",nextPageLabelText:"next",prevPageLabelText:"prev",firstPageLabelText:"",lastPageLabelText:"",currentPageDropDownLeadingLabel:"Pg",currentPageDropDownTrailingLabel:"of ${count}",currentPageDropDownTooltip:"Choose page index",pageSizeDropDownTooltip:"Choose number of records per page",pagerRecordsLabelTooltip:"Current records range",prevPageTooltip:"go to the previous page",nextPageTooltip:"go to the next page",firstPageTooltip:"go to the first page",lastPageTooltip:"go to the last page",pageTooltipFormat:"page ${index}",pagerRecordsLabelTemplate:"${startRecord} - ${endRecord} of ${recordCount} records"}});$.ig.GridRowSelectors=$.ig.GridRowSelectors||{};$.extend($.ig.GridRowSelectors,{locale:{selectionNotLoaded:"igGridSelection is not initialized. To avoid receiving this error message please enable the Selection feature for the grid or set the requireSelection property of the Row Selectors feature to false."}});$.ig.GridSorting=$.ig.GridSorting||{};$.extend($.ig.GridSorting,{locale:{sortedColumnTooltipFormat:"sorted ${direction}",unsortedColumnTooltip:"click to sort column",ascending:"ascending",descending:"descending",modalDialogSortByButtonText:"sort by",modalDialogResetButton:"reset",modalDialogCaptionButtonDesc:"Click to sort descending",modalDialogCaptionButtonAsc:"Click to sort ascending",modalDialogCaptionButtonUnsort:"Click to remove sorting",featureChooserText:"Sort on Multiple",modalDialogCaptionText:"Sort Multiple",modalDialogButtonApplyText:"Apply",modalDialogButtonCancelText:"Cancel",sortingHiddenColumnNotSupport:"Sorting hidden column is not supported",featureChooserSortAsc:"Sort A to Z",featureChooserSortDesc:"Sort Z to A"}});$.ig.GridSummaries=$.ig.GridSummaries||{};$.extend($.ig.GridSummaries,{locale:{featureChooserText:"Hide Summaries",featureChooserTextHide:"Show Summaries",dialogButtonOKText:"OK",dialogButtonCancelText:"Cancel",emptyCellText:"",summariesHeaderButtonTooltip:"Show/hide summaries",defaultSummaryRowDisplayLabelCount:"Count",defaultSummaryRowDisplayLabelMin:"Min",defaultSummaryRowDisplayLabelMax:"Max",defaultSummaryRowDisplayLabelSum:"Sum",defaultSummaryRowDisplayLabelAvg:"Avg",defaultSummaryRowDisplayLabelCustom:"Custom",calculateSummaryColumnKeyNotSpecified:"Please specify column key to calculate summary",featureChooserNotReferenced:"Feature Chooser script is not referenced. To avoid receiving this error message please include the file ig.ui.grid.featurechooser.js or use one of the combined script files."}});$.ig.GridUpdating=$.ig.GridUpdating||{};$.extend($.ig.GridUpdating,{locale:{doneLabel:"Done",doneTooltip:"Stop editing and update",cancelLabel:"Cancel",cancelTooltip:"Stop editing and do not update",addRowLabel:"Add new row",addRowTooltip:"Click to start adding new row",deleteRowLabel:"",deleteRowTooltip:"Delete row",igEditorException:"The updating for ui.igGrid requires ui.igEditor to be loaded",igComboException:"In order to use the combo type for ui.igGrid, the ui.igCombo should be loaded",igRatingException:"In order to use the igRating as editor for ui.igGrid, the ui.igRating should be loaded",igValidatorException:"Validation options defined in igGridUpdating require ui.igValidator to be loaded",noPrimaryKeyException:'In order to support update operations after a row was deleted, application should define "primaryKey" in options of igGrid.',hiddenColumnValidationException:"Cannot edit row which has a hidden column with enabled validation.",dataDirtyException:'Grid has pending transactions which may affect rendering of data. To prevent exception, application may enable "autoCommit" option of igGrid, or it should process "dataDirty" event of igGridUpdating and return false. While processing that event, application also may do "commit()" data in igGrid.',rowEditDialogCaptionLabel:"Edit row data"}});$.ig.ColumnMoving=$.ig.ColumnMoving||{};$.extend($.ig.ColumnMoving,{locale:{movingDialogButtonApplyText:"Apply",movingDialogButtonCancelText:"Cancel",movingDialogCaptionButtonDesc:"Move Down",movingDialogCaptionButtonAsc:"Move Up",movingDialogCaptionText:"Move Columns",movingDialogDisplayText:"Move Columns",dropDownMoveLeftText:"Move Left",dropDownMoveRightText:"Move Right",dropDownMoveFirstText:"Move First",dropDownMoveLastText:"Move Last",featureChooserNotReferenced:"Feature Chooser script is not referenced. To avoid receiving this error message please include the file ig.ui.grid.featurechooser.js or use one of the combined script files.",movingToolTipMove:"Move",featureChooserSubmenuText:"Move To"}});$.ig.ColumnFixing=$.ig.ColumnFixing||{};$.extend($.ig.ColumnFixing,{locale:{headerFixButtonText:"Click to fix this column",headerUnfixButtonText:"Click to unfix this column",featureChooserTextFixedColumn:"Fix column",featureChooserTextUnfixedColumn:"Unfix column",groupByNotSupported:"igGridGroupBy is not supported with ColumnFixing",virtualizationNotSupported:"Virtualization is not supported with ColumnFixing",columnMovingNotSupported:"igGridColumnMoving is not supported with ColumnFixing",hidingNotSupported:"igGridHiding is not supported with ColumnFixing",hierarchicalGridNotSupported:"igHierarchicalGrid is not supported with ColumnFixing",responsiveNotSupported:"igGridResponsive is not supported with ColumnFixing",noGridWidthHeightNotSupported:"When grid hasn't width and height Column Fixing is not supported"}});$.ig.GridLoadOnDemand=$.ig.GridLoadOnDemand||{};$.extend($.ig.GridLoadOnDemand,{locale:{loadMoreDataButtonText:"Load more data",loadOnDemandRequiresHeight:"Load On Demand feature requires height",groupByNotSupported:"igGridGroupBy is not supported with LoadOnDemand",pagingNotSupported:"igGridPaging is not supported with LoadOnDemand",cellMergingNotSupported:"igGridCellMerging is not supported with LoadOnDemand",virtualizationNotSupported:"virtualization is not supported with LoadOnDemand"}})}/*!@license
 * Infragistics.Web.ClientUI Grid 13.2.20132.2064
 *
 * Copyright (c) 2011-2014 Infragistics Inc.
 *
 * http://www.infragistics.com/
 *
 * Depends on: 
 *	jquery-1.4.4.js
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 *	infragistics.dataSource.js
 *	infragistics.ui.shared.js
 *	infragistics.util.js
 */
if(typeof jQuery!=="function"){throw new Error("jQuery is undefined")}(function($){var _hovTR,_aNull=function(val){return val===null||val===undefined};$.widget("ui.igGrid",{css:{baseClass:"ui-widget ui-helper-clearfix ui-corner-all",baseContentClass:"ui-widget-content",gridClasses:"ui-iggrid",recordClass:"ui-ig-record ui-iggrid-record",recordAltClass:"ui-ig-altrecord ui-iggrid-altrecord",headerClass:"ui-iggrid-header ui-widget-header",headerTextClass:"ui-iggrid-headertext",headerCellFeatureEnabledClass:"ui-iggrid-headercell-featureenabled",baseHeaderClass:"ui-widget-header",gridTableClass:"ui-iggrid-table ui-widget-content",gridHeaderTableClass:"ui-iggrid-headertable",gridFooterTableClass:"ui-iggrid-footertable ui-widget-footer",gridFooterClass:"",gridCaptionTableClass:"ui-iggrid-captiontable",gridHeaderCaptionClass:"ui-iggrid-headercaption ui-widget-header ui-corner-top",gridTableBodyClass:"ui-iggrid-tablebody",gridScrollDivClass:"ui-iggrid-scrolldiv ui-widget-content",gridFooterCaptionClass:"ui-iggrid-footercaption",deletedRecord:"ui-iggrid-deletedrecord",modifiedRecord:"ui-iggrid-modifiedrecord",rtl:"ui-iggrid-rtl"},options:{width:null,height:null,autoAdjustHeight:true,avgRowHeight:25,avgColumnWidth:null,defaultColumnWidth:null,autoGenerateColumns:true,virtualization:false,virtualizationMode:"fixed",requiresDataBinding:true,rowVirtualization:false,columnVirtualization:false,virtualizationMouseWheelStep:null,adjustVirtualHeights:false,rowTemplate:null,jQueryTemplating:false,templatingEngine:"infragistics",columns:[{headerText:null,key:null,formatter:null,format:null,dataType:"string",width:null,hidden:false,template:null,unbound:false,group:[],rowspan:0,formula:null,unboundValues:null}],dataSource:null,dataSourceUrl:null,dataSourceType:null,responseDataKey:null,responseTotalRecCountKey:null,requestType:"GET",responseContentType:"application/json; charset=utf-8",showHeader:true,showFooter:true,fixedHeaders:true,fixedFooters:true,caption:null,features:[{}],tabIndex:0,accessibilityRendering:false,localSchemaTransform:true,primaryKey:null,serializeTransactionLog:true,autoCommit:false,aggregateTransactions:false,autoFormat:"date",renderCheckboxes:false,updateUrl:null,restSettings:{create:{url:null,template:null,batch:false},update:{url:null,template:null,batch:false},remove:{url:null,template:null,batch:false},encodeRemoveInRequestUri:true,contentSerializer:null,contentType:"application/json; charset=utf-8"},alternateRowStyles:true,autofitLastColumn:true,enableHoverStyles:true,enableUTCDates:false,mergeUnboundColumns:false,jsonpRequest:null},events:{cellClick:"cellClick",dataBinding:"dataBinding",dataBound:"dataBound",rendering:"rendering",rendered:"rendered",dataRendering:"dataRendering",dataRendered:"dataRendered",headerRendering:"headerRendering",headerRendered:"headerRendered",footerRendering:"footerRendering",footerRendered:"footerRendered",headerCellRendered:"headerCellRendered",rowsRendering:"rowsRendering",rowsRendered:"rowsRendered",schemaGenerated:"schemaGenerated",columnsCollectionModified:"columnsCollectionModified",requestError:"requestError",created:"igcontrolcreated",destroyed:"igcontroldestroyed"},resizeTimeout:300,speedupDOMCleanup:false,widget:function(){return this.element},_createWidget:function(options,element){this.options.columns=[];this.options.features=[];if(options.dataSource&&($.type(options.dataSource)==="array"||$.type(options.dataSource)==="object")){this.tmpDataSource=options.dataSource;options.dataSource=null;this._originalOptions=options}$.Widget.prototype._createWidget.apply(this,arguments)},_setOption:function(key,value){var header,isScrolling,hasWidthInPercent=this._gridHasWidthInPercent();if(value===this.options[key]){return}isScrolling=this.options.height!==null||this.options.width!==null;$.Widget.prototype._setOption.apply(this,arguments);if(key==="virtualization"||key==="autoGenerateColumns"||key==="accessibilityRendering"||key==="rowVirtualization"||key==="columnVirtualization"||key==="fixedHeaders"||key==="scrollbars"){throw new Error($.ig.Grid.locale.optionChangeNotSupported+" "+key)}if(key==="width"){if(isScrolling===true){this.container().css("width",value);this.element.css("width",value);if(this.options.fixedHeaders){this.headersTable().css("width",value)}if(!this._allColumnWidthsInPercentage||!hasWidthInPercent){if(this.options.virtualization===true||this.options.columnVirtualization===true||this.options.rowVirtualization===true){this._gridInnerWidth=this._vdisplaycontainer().width()+this._scrollbarWidth()}else{this._gridInnerWidth=this.scrollContainer().width()}}if(this.options.width!==null&&this.options.height!==null){this._updateGridContentWidth()}}else{throw new Error($.ig.Grid.locale.optionChangeNotScrollingGrid+" "+key)}}else if(key==="height"){if(isScrolling===true){this.scrollContainer().css("overflow-y","auto");if(this.options.autoAdjustHeight){this.container().css("height",value);this._virtualHeightReset=true;this._initializeHeights()}else{this.scrollContainer().css("height",value)}}else{throw new Error($.ig.Grid.locale.optionChangeNotScrollingGrid+" "+key)}}else if(key==="dataSource"){this.options.dataSource=value;this.dataBind();this._adjustLastColumnWidth(true)}else if(key==="showHeader"){header=this.headersTable();if(header.length>0&&header.is("table")){if(value===true){header.show()}else{header.hide()}}else{header=this.element.find("thead tr");if(value===true){header.show()}else{header.hide()}}}else if(key==="caption"){this._caption().text(value)}else if(key==="rowTemplate"){this.setRowTemplate(value,false)}},_initialized:false,_headersInitialized:false,_footerInitialized:false,_create:function(){var grid=this,i;this._isHierarchicalGrid=false;this._hasUnboundColumns=false;if(this.options._isHierarchicalGrid===true){this._isHierarchicalGrid=true}this._rtl=this.element.css("direction")==="rtl";this._padding=this._rtl?"padding-left":"padding-right";this._tmap=null;if(this.tmpDataSource!==null&&this.tmpDataSource!==undefined){this.options.dataSource=this.tmpDataSource;this._originalOptions.dataSource=this.tmpDataSource}this._testInnerHtml();this._headerInitCallbacks=[];this._footerInitCallbacks=[];this._firstBind=true;this._hasOptionsRowTemplate=grid.options.rowTemplate!==null&&grid.options.rowTemplate!==undefined;this._isMultiColumnGrid=false;this._unboundValues={};if(this._isMultiColumnHeader()===true){this._isMultiColumnGrid=true;this._generateColumnFlatStructure(this.options.columns);this._headerCells=[]}if(this.options.rowVirtualization===true&&this.options.virtualizationMode==="continuous"){this.options.virtualization=true}if(this.options.columnVirtualization===true){this.options.virtualization=true;if(this.options.virtualizationMode==="continuous"){throw new Error($.ig.Grid.locale.colVirtualizationDenied)}this.options.virtualizationMode="fixed"}if(this.options.virtualization===true||this.options.columnVirtualization===true||this.options.rowVirtualization===true){if(this.options.virtualizationMode===undefined||this.options.virtualizationMode===""){this.options.virtualizationMode="fixed"}if(this.options.virtualizationMode==="fixed"){this.options.fixedHeaders=true;this.options.fixedFooters=true}}if(this.options.virtualization===true&&this.options.virtualizationMode==="continuous"){this.options.fixedHeaders=true}if((this.options.height===null||parseInt(this.options.height,10)<=0)&&this.options.fixedHeaders===true){this.options.fixedHeaders=false}if((this.options.height===null||parseInt(this.options.height,10)<=0)&&this.options.fixedFooters===true){this.options.fixedFooters=false}this.dataBind(true);this._cellClickHandler=function(event){var row=$(event.target).closest("tr"),key=row.attr("data-id"),colKey,$td,res,colIndex=$(event.target).closest("td").index(),dataColIndex=colIndex-row.children("td.ui-iggrid-expandcolumn,th").length;if(key===""||key===null||key===undefined){key=row.index()}if(grid.hasFixedColumns()){$td=$(event.target);if(!$td.is("td")){$td=$(event.target).closest("td")}if($td.length===1){res=grid._getColumnByTD($td);if(res!==null){colKey=res.column.key;colIndex=res.index}}}else{if(dataColIndex>=0&&dataColIndex<grid._visibleColumns().length){colKey=grid._visibleColumns()[dataColIndex].key}}if($(event.target).is("td")||$(event.target).closest("td").length===1&&$(event.target).closest("td").parent().attr("data-container")!=="true"){grid._trigger(grid.events.cellClick,event,{rowIndex:row.index(),rowKey:key,colIndex:colIndex,colKey:colKey,cellElement:event.target,owner:grid})}};this.element.bind({click:this._cellClickHandler});if(this.options.height!==null&&this.options.height.indexOf&&this.options.height.indexOf("%")!==-1||this.options.height!==null&&this.options.width!==null){if(!this.element.is(":visible")){this._recheckVisibility=true}this._resId=setInterval($.proxy(this._resizeContainer,this),this.resizeTimeout)}for(i=0;i<this.options.columns.length;i++){if(this.options.columns[i].hidden===undefined){this.options.columns[i].hidden=false}}this._uiSoftDirtyHandler=$.proxy(this._onFeaturesSoftDirty,this);this.element.bind("iggriduisoftdirty",this._uiSoftDirtyHandler);this._oldScrollTop=0;this.element.trigger(this.events.created,{owner:this});if(this._rtl){this.container().addClass(this.css.rtl)}},hasFixedDataSkippedColumns:function(){return this._hasFixedDataSkippedColumns},hasFixedColumns:function(){if(this._hasFixedDataSkippedColumns||this._fixedColumns!==null&&this._fixedColumns!==undefined&&this._fixedColumns.length>0){return true}return false},isFixedColumn:function(colKey){var isFixed=false,typeColKey=$.type(colKey),cols;if(!this.hasFixedColumns()){return false}if(typeColKey==="string"){$.each(this._fixedColumns,function(ind,c){if(c.key===colKey){isFixed=true;return false}})}else if(typeColKey==="number"){cols=this._visibleColumns();if(colKey<0||colKey>=cols.length){return false}isFixed=cols[colKey].fixed===true}return isFixed},_onColumnFixed:function(colInd,isFixed,colsCount,isInit,visibleIndex){var result={colInd:colInd,isFixed:isFixed,fixedColsCount:colsCount,isInit:isInit,visibleIndex:visibleIndex};this._fireInternalEvent("_columnFixed",result)},_testInnerHtml:function(){var t=document.createElement("table");try{t.innerHTML="<tr><td> t </td></tr>";this._canreplaceinner=true}catch(e){this._canreplaceinner=false}},_resizeContainer:function(){var scrollContainerWidth,o=this.options,visibilityChanged=false,v=o.virtualization===true||o.rowVirtualization===true||o.columnVirtualization===true;if(this._recheckVisibility&&this.element.is(":visible")){this._prevContainerHeight=0;visibilityChanged=true;this._recheckVisibility=false}if(o.autoAdjustHeight&&this.container().height()!==this._prevContainerHeight){this._initializeHeights();if(v&&visibilityChanged){this._avgRowHeight=null;this._updateVirtualScrollContainer();this._onVirtualVerticalScroll()}}if(o.width!==null&&o.height!==null){if(v===false){scrollContainerWidth=this.scrollContainer().width()}else{scrollContainerWidth=this._vdisplaycontainer().width()+this._scrollbarWidth()}if(this._gridInnerWidth!==scrollContainerWidth&&(this._gridInnerWidth>0||scrollContainerWidth>0)){this._gridInnerWidth=scrollContainerWidth;this._updateHScrollbarVisibility()}}},_isMultiColumnHeader:function(){var cols=this.options.columns,i;for(i=0;i<cols.length;i++){if(cols[i].group!==undefined&&cols[i].group!==null){return true}}return false},_analyzeMultiColumnHeaders:function(cols,newCols,level,oldCols,children,isHidden){var i,j,res,colsLength=cols.length,colspan=0,ind=[],groupChildren=[],identifier,hidden;for(i=0;i<colsLength;i++){if(cols[i].group!==undefined&&cols[i].group!==null){if(cols[i].key!==undefined&&cols[i].key!==null){identifier=cols[i].key.toString()}else{identifier=(this._multiColumnIdentifier++).toString()}if(!cols[i].identifier){cols[i].identifier=identifier}groupChildren=[];hidden=false;if(isHidden===true||cols[i].hidden===true){hidden=true}res=this._analyzeMultiColumnHeaders(cols[i].group,newCols,level+1,oldCols[i].group,groupChildren,hidden);oldCols[i].colspan=res.colspan;oldCols[i].children=groupChildren;for(j=0;j<groupChildren.length;j++){children.push(groupChildren[j])}ind.push(i);colspan+=res.colspan}else{colspan++;oldCols[i].level=0;oldCols[i].level0=true;if(isHidden===true){cols[i].hidden=true}children.push(cols[i]);newCols.push(cols[i])}}for(j=0;j<ind.length;j++){oldCols[ind[j]].level=this._maxLevel-level}return{colspan:colspan}},_getMultiHeaderColumnById:function(id,level,cols){var i,colsLength,res=null;if(cols===null||cols===undefined){if(this._oldCols===null||this._oldCols===undefined){return null}cols=this._oldCols}colsLength=cols.length;for(i=0;i<colsLength;i++){if(cols[i].identifier===id&&(level===undefined||cols[i].level===level)){return cols[i]}if(cols[i].group!==null&&cols[i].group!==undefined){res=this._getMultiHeaderColumnById(id,level,cols[i].group);if(res!==null){return res}}}return null},_getMaxLevelRecursive:function(level,cols){var i,colsLength=cols.length,ml=level,l,rowspan;for(i=0;i<colsLength;i++){rowspan=1;if(cols[i].rowspan!==null&&cols[i].rowspan!==undefined&&cols[i].rowspan>0){rowspan=cols[i].rowspan}if(cols[i].group!==undefined&&cols[i].group!==null){l=this._getMaxLevelRecursive(level+rowspan,cols[i].group);if(l>ml){ml=l}}else if(rowspan>0){l=level+rowspan-1;if(l>ml){ml=l}}}return ml},_headerInit:function(tr,colgroup,prepend){var i;for(i=0;i<this._headerInitCallbacks.length;i++){this._headerInitCallbacks[i].func(tr,colgroup,prepend)}},_footerInit:function(tr,colgroup,prepend,cssClass){var i;for(i=0;i<this._footerInitCallbacks.length;i++){this._footerInitCallbacks[i].func(tr,colgroup,prepend,cssClass)}},id:function(){return this.element[0].id},_caption:function(){return this.container().find("caption")},container:function(){if(!this._container||this._container.length===0){this._container=this.element.closest("div[id="+this.id()+"_container]")}return this._container},headersTable:function(){if(this.options.fixedHeaders===true&&this.options.height!==null){return this.container().find("#"+this.id()+"_headers")}return this.element},footersTable:function(){if(this.options.fixedFooters===true&&this.options.height!==null){return this.container().find("#"+this.id()+"_footers")}return this.element},scrollContainer:function(){return this.container().children("#"+this.id()+"_scroll")},fixedContainer:function(){return this.container().find("#"+this.id()+"_mainFixedContainer")},fixedBodyContainer:function(){return this.container().find("#"+this.id()+"_fixedBodyContainer")},fixedFooterContainer:function(){return this.container().find("#"+this.id()+"_fixedFooterContainer")},fixedHeaderContainer:function(){return this.container().find("#"+this.id()+"_fixedHeaderContainer")},fixedHeadersTable:function(){if(this.options.fixedHeaders===true&&this.options.height!==null){return this.container().find("#"+this.id()+"_headers_fixed")}return this.container().find("#"+this.id()+"_fixed")},fixedFootersTable:function(){if(this.options.fixedFooters===true&&this.options.height!==null){return this.container().find("#"+this.id()+"_footers_fixed")}return this.container().find("#"+this.id()+"_fixed")},_vdisplaycontainer:function(){return this.container().find("#"+this.id()+"_displayContainer")},_virtualcontainer:function(){return this.container().find("#"+this.id()+"_virtualContainer")},_vhorizontalcontainer:function(){return this.container().find("#"+this.id()+"_horizontalScrollContainer")},_fixedfooters:function(){return this.container().find("#"+this.id()+"_footer_container")},cellAt:function(x,y,isFixed){var i;if(x===undefined||y===undefined){return null}if(this.table===undefined){this.table=this.element[0]}i=this._dataRowIndex(y);if(isFixed===true){if(this._fixedTable===undefined){this._fixedTable=this.element}return this._fixedTable[0].rows[i].cells[x]}return this.table.rows[i].cells[x]},fixedTable:function(){if(this._fixedTable===undefined){this._fixedTable=this.element[0]}return this._fixedTable},_calculateHeaderFooterRows:function(){var theadCount=0,tfootCount=0;theadCount=this.element.children("thead").children("tr").length;if($.ig.util.isOpera){tfootCount=this.element.children("tfoot").children("tr").length}return theadCount+tfootCount},_dataRowIndex:function(i){var extrahr,j;if(this.table===undefined){this.table=this.element[0]}if(this._additionalTrCount===undefined||this._additionalTrCount===null){this._additionalTrCount=this._calculateHeaderFooterRows()}if(this._hc===true){extrahr=this.element.children("tbody").children("tr[data-container]");for(j=0;j<extrahr.length;j++){if($(extrahr[j]).index()<=i){i+=1}}}i=i+this._additionalTrCount;if(i>=this.table.rows.length){i=this.table.rows.length-1}else if(i<0){i=0}return i},immediateChildrenWidgets:function(){return this.element.children("tbody").children("tr").children(".ui-iggrid-childarea").children("div").children("div").map(function(){if($(this).children(".ui-iggrid-scrolldiv").length>0){return $(this).children(".ui-iggrid-scrolldiv").children(".ui-iggrid-table").data("igGrid")}return $(this).children(".ui-iggrid-table").data("igGrid")})},childrenWidgets:function(){return this.element.find("tbody > tr > .ui-iggrid-childarea").find(".ui-iggrid-table").map(function(){return $(this).data("igGrid")})},children:function(){return this.element.find("tbody > tr > .ui-iggrid-childarea").find(".ui-iggrid-table")},immediateChildren:function(){return this.element.children("tbody").children("tr").children(".ui-iggrid-childarea").children("div").children("div").map(function(){if($(this).children(".ui-iggrid-scrolldiv").length>0){return $(this).children(".ui-iggrid-scrolldiv").children(".ui-iggrid-table")}return $(this).children(".ui-iggrid-table")})},rowAt:function(i){i=this._dataRowIndex(i);return this.table.rows[i]},fixedRowAt:function(i){var rows=this.fixedBodyContainer().find("tbody>tr");if(rows.length>0){return rows[i]}return null},fixedRows:function(){return this.fixedBodyContainer().children("tbody").children("tr")},rows:function(){return this.element.children("tbody").children("tr")},allFixedRows:function(){return this.fixedBodyContainer().find("tbody tr")},allRows:function(){return this.element.find("tbody tr")},columnByKey:function(key){var cols=this.options.columns,i;for(i=0;i<cols.length;i++){if(String(cols[i].key)===String(key)){return cols[i]}}return null},columnByText:function(text){var cols=this.options.columns,i;for(i=0;i<cols.length;i++){if(cols[i].headerText===text){return cols[i]}}return null},activeCell:function(){return this._activeCell},activeRow:function(){if(this._activeRow){if(this.hasFixedColumns()){if(this._activeFixedRow){this._activeRow.fixedElement=this._activeFixedRow.element}else{this._activeRow.fixedElement=this.fixedBodyContainer().find("tbody tr:nth-child("+(this._activeRow.index+1)+")")}}else if(this._activeRow.fixedElement){this._activeRow.fixedElement=null}}return this._activeRow},selectedCell:function(){return this._selectedCell},selectedRow:function(){return this._selectedRow},selectedCells:function(){return this._selectedCells},selectedRows:function(){return this._selectedRows},getCellValue:function(rowId,colKey){var id=parseInt(rowId,10),i,cols=this.options.columns,colFound=false,rec,primaryKeyCol,tx;tx=this.dataSource.pendingTransactions();if(this.options.autoCommit===false&&tx.length>0){for(i=0;i<tx.length;i++){if(tx[i].rowId===rowId){if(tx[i].type==="cell"&&tx[i].col===colKey){return tx[i].value}if(tx[i].type==="row"||tx[i].type==="newrow"){return tx[i].row[colKey]}}}}if(this.options.primaryKey!==null){primaryKeyCol=this.columnByKey(this.options.primaryKey);if(primaryKeyCol.dataType==="number"||primaryKeyCol.dataType==="numeric"){rec=this.dataSource.findRecordByKey(parseInt(rowId,10))}else{rec=this.dataSource.findRecordByKey(rowId)}if(rec===null||rec===undefined){throw new Error($.ig.Grid.locale.recordNotFound+" "+rowId)}return rec[colKey]}if(id>=this.dataSource.dataView().length){throw new Error($.ig.Grid.locale.indexOutOfRange)}if($.type(colKey)==="string"){for(i=0;i<cols.length;i++){if(cols[i].key===colKey){colFound=true;break}}if(colFound===false){throw new Error($.ig.Grid.locale.noSuchColumnDefined)}return this.dataSource.dataView()[id][colKey]}if(cols.length<=colKey){throw new Error($.ig.Grid.locale.columnIndexOutOfRange)}return this.dataSource.dataView()[id][colKey]},getCellText:function(rowId,colKey){var i,cols=this.options.columns,colIndex,primaryKeyIndex,skippedCells=0,parent;if($.type(colKey)==="string"){for(i=0;i<cols.length;i++){if(cols[i].key===colKey){colIndex=i;break}}}else{colIndex=colKey}if(colIndex===undefined){throw new Error($.ig.Grid.locale.columnNotFound+" "+colKey)}if(this.options.primaryKey!==null){for(i=0;i<cols.length;i++){if(cols[i].key===this.options.primaryKey){primaryKeyIndex=i;break}}if(primaryKeyIndex===undefined){throw new Error($.ig.Grid.locale.columnNotFound+" "+this.options.primaryKey)}parent=this.element.find("[data-id="+rowId+"]");skippedCells=parent.children("[data-skip=true]").length;skippedCells+=parent.children("[data-parent=true]").length;return parent.children("td:nth-child("+(colIndex+1+skippedCells)+")").text()}return $(this.cellAt(colIndex,parseInt(rowId,10))).text()},setRowTemplate:function(tmpl,render){this.options.rowTemplate=tmpl;this._tmap=null;render=render===null||render===undefined?true:render;if(render){this._renderData()}},setColumnTemplate:function(col,tmpl,render){var colIdx=this._getColIdxById(this.options.columns,col);if(colIdx===null||colIdx===undefined){return}col=this.options.columns[colIdx];col.template=tmpl;this.options.rowTemplate=this._buildRowTemplateRaw(true);this._tmap=null;render=render===null||render===undefined?true:render;if(render&&!col.hidden){this._renderData()}},commit:function(id){var key;key=this._normalizedKey(id);this.dataSource.commit(key);if(this.options.virtualization||this.options.rowVirtualization||this.options.columnVirtualization){this._renderVirtualRecords()}else{this._renderData()}},rollback:function(id,updateUI){var rec,tr,primaryKeyIndex,cols=this.options.columns,key,i;key=this._normalizedKey(id);this.dataSource.rollback(key);if(updateUI===true&&id!==null&&id!==undefined){if(this.options.primaryKey!==null){rec=this.dataSource.findRecordByKey(key);if(rec===undefined||rec===null){throw new Error($.ig.Grid.locale.recordNotFound+" "+id)}for(i=0;i<cols.length;i++){if(cols[i].key===this.options.primaryKey){primaryKeyIndex=i;break}}if(primaryKeyIndex===undefined){throw new Error($.ig.Grid.locale.columnNotFound+" "+this.options.primaryKey)}tr=this.element.find("td:nth-child("+(primaryKeyIndex+1)+"):contains('"+id+"')").parent()[0]}else{if(parseInt(id,10)>=this.dataSource.dataView().length){throw new Error($.ig.Grid.locale.indexOutOfRange)}rec=this.dataSource.dataView()[parseInt(id,10)];tr=this.rowAt(parseInt(id,10))}$(tr).removeClass(this.css.deletedRecord);tr._deleted=null;this._renderRow(rec,tr)}else if(id===true||updateUI===true){this.dataBind()}if((updateUI===true||updateUI===undefined)&&(id===undefined||id===null)){this._renderData()}},findRecordByKey:function(key){return this.dataSource.findRecordByKey(key)},getDetachedRecord:function(t){return this.dataSource.getDetachedRecord(t)},pendingTransactions:function(){return this.dataSource.pendingTransactions()},allTransactions:function(){return this.dataSource.allTransactions()},transactionsAsString:function(){return this.dataSource.transactionsAsString()},_normalizedKey:function(id){var key,primaryKeyCol;if(id===undefined||id===null){return null}key=id;if(this.options.primaryKey!==null){primaryKeyCol=this.columnByKey(this.options.primaryKey);if(primaryKeyCol.dataType==="number"||primaryKeyCol.dataType==="numeric"){key=parseInt(id,10)}}else{key=parseInt(id,10)}return key},saveChanges:function(success,error){this.dataSource.saveChanges(success,error)},_renderRow:function(rec,tr,rowId){var i,td,col,id=0,css,cols=this.options.columns,content,index;for(i=0;i<tr.cells.length;i++){td=$(tr.cells[i]);css=td[0].className;if(id>0||!(td.attr("data-skip")||css&&(css.indexOf("-expandcolumn")>0||css.indexOf("-rowselector")>0))){while(true){col=cols[id];if(!col){return tr}if(!col.hidden){break}id++}if(this.options.rowTemplate&&this.options.rowTemplate.length>0){content=this._renderTemplatedCell(rec,col);index=content.indexOf(">");content=content.substring(index+1,content.length);td.html(content)}else{td.html(this._renderCell(rec[col.key],col,rec))}id++}}return tr},renderNewRow:function(rec,key){var tbody=this.element.children("tbody"),index,self=this,virt=this.options.virtualization===true||this.options.rowVirtualization===true,fv=this.options.virtualizationMode==="fixed";if(virt){if(fv){this._buildVirtualDom()}else{this._renderVirtualRecordsContinuous();this._startRowIndex=0}this.virtualScrollTo(this._totalRowCount)}else{index=tbody.children('[data-container!="true"]').length;MSApp.execUnsafeLocalFunction(function(){tbody.append(self._renderRecord(rec,index))})}},_findTableRowByKey:function(key){var primaryKeyIndex,cols=this.options.columns,r,i;if(this.options.primaryKey!==null){for(i=0;i<cols.length;i++){if(cols[i].key===this.options.primaryKey){primaryKeyIndex=i;break}}if(primaryKeyIndex===undefined){throw new Error($.ig.Grid.locale.columnNotFound+" "+this.options.primaryKey)}r=this.element.find("td:nth-child('"+(primaryKeyIndex+1)+"'):contains('"+key+"')").parent();return r.length===0?null:r[0]}return this.rowAt(parseInt(key,10))},dataSourceObject:function(dataSource){if(dataSource!==undefined){this.options.dataSource=dataSource}else{return this.options.dataSource}},totalRecordsCount:function(){return this.dataSource.totalRecordsCount()},dataBind:function(internal){var dataOptions,i,noCancel=true,noCancelRendering=true;if(!this._initialized){noCancelRendering=this._trigger(this.events.rendering,null,{owner:this})}if(noCancelRendering){noCancel=this._trigger(this.events.dataBinding,null,{owner:this});if(internal===undefined){this.options.requiresDataBinding=true}if(noCancel){if(this.options.requiresDataBinding){if(this._hasUnboundColumns){this._rebindUnboundColumns=true}dataOptions=this._generateDataSourceOptions(this.options);this._setupDataSource(dataOptions);this._dataOptions=dataOptions;if(!this._initialized){if(this.element.is("div")){this._isWrapped=true;this.element=$("<table></table>").appendTo(this.element).attr("id",this.id()+"_table");this.element.data("igGrid",this)}for(i=0;i<this.options.features.length;i++){this._initFeature(this.options.features[i],dataOptions)}if(this.options.autoGenerateColumns!==true){this._captureInitiallyHiddenColumns()}this._visibleColumnsArray=undefined}else{this._isDataBoundCalled=true;this.element.trigger("iggriduidirty",{owner:this});for(i=0;i<this.options.features.length;i++){this._initFeatureSettings(this.options.features[i])}this._trigger("headerExtraCellsModified",null,{owner:this})}this._renderGrid();if(this._loadingIndicator===undefined){this._initLoadingIndicator()}if(this._loadingIndicator){this._loadingIndicator.show()}this.dataSource.dataBind();this.options.requiresDataBinding=false}else{this._renderGrid()}}}else{this._cancelRendering=true}},_mergeUnboundValues:function(){var i,primaryKeyCol,metadataUC,rec,ucLength,primaryKeyColIsNumber,col,schema,type,dataLength,data,key,val,j,pk=this.options.primaryKey,metadata=this.dataSource.metadata("unboundValues"),self=this,hasPrimaryKey=pk!==null&&pk!==undefined,metaDataMergeFunction;if(metadata===undefined||metadata===null||metadata.length===0||!this._unboundColumns){return}if(hasPrimaryKey){metaDataMergeFunction=function(ind,val){if(primaryKeyColIsNumber){rec=self.dataSource.findRecordByKey(parseInt(ind,10))}else{rec=self.dataSource.findRecordByKey(ind)}if(rec===null||rec===undefined){return true}if(schema!==undefined&&schema!==null){val=schema._convertType(type,val,rec[pk],key)}self._addUnboundColumnValue(key,val);rec[key]=val};primaryKeyCol=this.columnByKey(pk);primaryKeyColIsNumber=primaryKeyCol.dataType==="number"}ucLength=this._unboundColumns.length;schema=this.dataSource.schema();for(i=0;i<ucLength;i++){key=this._unboundColumns[i].key;metadataUC=metadata[key];if(metadataUC===null||metadataUC===undefined){continue}col=this.getUnboundColumnByKey(key);type=null;if(col!==null&&col.dataType){type=col.dataType}if(hasPrimaryKey){$.each(metadataUC,metaDataMergeFunction)}else{self.setUnboundValues(key,metadataUC)}if(type==="bool"||type==="boolean"){data=this.dataSource.data();val=schema._convertType(type,undefined);dataLength=data.length;if(dataLength<=metadataUC.length){continue}for(j=0;j<dataLength;j++){if(data[j][key]===undefined){data[j][key]=val}}}}},_generateDataSourceOptions:function(options){var schema,dataOptions,t,headers,i;if(!this.options.dataSource&&!this.options.dataSourceUrl&&this.element.is("table")&&this.element.find("tbody").children().length>0){this.options.dataSource=this.element[0]}if(this.options.dataSource&&this.options.dataSource.tagName&&this.options.dataSource.nodeType){t=$(this.options.dataSource);if(t.is("table")&&t.find("thead th").length>0){headers=t.find("thead tr th");this._tb_h=true;this._tb_h_arr=[];for(i=0;i<headers.length;i++){this._tb_h_arr.push($(headers[i]).text())}}}dataOptions={callback:$.proxy(this._renderData,this),callee:this,responseDataKey:this.options.responseDataKey,responseTotalRecCountKey:this.options.responseTotalRecCountKey,dataSource:this.options.dataSource,requestType:this.options.requestType,responseContentType:this.options.responseContentType,primaryKey:this.options.primaryKey,localSchemaTransform:this.options.localSchemaTransform,autoCommit:this.options.autoCommit,aggregateTransactions:this.options.aggregateTransactions,serializeTransactionLog:this.options.serializeTransactionLog,updateUrl:this.options.updateUrl,restSettings:this.options.restSettings};if(this.options.dataSourceType!==null){dataOptions.type=this.options.dataSourceType}if(!this.options.dataSource||!this.options.dataSource.schema||!this.options.dataSource.schema()||this.options.dataSource.schema()._type!=="xml"){schema=this._generateDataSourceSchema()}if(this.options.dataSource instanceof $.ig.DataSource&&(this.options.dataSource.settings.schema===null||!this.options.dataSource.settings.schema.fields||this.options.dataSource.settings.schema.fields&&this.options.dataSource.settings.schema.fields.length>=0)||!(this.options.dataSource instanceof $.ig.DataSource)){dataOptions=$.extend(dataOptions,{schema:schema})}return dataOptions},_insertUnboundColumn:function(column){if(this._unboundColumns===null||this._unboundColumns===undefined){this._unboundColumns=[]}this._unboundColumns.push(column);if(column.key&&(this._unboundValues[column.key]===null||this._unboundValues[column.key]===undefined)){this._unboundValues[column.key]=[]}if(column.unboundValues&&column.unboundValues.length>0){this._isToSetUnboundColumns=true}this._hasUnboundColumns=true},_addUnboundColumnValue:function(key,value,index){if(this._unboundValues[key]===null||this._unboundValues[key]===undefined){this._unboundValues[key]=[]}if(index!==undefined&&index!==null){this._unboundValues[key][index]=value}else{this._unboundValues[key].push(value)}},_generateDataSourceSchema:function(){var schema,i,rec,prop,count=0,cols=this.options.columns,ds=this.options.dataSource,cl,counter=0;if(ds instanceof $.ig.DataSource){if($.type(ds.settings.dataSource)==="array"||$.type(ds.settings.dataSource)==="object"){ds=ds.settings.dataSource}else if($.type(ds.settings.dataSource)!=="string"){ds=ds.data()}else{ds=[]}}if($.type(ds)==="object"&&this.options.responseDataKey){ds=$.ig.findPath(ds,this.options.responseDataKey)}schema={};schema.fields=[];schema.searchField=this.options.responseDataKey;if(cols.length>0&&!this.options.autoGenerateColumns){for(i=0;i<cols.length;i++){if(cols[i].unbound===true||cols[i].unboundDS===true){this._insertUnboundColumn(cols[i]);if(cols[i].unbound===true){continue}}schema.fields[counter]={};schema.fields[counter].name=cols[i].key;schema.fields[counter].type=cols[i].dataType;counter++}}else if(this.options.autoGenerateColumns){if(ds&&ds.tagName&&$(ds).is("table")&&$(ds).find("tbody tr").length>0){rec=$(ds).find("tbody tr")[0];
$(rec).find("td").each(function(){if(cols.length>count){schema.fields.push({name:cols[count].key||count+1,type:cols[count].dataType||"string"})}else{schema.fields.push({name:count+1,type:"string"})}count++})}else if(ds&&ds.length&&ds.length>0&&$.type(ds)==="array"){for(i=0;i<ds.length;i++){rec=ds[i];for(prop in rec){if(rec.hasOwnProperty(prop)){if(this.columnByKey(prop)===null&&!this._fieldExists(prop,schema)&&$.type(rec[prop])!=="object"&&$.type(rec[prop])!=="array"){schema.fields.push({name:prop,type:$.ig.getColType(rec[prop])})}else if(this.columnByKey(prop)!==null){schema.fields.push({name:prop,type:this.columnByKey(prop).dataType})}count++}}if(!this.options._recurseSchema){break}}}for(i=0;i<cols.length;i++){if(cols[i].unbound===true||cols[i].unboundDS===true){this._insertUnboundColumn(cols[i])}}}this._trigger(this.events.schemaGenerated,null,{owner:this,schema:schema,dataSource:ds});cl=this.options.columnLayouts;if(cl&&cl.length&&cl.length>0){for(i=0;i<cl.length;i++){schema.fields.push({name:cl[i].key})}}return schema},_fieldExists:function(prop,schema){var i;for(i=0;i<schema.fields.length;i++){if(schema.fields[i].name===prop){return true}}return false},_setupDataSource:function(dataOptions){var callee;if(!(this.options.dataSource instanceof $.ig.DataSource)){if($.type(dataOptions.dataSource)==="string"&&(this.options.jsonpRequest||$.ig.util.isJsonpUrl(dataOptions.dataSource))){this.dataSource=new $.ig.JSONPDataSource(dataOptions)}else if(this.options.restSettings.update.url!==null||this.options.restSettings.update.template!==null||this.options.restSettings.create.url!==null||this.options.restSettings.create.template!==null||this.options.restSettings.remove.url!==null||this.options.restSettings.remove.template!==null){this.dataSource=new $.ig.RESTDataSource(dataOptions)}else{this.dataSource=new $.ig.DataSource(dataOptions)}}else{this.dataSource=this.options.dataSource;if(this.dataSource.settings.responseDataKey!==null){delete dataOptions.responseDataKey;if(dataOptions.schema){dataOptions.schema.searchField=this.dataSource.settings.responseDataKey}}this._tds=this.dataSource.settings.dataSource;this.dataSource.settings.dataSource=null;if($.ig.util.isIE8&&dataOptions.callee){callee=dataOptions.callee;dataOptions.callee=null}this.dataSource.settings=$.extend(true,{},this.dataSource.settings,dataOptions);if($.ig.util.isIE8&&callee){this.dataSource.settings.callee=callee}this.dataSource.settings.dataSource=this._tds;this._tds=null;if(dataOptions.schema){this.dataSource._initSchema()}}},_generateColumns:function(){var r,key,i,hasExplicitCols=this.options.columns.length>0,hasHeaders=false,len,col,isTable=false,arr=[],ds=this.options.dataSource,cdp=this.options.childrenDataProperty,newDs,colType;if(ds instanceof $.ig.DataSource){ds=ds.data()}else if(typeof ds==="string"){ds=this.dataSource.data()}if($.type(ds)==="object"&&this.options.responseDataKey){newDs=$.ig.findPath(ds,this.options.responseDataKey);if($.type(newDs)==="array"){ds=newDs}}if(ds&&ds.tagName&&$(ds).is("table")){len=$(ds).find("tbody tr").length;isTable=true}else if(ds&&ds.length){len=ds.length}if(ds&&len&&len===0&&this.options.columns.length===0){throw new Error($.ig.Grid.locale.autoGenerateColumnsNoRecords)}if(ds&&len&&len>0){if(isTable){r=$(ds).find("tbody tr")[0]}else{r=ds[0]}if($.type(r)==="array"||isTable){hasHeaders=this._tb_h;if(isTable){$(r).find("td").each(function(){arr.push($(this).text())});r=arr}for(i=0;i<r.length;i++){if(this.columnByKey(i+1)===null&&$.ig.getColType(r[i])!=="object"){col={headerText:hasHeaders?this._tb_h_arr[i]:$.ig.Grid.locale.colPrefix+(i+1),key:i+1,dataType:$.ig.getColType(r[i]),hidden:false};col.headerText=(col.headerText||"").toString().trim();if(this._isMultiColumnGrid){col.level0=true;col.level=0;this._oldCols.push(col)}this.options.columns.push(col);this._visibleColumnsArray=undefined}else if(hasHeaders&&!this.columnByKey(i+1).headerText){this.columnByKey(i+1).headerText=this._tb_h_arr[i]}}}else{for(key in r){if(r.hasOwnProperty(key)&&this.columnByKey(key)===null){colType=$.ig.getColType(r[key]);if((cdp&&cdp!==key||!cdp)&&(colType!=="object"||r[key]===null)&&key!=="ig_pk"){col={headerText:key,key:key,dataType:$.ig.getColType(r[key]),hidden:false};this.options.columns.push(col);if(this._isMultiColumnGrid){col.level0=true;col.level=0;this._oldCols.push(col)}this._visibleColumnsArray=undefined}}}}}if((this.dataSource.schema()===null||this.dataSource.schema().fields().length===0)&&!hasExplicitCols){this.dataSource.settings.schema=this._generateDataSourceSchema();this.dataSource._initSchema()}if(this.options.width===null){this._setContainerWidth(this.container())}this._trigger("columnsgenerated",null,{owner:this,key:this.options.key})},_renderGrid:function(){var gridElement=this.element[0],containerId,containerDiv,tbody=this.element.children("tbody"),ar=this.options.accessibilityRendering;this._cancelRendering=false;if(!this._initialized){if($.type(this.options.virtualization)==="number"&&this.dataSource.dataView().length>this.options.virtualization&&this.options.height!==null){this.options.virtualization=true}if(ar){this.element.attr("role","grid")}if(this.options.virtualization===true||this.options.rowVirtualization===true||this.options.columnVirtualization===true){if(this.options.height===undefined||this.options.height===null){throw new Error($.ig.Grid.locale.virtualizationRequiresHeight)}this._createVirtualGrid()}else if(this.options.height!==null||this.options.width!==null){this._createScrollingGrid()}else{containerId=gridElement.id+"_container";containerDiv='<div id="'+containerId+'" class="'+this.css.gridClasses+" "+this.css.baseClass+'"> </div>';this.element.wrap(containerDiv);this.element.addClass(this.css.gridTableClass);if(ar){this.element.attr("aria-describedby",containerId)}this._setContainerWidth(this.container());this.container().attr("tabIndex",this.options.tabIndex);if(this.options.height!==null){this.container().css("overflow-y","hidden")}}this._touch();if(this.options.columns.length>0&&this.options.virtualization!==true&&this.options.rowVirtualization!==true&&this.options.columnVirtualization!==true&&this.options.autogenerateColumns===false&&this.options.columns.length>0){this._renderColgroup(this.element[0],false,false,this.options.autofitLastColumn)}$(gridElement).attr("cellpadding","0");$(gridElement).attr("cellspacing","0");$(gridElement).attr("border","0");$(gridElement).css("table-layout","fixed");$(gridElement).addClass(this.css.gridTableClass);if(this.options.autoGenerateColumns===false&&this.options.columns.length>0&&this._headerRenderCancel!==true){this._renderHeader()}this._renderCaption();if(this.options.autoAdjustHeight){this._initializeHeights()}}if(tbody.length===0){tbody=$("<tbody></tbody>").appendTo(gridElement).addClass(this.css.baseContentClass).addClass(this.css.gridTableBodyClass).addClass(this.css.recordClass)}if(this.dataSource.type()!=="htmlTableDom"&&this.dataSource.type()!=="htmlTableId"){tbody.empty()}},_setContainerWidth:function(element,rendered){var cols=this._visibleColumns(),width=0;if(cols.length>0){width=this._calculateContainerWidth(true);if(width>0){if(rendered){width=0;this.container().find(".ui-iggrid-header").each(function(){width+=$(this).outerWidth()});element.width(width)}else{width+=this._calculateSpecialColumnsWidth();element.css("width",width)}}}else if(this.options.width!==null){element.css("width",this.options.width)}},_calculateContainerWidth:function(addScrollWidth){var width=0,cols=this.options.columns,i;for(i=0;i<cols.length;i++){if(cols[i].hidden!==true&&(this._initialHiddenColumns===undefined||$.inArray(cols[i],this._initialHiddenColumns)===-1)){width+=cols[i].width?parseInt(cols[i].width,10):this.options.defaultColumnWidth===null?0:parseInt(this.options.defaultColumnWidth,10)}}if(this.options.height!==null&&width>0&&addScrollWidth===true){width+=this._scrollbarWidth()}return width},_createScrollingGrid:function(){var self=this,containerWidth,totalWidth,scrollbarWidth=this._scrollbarWidth(),id=this.id()+"_scroll",dataContainer,scrollDiv='<div id="'+id+'"></div>';this.element.wrap(scrollDiv);dataContainer=this.element.parent();if(this.options.accessibilityRendering){this.element.attr("aria-describedby",id)}dataContainer.addClass(this.css.gridScrollDivClass).wrap("<div id='"+this.id()+"_container'></div>");if($.ig.util.isIE7){dataContainer.css("padding-bottom",this._scrollbarWidth())}this.container().attr("tabIndex",this.options.tabIndex).addClass(this.css.baseClass).addClass(this.css.gridClasses);if(this.options.width!==null){this.container().css("width",this.options.width);if(this.options.width.indexOf&&this.options.width.indexOf("%")!==-1){this.element.css("width","100%")}if(this.options.height!==null){this._addHorizontalScrollBar(dataContainer);this.scrollContainer().css("overflow-x","hidden");containerWidth=dataContainer.width();totalWidth=this._getHScrollContainerInner().width();dataContainer.bind("scroll",function(e){var container=$(this),hScroller=self._hscrollbarcontent(),containerLeft=container.scrollLeft(),hScrollerLeft=hScroller.scrollLeft();if(containerLeft!==hScrollerLeft){if(totalWidth===0){totalWidth=self._getHScrollContainerInner().width()}if(containerLeft+containerWidth>totalWidth+scrollbarWidth){container.scrollLeft(hScrollerLeft)}else{hScroller.scrollLeft(containerLeft)}}})}}else{this._setContainerWidth(this.container());this.scrollContainer().css("overflow-x","hidden")}if(this.options.height!==null){this.scrollContainer().css("overflow-y","auto");if(this.options.autoAdjustHeight){this.container().css("height",this.options.height)}else{this.scrollContainer().css("height",this.options.height)}}},_touch:function(){var id=this.id(),div=this.scrollContainer();if(div.length!==1){div=this._vdisplaycontainer()}if(div.length){div.attr("data-scroll","true").attr("data-oneDirection","true");if(this._hscrollbarcontent()[0]){div.attr("data-xScroller","#"+id+"_hscroller")}else if(this._vhorizontalcontainer()[0]){div.attr("data-xScroller","#"+id+"_horizontalScrollContainer")}if(this._scrollContainer()[0]){div.attr("data-yScroller","#"+id+"_scrollContainer")}if(typeof Modernizr==="object"&&Modernizr.touch===true&&this.element.igScroll!==undefined){div.css("overflow-y","hidden")}}},_createVirtualGrid:function(){var id=this.id(),grid,percWidthStr=$.ig.util.isWebKit?"width=100%":"",totalWidth,scrollContainerInner,scrollbarWidth,w=0,virtualGridMarkup='<div id="'+id+'_container" style="margin:0px; border:0px; padding:0px;"><table border="0" cellspacing="0" cellpadding="0" class="ui-iggrid-layout-helper" style="border-spacing:0px" id="'+id+'_virtualContainer" ><tbody><tr><td colspan="2" style="border-width:0px"><div id="'+id+'_headers_v" style="overflow:hidden;"></div></td></tr><tr><td style="border-width:0px;"><div id="'+id+'_displayContainer"></td>$verticalMarkup$</tr>$horizontalMarkup$</tbody></table></div>',verticalMarkup,horizontalMarkup='<tr><td colspan="2" style="border-width: 0px"><div id="'+id+'_horizontalScrollContainer"></div></td></tr>';scrollbarWidth=this._scrollbarWidth();if($.ig.util.isIE){scrollbarWidth+=1}if(parseInt(this.options.height,10)>0){verticalMarkup='<td style="border-width: 0px;"><div id="'+id+'_scrollContainer" style="overflow:scroll; overflow-x:hidden; width: '+scrollbarWidth+"px; height:"+this.options.height+';"></div></td>'}else{verticalMarkup='<td style="border-width: 0px;"><div id="'+id+'_scrollContainer" style="overflow:scroll; overflow-x:hidden; width: '+scrollbarWidth+'px;"></div></td>'}if(this.options.virtualization===true){virtualGridMarkup=virtualGridMarkup.replace("$verticalMarkup$",verticalMarkup).replace("$horizontalMarkup$",horizontalMarkup)}else if(this.options.rowVirtualization===true){virtualGridMarkup=virtualGridMarkup.replace("$verticalMarkup$",verticalMarkup).replace("$horizontalMarkup$","")}else if(this.options.columnVirtualization===true){virtualGridMarkup=virtualGridMarkup.replace("$horizontalMarkup$",horizontalMarkup).replace("$verticalMarkup$","")}if(this.options.virtualization===true||this.options.columnVirtualization===true){this.element.css("width","100%")}this.element.wrap(virtualGridMarkup);this.container().addClass(this.css.baseClass).addClass(this.css.gridClasses);if(this.options.width!==null){this.container().width(this.options.width)}else{this._setContainerWidth(this.container())}this._vdisplaycontainer().append(this.element[0]);grid=this;totalWidth=this._calculateContainerWidth(false);if(this.options.width!==null){w=parseInt(this.options.width,10)}else{w=totalWidth}if(this.options.height!==null&&this.options.width!==null){w-=this._scrollbarWidth()}if(w<=0){w=undefined}if(w>0&&this.options.expandColWidth&&!this.options.width){w+=this.options.expandColWidth}$("<colgroup><col "+(w<=0?percWidthStr:'width="'+w+'"')+'></col><col width="'+this._scrollbarWidth()+'"></col></colgroup>').prependTo(this._virtualcontainer());this._virtualcontainer().css("width",this.options.width).css("max-width",this.options.width);scrollContainerInner='<div style="width:1px; overflow:hidden; height:'+this._totalRowCount*parseInt(this.options.avgRowHeight,10)+'px;"></div>';this._scrollContainer().append(scrollContainerInner);if((this.options.virtualization===true||this.options.columnVirtualization===true)&&this.options.width&&totalWidth>parseInt(this.options.width,10)){this._renderHorizontalScrollContainer(totalWidth)}if(parseInt(this.options.height,10)>0){this._vdisplaycontainer().css("height",this.options.height).css("vertical-align","top")}this._vdisplaycontainer().css("position","relative").css("width",w).css("maxWidth",w);if(this.options.virtualization===true){this.container().find("#"+id+"_headers_v").append("<a href='#' id='"+id+"_displayContainer_a' tabindex='-1' style='position:absolute;top:-100px;left:-100px'>&nbsp;</a>")}if(this.options.width&&this.options.virtualization===false&&this.options.columnVirtualization===false){this._vdisplaycontainer().css({"overflow-y":"hidden","overflow-x":"auto"})}else{this._vdisplaycontainer().css("overflow","hidden")}this._vdisplaycontainer().parent().bind({mouseenter:function(event){grid._isMouseOverVirtualTable=true},mouseleave:function(event){grid._isMouseOverVirtualTable=false}});this._documentEvents={DOMMouseScroll:function(event){var dir="down",delta,step;step=grid.options.virtualizationMouseWheelStep===null?parseInt(grid.options.avgRowHeight,10):grid.options.virtualizationMouseWheelStep;delta=-event.originalEvent.detail/3;if(delta>0){dir="up"}if(grid._isMouseOverVirtualTable){grid._onVirtualVerticalScroll(event,step,dir);event.preventDefault()}},mousewheel:function(event){var dir="down",delta,step;step=grid.options.virtualizationMouseWheelStep===null?parseInt(grid.options.avgRowHeight,10):grid.options.virtualizationMouseWheelStep;delta=event.originalEvent.wheelDelta/120;if(delta>0){dir="up"}if(grid._isMouseOverVirtualTable){grid._onVirtualVerticalScroll(event,step,dir);event.preventDefault()}}};$(document).bind(this._documentEvents);if(this.options.virtualization===true||this.options.rowVirtualization===true){this._scrollContainer().bind({scroll:function(event){grid._onVirtualVerticalScroll(event);grid._virtualScrollMouseDown=false},mousedown:function(event){grid._virtualScrollMouseDown=true}})}if(this.options.virtualization===true||this.options.columnVirtualization===true){this._vhorizontalcontainer().bind({scroll:function(event){grid._onVirtualHorizontalScroll(event)}})}if(this._vhorizontalcontainer().length===0&&this.options.width!==null){this._addHorizontalScrollBar(this._virtualcontainer());this._vdisplaycontainer().css("overflow-x","hidden")}this.element.height(this._scrollContainer().height());if(this.options.width&&this.options.width.indexOf&&this.options.width.indexOf("%")!==-1){this.container().find("#"+id+"_virtualContainer > colgroup > col:first").css("width","100%");this._vhorizontalcontainer().css("width","100%");this._vdisplaycontainer().css("width","100%").css("max-width","100%")}},_renderHorizontalScrollContainer:function(totalWidth){var horizontalScrollContainerInner;this._vhorizontalcontainer().css("height",this._scrollbarWidth()+"px").css("overflow","scroll");if($.ig.util.isIE){this._vhorizontalcontainer().css("width",parseInt(this.options.width,10)+1).css("height","100%")}else{this._vhorizontalcontainer().css("width",this.options.width)}horizontalScrollContainerInner='<div style="width:'+totalWidth+'px;height:1px;"></div>';this._vhorizontalcontainer().append(horizontalScrollContainerInner)},_onVirtualVerticalScroll:function(event,offset,dir){this._isHorizontal=false;var scrollContainer=this._scrollContainer(),scrollTopDiff,current=scrollContainer.scrollTop(),mode=this.options.virtualizationMode;if(this._calledScroll>=0){this._calledScroll++}if(offset!==undefined){if(dir==="down"){scrollContainer.scrollTop(current+offset)}else{scrollContainer.scrollTop(current-offset)}current=scrollContainer.scrollTop()}scrollTopDiff=scrollContainer.scrollTop()-this._oldScrollTop;if(Math.abs(scrollTopDiff)<5&&$.ig.util.isFF&&!$.ig.util.isIE){return}if(mode===undefined||mode===""){mode="continuous"}if(mode==="fixed"){this._startRowIndex=Math.ceil(scrollContainer.scrollTop()/parseInt(this.options.avgRowHeight,10));if(!$.ig.util.isIE&&this._startRowIndex===this._oldStartRowIndex&&this._virtualScrollMouseDown){if(scrollTopDiff>0&&scrollTopDiff<parseInt(this.options.avgRowHeight,10)){this._startRowIndex++;scrollContainer.scrollTop(scrollContainer.scrollTop()-scrollTopDiff+parseInt(this.options.avgRowHeight,10))}else if(scrollTopDiff<0&&Math.abs(scrollTopDiff)<parseInt(this.options.avgRowHeight,10)){this._startRowIndex--;scrollContainer.scrollTop(scrollContainer.scrollTop()-scrollTopDiff-parseInt(this.options.avgRowHeight,10))}}if(this._startRowIndex>this._totalRowCount-this._virtualRowCount){this._startRowIndex=this._totalRowCount-this._virtualRowCount}if(this._startRowIndex<0){this._startRowIndex=0}this._oldStartRowIndex=this._startRowIndex;this._renderVirtualRecords()}else if(mode==="continuous"){this._virtualScrollToInternal(current)}this._oldScrollTop=scrollContainer.scrollTop()},_scrollContainer:function(){if(!this._scrollContainerObj||this._scrollContainerObj.length===0){this._scrollContainerObj=this.container().find("#"+this.id()+"_scrollContainer")}return this._scrollContainerObj},_onVirtualHorizontalScroll:function(event){var id=this.id(),internallyTriggered=event===undefined,horizontalScrollContainer=this._vhorizontalcontainer(),scrollLeft=horizontalScrollContainer.scrollLeft(),hiddenContentWidth=horizontalScrollContainer[0].scrollWidth-horizontalScrollContainer[0].offsetWidth,deltaScroll=scrollLeft-this._oldScrollLeft;if(!internallyTriggered&&Math.abs(deltaScroll)<5&&$.ig.util.isIE&&!$.ig.util.isIE){return}if(this.options.virtualization===true&&this.options.virtualizationMode==="continuous"){this._setDisplayContainerScrollLeft(this._getDisplayContainerScrollLeft()+deltaScroll);this._oldScrollLeft=horizontalScrollContainer.scrollLeft();this.container().find("#"+id+"_headers_v").scrollLeft(this.container().find("#"+id+"_headers_v").scrollLeft()+deltaScroll);this.container().find("#"+id+"_footer_container").scrollLeft(this.container().find("#"+id+"_footer_container").scrollLeft()+deltaScroll);return}this._isHorizontal=true;if(hiddenContentWidth>0){this._startColIndex=Math.ceil(scrollLeft*this._totalColumnCount/hiddenContentWidth);this._startColIndex=Math.min(this._startColIndex,this._totalColumnCount-this._virtualColumnCount)}else{this._startColIndex=0}if(internallyTriggered||this._oldStartColIndex!==this._startColIndex){this._renderVirtualRecords();this._trigger("virtualhorizontalscroll",null,{startColIndex:this._startColIndex,endColIndex:this._startColIndex+this._virtualColumnCount-1})}this._oldScrollLeft=horizontalScrollContainer.scrollLeft();this._oldStartColIndex=this._startColIndex},_initLoadingIndicator:function(){var widget;if(this.container().data("igLoading")){this._loadingIndicator=this.container().data("igLoading").indicator()}else{widget=this.container().igLoading().data("igLoading");if(widget){this._loadingIndicator=widget.indicator()}}},_addHorizontalScrollBar:function(parent){var sb=$("<div id='"+this.id()+"_hscroller_container' ></div>").css("height",this._scrollbarWidth()+"px").css("position","relative").css("display","none").css("overflow","hidden").append($("<div id='"+this.id()+"_hscroller' ></div>").css("width","100%").css("position","absolute").css("bottom","0px").css("overflow-x","scroll").css("overflow-y","scroll").append($("<div id='"+this.id()+"_hscroller_inner' ></div>").css("height","1px")).bind("scroll",$.proxy(this._scrollData,this)));if(parent){sb.insertAfter(parent)}},_updateVirtualHorizontalScrollbar:function(){var horizontalScrollContainerInner,horizontalScrollContainer;horizontalScrollContainerInner=this.container().find("#"+this.id()+"_horizontalScrollContainer div");horizontalScrollContainerInner.css("width",this._calculateContainerWidth(false));horizontalScrollContainer=this._vhorizontalcontainer();if(horizontalScrollContainer.width()>horizontalScrollContainerInner.width()){horizontalScrollContainer.css("display","none")}else{horizontalScrollContainer.css("display","")}},_generateColumnFlatStructure:function(treeStructure){var cols,oldCols,newCols=[];cols=treeStructure.slice(0);oldCols=treeStructure.slice(0);this._multiColumnIdentifier=0;this._maxLevel=this._getMaxLevelRecursive(0,cols);this._hiddenColumns={};this._analyzeMultiColumnHeaders(cols,newCols,0,oldCols,[]);this._oldCols=oldCols;this.options.columns=newCols},moveColumn:function(column,target,after,inDom){var grid=this,found,nColArray,movingParams,hcPreserve;nColArray=this._buildColumnLayoutArray();after=after===null||after===undefined?true:after;inDom=inDom===null||inDom===undefined?true:inDom;movingParams={column:column,target:target,after:after};if(this._oldCols){found=this._performInternalMove(movingParams,this._oldCols);hcPreserve=jQuery.extend(true,{},this._hiddenColumns);this._generateColumnFlatStructure(this._oldCols);this._hiddenColumns=hcPreserve;this._preserveColspans(this._oldCols)}else{found=this._performInternalMove(movingParams,this.options.columns)}column=movingParams.column;target=movingParams.target;after=movingParams.after;if(found===false){throw new Error($.ig.Grid.locale.movingNotAllowedOrIncompatible)}if(inDom===true){this._loadingIndicator.show();setTimeout(function(){grid._columnMovingResets();grid._performDomColumnMove(column,target,after,nColArray);grid._loadingIndicator.hide()},0)}else{this._columnMovingResets();this._performColumnMove(column,target,after,nColArray)}},_columnMovingResets:function(){var i,$th;this._updateHeaderColumnIndexes();delete this._virtualDom;delete this._visibleColumnsArray;this._headerCells=[];for(i=0;i<this.options.columns.length;i++){$th=this.container().find("#"+this.id()+"_"+this.options.columns[i].key).data("columnIndex",i);$th.data("data-mch-order",i);if($th.is(":visible")){this._headerCells.push($th)}}},_preserveColspans:function(cols){var i,cs=0,col,res;for(i=0;i<cols.length;i++){col=cols[i];if(col.group!==undefined&&col.group!==null){res=this._preserveColspans(col.group);col.colspan=res;cs+=res}else{if(col.hidden!==true){cs++}}}return cs},_columnVisible:function(col){return!col.hidden},_buildColumnLayoutArray:function(){var i=0,j=0,col,id,colrs,l,x=0,cCols=this._oldCols?jQuery.extend(true,[],this._oldCols):jQuery.extend(true,[],this.options.columns),nCols,level=0,width=this.container().find("#"+this.id()+" colgroup:first>col").not("[data-skip=true]").length,height=this.container().find("#"+this.id()+(this.options.fixedHeaders===true?"_headers ":" ")+"thead tr").length,array=[];if(height===0&&this.options.showHeader===false){height=1}for(i=0;i<width;i++){array[i]=[]}i=0;while(level<height){nCols=[];while(i<cCols.length){col=cCols[i];if(col.hidden===true){i++;continue}colrs=col.rowspan||1;id=this._getColMarkForLevel(col);l=col.colspan||1;for(j=0;j<l;j++){array[x+j][level]=id}if(col.crs===colrs&&col.group){nCols.push.apply(nCols,$.grep(col.group,this._columnVisible).slice(0))}else{nCols.push(col)}x+=l;i++}cCols=nCols;level++;x=0;i=0}return array},_getColMarkForLevel:function(col){if(!col.crs){col.crs=0}col.crs++;if(col.crs>1){return-1}return col.key||col.identifier},_performInternalMove:function(movingParams,subset){var i=0,j,success=true;i=this._getColIdxById(subset,movingParams.column);if(typeof movingParams.column==="number"){movingParams.column=subset[i].key||subset[i].identifier}if(i||i===0){j=this._getColIdxById(subset,movingParams.target);if(typeof movingParams.target==="number"){movingParams.target=subset[j].key||subset[j].identifier;if(j<i){movingParams.after=false}else{movingParams.after=true}}if(j||j===0){success=success&&this._rearrangeArray(subset,i,1,movingParams.after===true?j+1:j);return success}return false}for(i=0;i<subset.length;i++){if(subset[i].group){if(this._performInternalMove(movingParams,subset[i].group)===true){return true}}}return false},_getColIdxById:function(array,id){var i,col;if(typeof id==="number"){return id}for(i=0;i<array.length;i++){col=array[i];if(col.key){if(col.key===id){return i}}else if(col.identifier){if(col.identifier===id){return i}}}},_getCellIndexByColumnKey:function(key){var i=this._getVisibleIndexByKey(key);return i===-1?i:i+this.element.find("tbody>tr:not([data-grouprow='true']):first").children("th,td[data-skip='true'],td[data-parent]").length},_findColAreaInLayout:function(col,nColArray,depth){var i,j,res={};for(i=0;i<nColArray.length;i++){if(nColArray[i][depth]===col){res.start=i;for(j=i;j<nColArray.length;j++){if(nColArray[j][depth]!==col){break}}res.length=j-i;return res}}return null},_rearrangeArray:function(array,start,length,at){var col,targetAfter=start<at,n;if(start===at||start<0||at<0||start>=array.length||at>array.length){return false}col=array.splice(start,length);for(n=0;n<col.length;n++){array.splice(targetAfter?at-length+n:at+n,0,col[n])}return true},_moveColumnInHeader:function(column,target,after,nColArray){var rmil,movedColumn,targetColumn,targetIndex,targetObject,spStart,spEnd,i,j,cols,n,header;header=this.container().find("#"+this.id()+(this.options.fixedHeaders===true?"_headers ":" ")+">thead");for(j=0;j<nColArray[0].length;j++){movedColumn=this._findColAreaInLayout(column,nColArray,j);if(movedColumn){targetColumn=this._findColAreaInLayout(target,nColArray,j);if(targetColumn){break}}}rmil=[movedColumn,targetColumn];if(this.options.showHeader===false){return rmil}this._moveThs(header,column,target,after);while(++j<nColArray[0].length){cols=[];n=null;for(i=movedColumn.start;i<movedColumn.start+movedColumn.length;i++){if(nColArray[i][j]===-1){continue}if(nColArray[i][j]!==n){n=nColArray[i][j];cols.push(n)}}targetIndex=after===true?targetColumn.start+targetColumn.length-1:targetColumn.start;if(nColArray[targetIndex][j]!==-1){this._moveThs(header,cols,nColArray[targetIndex][j],after);continue}if(after===true){spStart=targetColumn.start+targetColumn.length;spEnd=movedColumn.start>targetColumn.start+targetColumn.length-1?movedColumn.start:nColArray.length;targetObject=this._findTargetRight(spStart,spEnd,j,nColArray);if(!targetObject){spStart=targetColumn.start+targetColumn.length-2;spEnd=movedColumn.start>targetColumn.start+targetColumn.length-1?-1:movedColumn.start+movedColumn.length;targetObject=this._findTargetLeft(spStart,spEnd,j,nColArray)}}else{spStart=targetColumn.start-1;spEnd=movedColumn.start>targetColumn.start+targetColumn.length-1?-1:movedColumn.start+movedColumn.length;targetObject=this._findTargetLeft(spStart,spEnd,j,nColArray);if(!targetObject){spStart=targetColumn.start+1;spEnd=movedColumn.start>targetColumn.start+targetColumn.length-1?movedColumn.start:nColArray.length;targetObject=this._findTargetRight(spStart,spEnd,j,nColArray)}}if(targetObject&&targetObject.pos&&targetObject.left!==undefined&&targetObject.left!==null){this._moveThs(header,cols,nColArray[targetObject.pos][j],targetObject.left)}}return rmil},_moveColumnInBodyFooter:function(area,movedColumn,targetColumn,after){var i,j,trs,$tr,tds,tar,skip;trs=area.find(">tr:not([data-container='true'],[data-grouprow='true'])");if(trs.length>0){skip=trs.eq(0).find("[data-parent],[data-skip='true'],th").length}for(j=0;j<trs.length;j++){tds=$();$tr=trs.eq(j);for(i=movedColumn.start;i<movedColumn.start+movedColumn.length;i++){tds=tds.add($tr.children().eq(i+skip))}if(after===true){tar=$tr.children().eq(targetColumn.start+targetColumn.length+skip-1);tds.detach().insertAfter(tar)}else{tar=$tr.children().eq(targetColumn.start+skip);tds.detach().insertBefore(tar)}}this._updateVerticalScrollbarCellPadding(true)},_findTargetRight:function(start,end,level,nColArray){var i,colFound={};for(i=start;i>=0&&i<end&&i<nColArray.length;i++){if(nColArray[i][level]!==-1){colFound.pos=i;colFound.left=false;return colFound}}},_findTargetLeft:function(start,end,level,nColArray){var i,colFound={};for(i=start;i>=0&&i>end&&i<nColArray.length;i--){if(nColArray[i][level]!==-1){colFound.pos=i;colFound.left=true;return colFound}}},_moveCols:function(area,movedColumn,targetColumn,after){var i,cols=$(),tCol,skip=area.children("[data-skip='true']").length;for(i=movedColumn.start;i<movedColumn.start+movedColumn.length;i++){cols=cols.add(area.children().eq(i+skip))}if(after===true){tCol=area.children().eq(targetColumn.start+targetColumn.length+skip-1);cols.detach().insertAfter(tCol)}else{tCol=area.children().eq(targetColumn.start+skip);cols.detach().insertBefore(tCol)}},_moveThs:function(header,ids,tar,after){var $tar,$ids=$(),$id,i,$pid;$tar=header.find("th[data-mch-id='"+tar+"'],th[id='"+this.id()+"_"+tar+"']");if(typeof ids==="object"){for(i=0;i<ids.length;i++){$id=header.find("th[data-mch-id='"+ids[i]+"'],th[id='"+this.id()+"_"+ids[i]+"']");if($id.attr("data-vscr-padding-icrement")){$pid=$id}$ids=$ids.add($id)}}else{$ids=header.find("th[data-mch-id='"+ids+"'],th[id='"+this.id()+"_"+ids+"']");if($ids.attr("data-vscr-padding-icrement")){$pid=$ids}}$ids.detach();if(after){$ids.insertAfter($tar)}else{$ids.insertBefore($tar)}if($tar.attr("data-vscr-padding-icrement")&&after===true){$ids.last().css(this._padding,$tar.css(this._padding)).attr("data-vscr-padding-icrement",$tar.attr("data-vscr-padding-icrement"));$tar.css(this._padding,"");$tar.removeAttr("data-vscr-padding-icrement")}else if($pid){$pid.parent().children(":last").css(this._padding,$pid.css(this._padding)).attr("data-vscr-padding-icrement",$pid.attr("data-vscr-padding-icrement"));$pid.css(this._padding,"");$pid.removeAttr("data-vscr-padding-icrement")}},_moveSpecialThs:function(movedColumn,targetColumn,after){var i,j,spTrs,header,skip,ths,$tr,tar;header=this.container().find("#"+this.id()+(this.options.fixedHeaders===true?"_headers ":" ")+"thead");spTrs=header.find(">tr[data-role]");if(spTrs.length>0){skip=spTrs.eq(0).find("[data-parent],[data-skip='true']").length}for(j=0;j<spTrs.length;j++){ths=$();$tr=$(spTrs[j]);for(i=movedColumn.start;i<movedColumn.start+movedColumn.length;i++){ths=ths.add($tr.children("td,th").eq(i+skip))}if(after===true){tar=$tr.children().eq(targetColumn.start+targetColumn.length+skip-1);ths.detach().insertAfter(tar)}else{tar=$tr.children().eq(targetColumn.start+skip);ths.detach().insertBefore(tar)}}},_performDomColumnMove:function(column,target,after,nColArray){var rmil=this._moveColumnInHeader(column,target,after,nColArray),movedColumn=rmil[0],targetColumn=rmil[1],footer;this._moveSpecialThs(movedColumn,targetColumn,after);if(this.options.fixedHeaders===true){this._moveCols(this.container().find("#"+this.id()+"_headers>colgroup"),movedColumn,targetColumn,after)}this._moveColumnInBodyFooter(this.element.find(">tbody"),movedColumn,targetColumn,after);this._moveCols(this.element.find(">colgroup"),movedColumn,targetColumn,after);if(this.options.fixedFooters===true){footer=this.footersTable();this._moveColumnInBodyFooter(footer.children("tfoot"),movedColumn,targetColumn,after);this._moveCols(footer.children("colgroup"),movedColumn,targetColumn,after)}else{this._moveColumnInBodyFooter(this.element.find("tfoot"),movedColumn,targetColumn,after)
}this._trigger("_columnsmoved",null,{owner:this,start:movedColumn.start,len:movedColumn.length,index:after===true?targetColumn.start+targetColumn.length:targetColumn.start})},_performColumnMove:function(column,target,after,nColArray){var rmil=this._moveColumnInHeader(column,target,after,nColArray),movedColumn=rmil[0],targetColumn=rmil[1];if(this.options.fixedHeaders===true){this._moveCols(this.container().find("#"+this.id()+"_headers>colgroup"),movedColumn,targetColumn,after)}this._renderData();this._renderFooter();this._rerenderColgroups()},showColumn:function(column){var grid=this;this._loadingIndicator.show();setTimeout(function(){grid._setHidden(column,false);grid._loadingIndicator.hide()},0)},hideColumn:function(column){var grid=this;this._loadingIndicator.show();setTimeout(function(){grid._setHidden(column,true);grid._loadingIndicator.hide()},0)},_setHidden:function(column,hidden){var col;if(typeof column==="number"){col=this.options.columns[column]}else{col=this.columnByKey(column)}if(col&&col.hidden!==hidden){this._setHiddenColumns([col],hidden,false)}if(this.options.rowTemplate!==null){this.options.rowTemplate=this._buildRowTemplateRaw(true);this._tmpl=null}},_setHiddenColumns:function(columns,hidden,initial){var columnNumberChanged=false,self=this,hasVirtualization=this.options.virtualization===true||this.options.columnVirtualization===true||this.options.rowVirtualization===true,hasColumnVirtualization=this.options.virtualizationMode!=="continuous"&&(this.options.virtualization===true&&this.options.width||this.options.columnVirtualization===true),isContinuos=false,visibleColumnsLength,visibleColumnsWithWidthLength,gridWidth,hasNoWidthPercentage,overflow,colgroup;if(columns.length===0){return}this._fireInternalEvent("_hidingFinishing");if(hasVirtualization){isContinuos=this.options.virtualizationMode==="continuous";self._updateVirtColCounters();if(!isContinuos){$.each(columns,function(index,col){var oldVirtualColumnCount=self._virtualColumnCount;col.hidden=hidden;self._visibleColumnsArray=undefined;self._updateVirtColCounters();if(self._virtualColumnCount!==oldVirtualColumnCount){if(self._virtualColumnCount<oldVirtualColumnCount){self._detachColumn(col)}else if(self._virtualColumnCount>oldVirtualColumnCount){self._attachColumn(col)}columnNumberChanged=true;self._virtualDom=null}});if(hasColumnVirtualization){this._vheaders=undefined;this._updateVirtualHorizontalScrollbar();this._onVirtualHorizontalScroll();if(!this._initialized){this._adjustLastColumnWidth(true)}}this._renderVirtualRecords()}}if(!hasVirtualization||isContinuos){$.each(columns,function(index,col){col.hidden=hidden;self._visibleColumnsArray=undefined;if(col.hidden){self._detachColumn(col)}else{self._attachColumn(col)}});this._cleanupTBody();columnNumberChanged=true;if(hasVirtualization){this._renderVirtualRecords()}else{this._renderRecords()}}if(columnNumberChanged){if(!this._initialized){this._rerenderColgroups(initial);this._adjustLastColumnWidth(true)}else{if(this._visibleColumns().length>0){this._rerenderColgroups(initial);this._adjustLastColumnWidth(true);visibleColumnsLength=this._visibleColumns().length;visibleColumnsWithWidthLength=$.grep(this._visibleColumns(),function(col){return col.width}).length;if(visibleColumnsWithWidthLength===visibleColumnsLength){if(this.options.width&&parseInt(this.options.width,10)>0){this._updateGridContentWidth()}else{this._setContainerWidth(this.container());if(hasVirtualization){gridWidth=this._calculateContainerWidth(true);if(this.options.height!==null){gridWidth-=this._scrollbarWidth()}this._vdisplaycontainer().css("width",gridWidth).css("max-width",gridWidth)}}}}}}this._fireInternalEvent("_hidingFinished");this.element.trigger("iggriduisoftdirty",{owner:this});this._trigger(this.events.columnsCollectionModified,null,{owner:this});if(columnNumberChanged&&hasVirtualization&&this._visibleColumns().length>0&&visibleColumnsWithWidthLength===visibleColumnsLength){if(this.options.virtualizationMode==="continuous"){gridWidth+=this._calculateSpecialColumnsWidth();this._vdisplaycontainer().css("width",gridWidth).css("max-width",gridWidth)}this.container().find("#"+this.id()+"_virtualContainer>colgroup col").eq(0).attr("width",gridWidth);if(this.options.width===null||this.options.width===undefined){this._setContainerWidth(this.container().find("#"+this.id()+"_headers_v"))}}this._origWidth=parseInt(this.container().css("width"),10);if(columnNumberChanged&&($.ig.util.isFF||$.ig.util.isIE8)){hasNoWidthPercentage=false;if($.ig.util.isIE8&&typeof this.options.width==="string"&&this.options.width.indexOf("%")!==-1){this.container().hide();setTimeout(function(){self.container().show()},0)}if(this.options.fixedHeaders===true&&this.options.height!==null||this.options.showHeader===false){colgroup=this.element.children("colgroup").detach();this.element.prepend(colgroup);if(this.options.width||this.options.defaultColumnWidth&&this.options.defaultColumnWidth.indexOf("%")===-1){hasNoWidthPercentage=true}colgroup.find("col").each(function(){var w=this.style.width;if(w&&w.indexOf("%")===-1){hasNoWidthPercentage=false;return false}});if(hasNoWidthPercentage){overflow=this.element[0].style.overflow;this.element[0].style.overflow="hidden";setTimeout(function(){self.element[0].style.overflow=overflow},0)}}if(this.options.showHeader){colgroup=this.headersTable().children("colgroup").detach();this.headersTable().prepend(colgroup);if(hasNoWidthPercentage){overflow=this.headersTable()[0].style.overflow;this.headersTable()[0].style.overflow="hidden";setTimeout(function(){self.headersTable()[0].style.overflow=overflow},0)}}if(this.options.fixedFooters===true&&this.options.height!==null){colgroup=this.footersTable().children("colgroup").detach();this.footersTable().prepend(colgroup);if(hasNoWidthPercentage){overflow=this.footersTable()[0].style.overflow;this.footersTable()[0].style.overflow="hidden";setTimeout(function(){self.footersTable()[0].style.overflow=overflow},0)}}}},_calculateSpecialColumnsWidth:function(){var width=0;this.headersTable().find("> colgroup > col[data-skip=true]").each(function(){var colWidth=this.style.width;if(colWidth){width+=parseInt(colWidth,10)}});if(width>0){this._origSum=width}return width},_allSpecialColumnsInPercentage:function(){var specCols=this.headersTable().find("> colgroup > col[data-skip=true]"),i;for(i=0;i<specCols.length;i++){if(!specCols[i].style.width.endsWith("%")){return false}}return true},_synchronizeHScroll:function(){var hasFixedHeaders=this.options.showHeader&&this.options.fixedHeaders===true&&this.options.height!==null,hasFixedFooters=this.options.showFooter&&this.options.fixedFooters===true&&this.options.height!==null,scroller=this._hscrollbarcontent(),scrollContainer=this.scrollContainer(),horizontalScrollContainer=$("#"+this.id()+"_horizontalScrollContainer"),scrLeft=scroller.scrollLeft(),headers,displayContainer,footers;if(scroller.length===0&&horizontalScrollContainer.length===1){displayContainer=$("#"+this.id()+"_displayContainer");scrLeft=displayContainer.scrollLeft()}else{scrollContainer.scrollLeft(scrLeft);scrLeft=scrollContainer.scrollLeft();scroller.scrollLeft(scrLeft)}if(hasFixedHeaders){headers=this.headersTable().parent();headers.scrollLeft(scrLeft)}if(hasFixedFooters){footers=this._fixedfooters();footers.scrollLeft(scrLeft)}},_updateFixedGridContentWidth:function(minAllowWidth){var fixedContainerWidth=0,gridW,gridInnerWidth;$.each(this._fixedColumns,function(index,col){var colW;if(!col.width||col.width.charAt&&col.width.endsWith("%")){return true}colW=parseInt(col.width,10);if(col.fixed===true){fixedContainerWidth+=colW}});this._setGridFixedTablesWidth(fixedContainerWidth);if(this._gridHasWidthInPixels()){gridW=parseInt(this.options.width,10);gridInnerWidth=gridW-parseInt(this.fixedContainer().outerWidth(),10);this._hscrollbar().css("width",gridInnerWidth+"px");if(this.options.height!==null){this._gridInnerWidth=gridInnerWidth;this._gridInnerWidth=this.scrollContainer().width();this._updateHScrollbarVisibility()}}},_updateGridContentWidth:function(){var gridWidth=0,scroller,scrLeft,hasFixedHeader=this.options.height!==null&&this.options.fixedHeaders===true&&this.options.showHeader&&this._headerParent;$.each(this._visibleColumns(),function(index,col){if(col.fixed===true){return true}if(gridWidth!==undefined&&col.width&&!(col.width.charAt&&col.width.endsWith("%"))){gridWidth+=parseInt(col.width,10)}else{gridWidth=undefined}});if(gridWidth===undefined){return}gridWidth+=this._calculateSpecialColumnsWidth();if(!hasFixedHeader&&this._hasVerticalScrollbar){gridWidth-=this._scrollbarWidth()}if(this.options.width!==null&&this.options.height!==null){scroller=this._hscrollbarcontent();scrLeft=scroller.scrollLeft()}this._setGridContentWidth(gridWidth);if(this.options.height!==null&&this.options.width!==null){this._updateVerticalScrollbarCellPadding()}if(this.options.width!==null&&this.options.height!==null){scroller.scrollLeft(scrLeft);this._synchronizeHScroll()}},_updateVerticalScrollbarCellPadding:function(skipHeaderFooters){var hasFixedHeaders=this.options.showHeader&&this.options.fixedHeaders===true&&this.options.height!==null,hasFixedFooters=this.options.showFooter&&this.options.fixedFooters===true&&this.options.height!==null,emptySpace,paddingIncrement;if(this.options.height===null){return}if(!hasFixedHeaders&&!hasFixedFooters){return}if(this._gridInnerWidth===undefined||this._gridContentWidth===undefined){emptySpace=0}else{emptySpace=this._gridInnerWidth-this._gridContentWidth}if(this._hasVerticalScrollbar){paddingIncrement=this._scrollbarWidth()}else{paddingIncrement=0}if(emptySpace>=0){paddingIncrement-=emptySpace}if(paddingIncrement<0){paddingIncrement=0}if(hasFixedHeaders&&!skipHeaderFooters){this._increaseLastHeaderCellVScrollbarPadding(this.headersTable(),paddingIncrement)}if(hasFixedFooters&&!skipHeaderFooters){this._increaseLastCellVScrollbarPadding(this.footersTable(),"tfoot","td",paddingIncrement)}this._increaseLastCellVScrollbarPadding(this.element,"tbody","td",paddingIncrement)},_increaseLastHeaderCellVScrollbarPadding:function(table,paddingIncrement){var lastCells=table.children("thead").children("tr").not("[data-skip=true]").children("th:last-child").not("[data-skip=true]"),currIncrement=parseInt(lastCells.first().attr("data-vscr-padding-icrement"),10),paddingValue;paddingValue=parseInt(lastCells.first().css(this._padding),10);if(currIncrement){paddingValue-=currIncrement}lastCells.css(this._padding,paddingValue+paddingIncrement);lastCells.first().attr("data-vscr-padding-icrement",paddingIncrement);lastCells.find("[data-nonpaddedindicator=right]").css(this._rtl?"margin-left":"margin-right",-parseInt(lastCells.css(this._padding),10)+"px")},_increaseLastCellVScrollbarPadding:function(table,tableGroup,rowElement,paddingIncrement){var i,cells,$cell,paddingValue,lastCells=table.find(" > "+tableGroup+" > tr > "+rowElement+":last-child"),currIncrement=parseInt(lastCells.first().attr("data-vscr-padding-icrement"),10);cells=table.find(" > "+tableGroup+" > tr:first > "+rowElement+":not(:last)[data-vscr-padding-icrement]");for(i=0;i<cells.length;i++){$cell=$(cells[i]);$cell.removeAttr("data-vscr-padding-icrement");table.find(" > "+tableGroup+" > tr > "+rowElement+":nth-child("+($cell.index()+1)+")").css(this._padding,"")}paddingValue=parseInt(lastCells.first().css(this._padding),10);if(currIncrement){paddingValue-=currIncrement}lastCells.css(this._padding,paddingValue+paddingIncrement);lastCells.first().attr("data-vscr-padding-icrement",paddingIncrement)},_updateHScrollbarVisibility:function(){var scrollerContainer=this._hscrollbar(),scrollerWasHidden=scrollerContainer.css("display")==="none";scrollerContainer.css("display","");if(this._gridInnerWidth<this._gridContentWidth){if(this.options.virtualizationMode==="continuous"&&scrollerContainer.length===0&&this._getHScrollContainerInner().length===0){this._renderHorizontalScrollContainer(this._calculateContainerWidth(false));scrollerWasHidden=true}if(scrollerWasHidden){if(this.options.autoAdjustHeight){this._initializeHeights()}}}else{if(this.options.virtualizationMode==="continuous"&&scrollerContainer.length===0&&this._getHScrollContainerInner().length===1){this._vhorizontalcontainer().empty().attr("style","");scrollerWasHidden=false}scrollerContainer.css("display","none");if(!scrollerWasHidden){if(this.options.autoAdjustHeight){this._initializeHeights()}}}},_setGridContentWidth:function(gridContentWidth){var o=this.options,w,v=o.virtualization===true||o.rowVirtualization===true||o.columnVirtualization===true;if(this.options.height!==null){if(gridContentWidth){this._gridContentWidth=gridContentWidth}if(this._gridContentWidth){w=this._hasVerticalScrollbar&&this.options.fixedHeaders?this._gridContentWidth-this._scrollbarWidth():this._gridContentWidth;if(this.hasFixedColumns()&&!gridContentWidth){w-=parseInt(this.fixedContainer().outerWidth(),10)}this._getHScrollContainerInner().css("width",w)}this._updateHScrollbarVisibility()}if(v===false){this._setGridTablesWidth(gridContentWidth)}},_setGridFixedTablesWidth:function(width){var hasFixedHeaders=this.options.showHeader&&this.options.fixedHeaders===true&&this.options.height!==null,hasFixedFooters=this.options.showFooter&&this.options.fixedFooters===true&&this.options.height!==null;this.fixedTable().width(width);if(hasFixedHeaders){this.fixedHeadersTable().width(width)}if(hasFixedFooters){this.fixedFootersTable().width(width)}},_setGridTablesWidth:function(width){var hasFixedHeaders=this.options.showHeader&&this.options.fixedHeaders===true&&this.options.height!==null,hasFixedFooters=this.options.showFooter&&this.options.fixedFooters===true&&this.options.height!==null;this.element.width(width);if(hasFixedHeaders){this.headersTable().width(width)}if(hasFixedFooters){this.footersTable().width(width)}},_detachHiddenColumns:function(){var col,i;for(i=0;i<this.options.columns.length;i++){col=this.options.columns[i];if(col.hidden){this._detachColumn(col)}}},_rerenderColgroups:function(){var hasFixedHeader=this.options.height!==null&&this.options.fixedHeaders===true&&this.options.showHeader,hasFixedFooter=this.options.height!==null&&this.options.fixedFooters===true&&this.options.showFooter,initial=this.options.autofitLastColumn;if(hasFixedHeader){this.headersTable().children("colgroup").remove();this._renderColgroup(this.headersTable()[0],true,false,initial)}if(hasFixedFooter){this.footersTable().children("colgroup").remove();this._renderColgroup(this.footersTable()[0],false,true,initial)}this.element.children("colgroup").remove();this._renderColgroup(this.element[0],false,false,initial)},_detachColumn:function(col){var position,cols,headerCells,isMultiColumnGrid=this._isMultiColumnGrid;col.hidden=false;this._visibleColumnsArray=undefined;cols=this._visibleColumns();position=$.inArray(col,cols);col.hidden=true;this._visibleColumnsArray=undefined;this._initializeDetachedContainers();headerCells=this.headersTable().children("thead").children("tr").not("[data-skip=true]");if(isMultiColumnGrid){this._hideMultiHeaderCells(this._headerCells,position,col.key);headerCells=this.headersTable().children("thead").children("tr:not([data-mch-level])").not("[data-skip=true]");this._detachCells(headerCells,function(row){return row.children("th, td").not("[data-skip=true]")},position,this._detachedHeaderCells,col.key)}else{this._detachCells(headerCells,function(row){return row.children("th, td").not("[data-skip=true]")},position,this._detachedHeaderCells,col.key)}this._detachCells(this.footersTable().children("tfoot").children("tr"),function(row){return row.children("td").not("[data-skip=true]")},position,this._detachedFooterCells,col.key)},_attachColumn:function(col){var headerCells,visibleCols=this._visibleColumns(),position=$.inArray(col,visibleCols);this._initializeDetachedContainers();if(this._isMultiColumnGrid){this._showMultiHeaderCells(col.key);headerCells=this.headersTable().children("thead").children("tr:not([data-mch-level])").not("[data-skip=true]");this._attachCells(headerCells,function(row){return row.children("th, td").not("[data-skip=true]")},position,this._detachedHeaderCells,col.key)}else{this._attachCells(this.headersTable().children("thead").children("tr").not("[data-skip=true]"),function(row){return row.children("th, td").not("[data-skip=true]")},position,this._detachedHeaderCells,col.key)}this._attachCells(this.footersTable().children("tfoot").children("tr"),function(row){return row.children("td").not("[data-skip=true]")},position,this._detachedFooterCells,col.key)},_initializeDetachedContainers:function(){if(!this._detachedContainersInitialized){this._detachedHeaderCells={};this._detachedFooterCells={};this._detachedContainersInitialized=true}},_getParentsMultiHeader:function(key){var i,cols=this._oldCols,colsLength=cols.length,arr=[];for(i=0;i<colsLength;i++){if(cols[i].key===key||cols[i].identifier===key){arr.push(cols[i]);break}if(cols[i].group){if(this._getParentsMultiHeaderRecursive(key,cols[i].group,arr)===true){arr.push(cols[i]);break}}}return arr},_getParentsMultiHeaderRecursive:function(key,arr,resArr){var i,cols=arr,colsLength=arr.length,res=false;for(i=0;i<colsLength;i++){if(cols[i].key===key||cols[i].identifier===key){resArr.push(cols[i]);res=true;break}if(cols[i].group&&this._getParentsMultiHeaderRecursive(key,cols[i].group,resArr)===true){resArr.push(cols[i]);res=true;break}}return res},_hideMultiHeaderCells:function(headerCells,position,key){var i,currentCell,parents=this._getParentsMultiHeader(key),parent,colspan,$th,headersTable=this.headersTable().find("thead > tr");currentCell=headerCells[position];this._headerCells.splice(position,1);currentCell.css("display","none");this._hiddenColumns[key]=currentCell;if(parents.length>0){for(i=0;i<parents.length;i++){parent=parents[i];if(parent.level===0){continue}$th=headersTable.find("th[data-mch-id="+parent.identifier+"]");colspan=parseInt($th.attr("colspan"),10);if(colspan>1){$th.attr("colspan",--colspan);parent.colspan=colspan}else{$th.attr("ishidden",1);$th.css("display","none");parent.hidden=true;parent.colspan=0}}}},_detachCells:function(rows,cellSelectorFunction,position,container,key){var detachedCells=[],i,cells,currentCell;if(rows.length>0){for(i=0;i<rows.length;i++){cells=cellSelectorFunction(rows.eq(i));currentCell=cells.eq(position);if(cells.length===1){currentCell.after($("<"+currentCell[0].tagName+"></"+currentCell[0].tagName+">").attr("data-hiddenreplacement","true").css("height",currentCell.height()).attr("class",currentCell.attr("class")))}detachedCells.push(currentCell.detach())}container[key]=detachedCells}},_showMultiHeaderCells:function(key){var i,currentCell=this._hiddenColumns[key],parents=this._getParentsMultiHeader(key),parent,colspan,$th,currentOrder,order,headerCellsLength=this._headerCells.length,headersTable=this.headersTable().find("thead > tr"),isHidden;if(currentCell===null||currentCell===undefined){return}currentOrder=currentCell.data("data-mch-order");for(i=0;i<headerCellsLength;i++){order=this._headerCells[i].data("data-mch-order");if(currentOrder<order){this._headerCells.splice(i,0,currentCell);break}}if(i===headerCellsLength){this._headerCells.push(currentCell)}currentCell.css("display","");currentCell.removeAttr("ishidden");if(parents.length>0){for(i=0;i<parents.length;i++){parent=parents[i];if(parent.level===0){continue}$th=headersTable.find("th[data-mch-id="+parent.identifier+"]");isHidden=$th.attr("ishidden")==="1";colspan=parseInt($th.attr("colspan"),10);if(!isHidden){$th.attr("colspan",++colspan);parent.colspan=colspan}else{$th.removeAttr("ishidden");$th.css("display","");parent.hidden=false;parent.colspan=1}}}},_attachCells:function(rows,cellSelectorFunction,position,container,key){var detachedCells,i,cells,replacementCell,storedKey;if(rows.length>0){if(this.options.virtualization===true||this.options.columnVirtualization===true){detachedCells=container[key];if(detachedCells===null||detachedCells===undefined){for(storedKey in container){if(container.hasOwnProperty(storedKey)){detachedCells=container[storedKey];delete container[storedKey];break}}}else{delete container[key]}}else{detachedCells=container[key];delete container[key]}if(detachedCells===undefined||detachedCells===null){return}for(i=0;i<rows.length;i++){cells=cellSelectorFunction(rows.eq(i)).not("[data-hiddenreplacement=true]");if(position===0){if(cells.length===0){replacementCell=rows.eq(i).find("[data-hiddenreplacement=true]");replacementCell.after(detachedCells[i]);replacementCell.remove()}else{cells.eq(0).before(detachedCells[i])}}else{cells.eq(position-1).after(detachedCells[i])}}}},_cleanupTBody:function(){var tbody=this.element.children("tbody");if($.ui.igGrid.speedupDOMCleanup===false){tbody.empty()}else{if(tbody.children().length>0){this.element[0].removeChild(tbody[0]);tbody=$("<tbody></tbody>").appendTo(this.element).addClass(this.css.baseContentClass).addClass(this.css.gridTableBodyClass).addClass(this.css.recordClass)}}return tbody},_captureInitiallyHiddenColumns:function(){this._initialHiddenColumns=$.grep(this.options.columns,function(column,index){var hidden=column.hidden;column.hidden=false;return hidden})},getUnboundValues:function(key){var res;if(key===undefined||key===null){return this._unboundValues}res=this._unboundValues[key];if(res===undefined||res===null){if(this.getUnboundColumnByKey(key)!==null){res=[]}else{res=null}}return res},setUnboundValues:function(key,values){this._setRenderUndobundValues(values,key)},_setRenderUndobundValues:function(values,key,notToRender){var i,data=this.dataSource.data(),dataLength=data.length,valuesLength=values.length,isToConvert=false,type="string",pk=this.options.primaryKey,col,schema,pkVal;if(valuesLength===0){return}col=this.getUnboundColumnByKey(key);if(col===null){return}if(this.dataSource&&this.dataSource.schema){if(col.dataType){type=col.dataType;isToConvert=true;schema=this.dataSource.schema()}}if(pk===undefined){pk=null}for(i=0;i<valuesLength;i++){if(data[i]===undefined||data[i]===null){break}if(isToConvert){if(pk===null){pkVal=i}else{pkVal=data[i][pk]}values[i]=schema._convertType(type,values[i],pkVal,key)}data[i][key]=values[i];this._addUnboundColumnValue(key,values[i],i)}if((type==="bool"||type==="boolean")&&valuesLength<dataLength){for(i=valuesLength;i<dataLength;i++){data[i][key]=schema._convertType(type,null,pkVal,key)}}if(this.options.virtualization===true||this.options.rowVirtualization===true){this._scrollTo(0)}if(notToRender!==true){this._renderColumnData(key,this.dataSource.dataView())}},getUnboundColumnByKey:function(key){if(this._unboundColumns===undefined||this._unboundColumns===null||this._unboundColumns.length===0||key===null||key===undefined){return null}var column=null;$.each(this._unboundColumns,function(ind,col){if(col.key===key){column=col;return false}});return column},_renderColumnData:function(key,values){if(values.length===0){return}var visibleColumns=this._visibleColumns(),grid=this,tdIndex,index,tds,column,ds,isToConvertToString=false,hasTemplate=grid.options.rowTemplate&&grid.options.rowTemplate.length>0;index=this._getVisibleIndexByKey(key);column=visibleColumns[index];if(column===undefined||column===null){return}isToConvertToString=column.dataType==="bool";if(hasTemplate){ds=this.dataSource.dataView()}tdIndex=index+this.headersTable().find(">thead>tr:eq(0)>th[data-skip=true]").length;tds=this.element.find(">tbody> tr > td:not([data-skip]):nth-child("+(tdIndex+1)+")");$.each(values,function(ind,val){var innerHtml;if(val[key]===undefined){return true}if(hasTemplate){innerHtml=grid._renderTemplatedCell(ds[ind],column).substring(1)}else{innerHtml=grid._renderCell(val[key],column,val);if(isToConvertToString===true){innerHtml=innerHtml.toString()}}if(!tds[ind]){return false}$(tds[ind]).html(innerHtml)})},_renderData:function(success,errmsg){if(!(this._isDataBoundCalled===true&&success===undefined)||success!==undefined){this._trigger(this.events.dataBound,null,{owner:this});this._isDataBoundCalled=false}var gridElement=this.element,self=this,noCancel=true,sum=0,cols,colsToUnbound,colsLength,data,key,j,i,diff=0,isTable=false,noCancelError=true,isRemoteDS=this._inferOpType()==="remote",ucFormulaFunction,tbody,newW,totalWidth,isToRefreshUI=false,displayCont;if((this.options.requiresDataBinding===true||this._isToSetUnboundColumns===true||isRemoteDS)&&this._hasUnboundColumns){this._isToSetUnboundColumns=false;if(this._hasInitialUnboundValues===null||this._hasInitialUnboundValues===undefined){this._hasInitialUnboundValues={}}cols=this.options.columns;colsLength=cols.length;data=this.dataSource.data();ucFormulaFunction=function(ind,val){if($.type(cols[i].formula)==="function"){val[key]=cols[i].formula(val,gridElement)}else{val[key]=eval(cols[i].formula+"(val, gridElement)")}self._addUnboundColumnValue(key,val[key],ind)};colsToUnbound=[];if(isRemoteDS){this._unboundValues={}}for(i=0;i<colsLength;i++){if(cols[i].unbound===true){key=cols[i].key;if(cols[i].unboundValues!==null&&cols[i].unboundValues!==undefined&&$.type(cols[i].unboundValues)==="array"){if(this._rebindUnboundColumns===true||cols[i].unboundValues.length>0&&this._hasInitialUnboundValues[key]===undefined){this._hasInitialUnboundValues[key]=true;this._setRenderUndobundValues(cols[i].unboundValues,key,true)}}else if(cols[i].formula!==null&&cols[i].formula!==undefined){$.each(data,ucFormulaFunction)}else if(this._unboundValues[key]&&this._unboundValues[key].length>0){colsToUnbound.push(key)}}}if(this.options.localSchemaTransform===true&&colsToUnbound.length>0&&data.length>0){for(i=0;i<colsToUnbound.length;i++){key=colsToUnbound[i];if(data[0][key]===undefined){this.setUnboundValues(key,this._unboundValues[key])}}}if(this.options.mergeUnboundColumns===false){this._mergeUnboundValues()}}if(success===false){noCancelError=this._trigger(this.events.requestError,null,{owner:this,message:errmsg});if(noCancelError){throw new Error(errmsg)}}if(this._cancelRendering===true){this._cancelRendering=false;return}this.element.trigger("iggriduisoftdirty",{owner:this});if(!this._initialized){if(this.options.autoGenerateColumns===true){this._generateColumns();if((this.options.virtualization===true||this.options.columnVirtualization===true)&&this.options.width){totalWidth=this._calculateContainerWidth(false);if(totalWidth>parseInt(this.options.width,10)&&$("#"+this.id()+"_horizontalScrollContainer").children().length===0){this._renderHorizontalScrollContainer(totalWidth)}}for(i=0;i<this.options.features.length;i++){this._initFeature(this.options.features[i],this._dataOptions)}}}tbody=gridElement.children("tbody");noCancel=this._trigger(this.events.dataRendering,null,{owner:this,tbody:tbody});if(noCancel){if(!(this.options.dataSource&&this.options.dataSource.tagName&&$(this.options.dataSource).is("table"))){tbody=this._cleanupTBody()}else{isTable=true}this._virtualDom=null;if(!this._initialized){if(this.options.autoGenerateColumns===true){this._captureInitiallyHiddenColumns();this._visibleColumnsArray=undefined;this._updateVirtColCounters()}if(isTable){tbody.empty()}if(this._renderHeaderCalled!==true){this._renderHeader();this._renderCaption()}else{if(this.options.width!==null&&this.options.height===null){this.scrollContainer().css("overflow-y","hidden").css("overflow-x","auto")}}if(this.element.find("colgroup").length===0||this.element.find("colgroup").children().length===0){this._renderColgroup(this.element[0],false,false,this.options.autofitLastColumn)}this._renderFooter()}this._trigger("dataEmpty",null,{owner:this,tbody:tbody});if(this.options.autoGenerateColumns===false&&(this.options.columns&&this.options.columns.length===0||!this.options.columns)){throw new Error($.ig.Grid.locale.noColumnsButAutoGenerateTrue)}if(this._hasColumnTemplates()&&this.options.rowTemplate===null){this.options.rowTemplate=this._buildRowTemplateRaw()}if(this.options.rowTemplate&&!this._tmap){this._initializeTmap()}if(this._initialHiddenColumns===undefined||this._initialHiddenColumns.length===0){if(this.options.columns.length>0){if(this.options.virtualization===true||this.options.rowVirtualization===true||this.options.columnVirtualization===true){this._renderVirtualRecords()}else{this._renderRecords()}if(this._initialized){this._adjustLastColumnWidth(false);if(this.options.width!==null&&this.options.height!==null){this._synchronizeHScroll()}}else{if(this.options.height!==null&&this.options.autoAdjustHeight){this._initializeHeights()}this._adjustLastColumnWidth(true)}}}if(!this._initialized){if(this.options.autoAdjustHeight){this._initializeHeights()}}if(this._initialHiddenColumns!==undefined&&this._initialHiddenColumns.length>0){this._setHiddenColumns(this._initialHiddenColumns,true,true);if(this._initialHiddenCells!==undefined&&this._initialHiddenCells.length>0){$.each(this._initialHiddenCells,function(index,cell){cell.css("display","")})}$.each(this._initialHiddenColumns,function(index,column){column._initiallyHidden=true});this._initialHiddenCells=undefined;this._initialHiddenColumns=undefined;if($.ig.util.isFF){isToRefreshUI=true}}if(this.options.rowTemplate!==null&&this._hasOptionsRowTemplate===false){this.options.rowTemplate=this._buildRowTemplateRaw(true);this._tmpl=null}this._registerAdditionalEvents();this._trigger(this.events.dataRendered,null,{owner:this});this._updateVirtualScrollContainer();this._fireInternalEvent("_dataRendered");if(this._loadingIndicator===undefined){this._initLoadingIndicator()}this._loadingIndicator.hide()}if(this._fixScrollY){this.scrollContainer().css("overflow-y",this.rows().length>1?"hidden":"visible")}if(this.options.width===null&&this.container()[0]&&this.container()[0].style.width){cols=this.element.find("colgroup > col[data-skip]");if(cols.length>0){for(j=0;j<cols.length;j++){sum+=parseInt(cols[j].style.width,10)}}if(!this._origSum){this._origSum=0}diff=sum-this._origSum;if(diff<0){diff=0}newW=parseInt(this.container()[0].style.width,10)+diff;this.container().css("width",newW);displayCont=this._vdisplaycontainer();if(displayCont.length>0){displayCont.css("width",newW-this._scrollbarWidth()).css("max-width",newW-this._scrollbarWidth());this.container().find("#"+this.id()+"_headers_v").css("width",newW);this._fixedfooters().css("width",newW)}this._origSum=sum}if(this.options.dataSourceUrl!==null&&this._firstBind){this.options.dataSource=this.options.dataSourceUrl;this.dataSource.settings.dataSource=this.options.dataSourceUrl;this.dataSource.settings.type="remoteUrl";this.dataSource._runtimeType=this.dataSource.analyzeDataSource();this._firstBind=false}if(!this._initialized){this._trigger(this.events.rendered,null,{owner:this});this._hc=this.container().find(".ui-iggrid-expandheadercell").length>0;this._initialized=true;if(document.documentMode===7||$.ig.util.isIE7){$.each($("#"+this.id()+"_container colgroup col"),function(){var $col=$(this),styleWidth=parseInt(this.style.width,10),width=$col.outerWidth();if(styleWidth&&styleWidth<width){$col.width(2*styleWidth-width)}})}}if(isToRefreshUI){this._refreshUI()}this._fireInternalEvent("_gridRendered",this.container())},_refreshUI:function(){var self=this;self.container().hide();setTimeout(function(){self.container().show()},0)},_updateVirtualScrollContainer:function(){var headersHeight=0;this._totalRowCount=this._getTotalRowCount();if((this.options.virtualization||this.options.rowVirtualization)&&this._totalRowCount){if(this._avgRowHeight===undefined||this._avgRowHeight===null){this._avgRowHeight=this._calculateAvgRowHeight()}if(this.options.showHeader){headersHeight=this.headersTable().height()}if(this._totalRowCount*this._avgRowHeight<=parseInt(this.options.height,10)-headersHeight){this.element.height("");if(this.options.virtualizationMode==="fixed"){this.element.find(".ui-iggrid-virtualrow").height(this._avgRowHeight)}this._setScrollContainerHeight(this._totalRowCount*parseInt(this._avgRowHeight,10))}else{this.element.height(this._initialVirtualHeight);if(this.options.virtualizationMode==="continuous"){this._setScrollContainerHeight(this._totalRowCount*parseInt(this._avgRowHeight,10))}}}},_hasColumnTemplates:function(){var i,hasTemplates=false,t;
for(i=0;i<this.options.columns.length;i++){t=this.options.columns[i].template;if(t!==null&&t!==undefined&&t!==""&&t.length>0){hasTemplates=true;break}}return hasTemplates},_gridHasWidthInPixels:function(){if(typeof this.options.width==="string"&&this.options.width.indexOf("%")!==-1){return false}return parseInt(this.options.width,10)>0},_gridHasWidthInPercent:function(){if(typeof this.options.width==="string"&&this.options.width.indexOf("%")!==-1){return true}return false},_adjustLastColumnWidth:function(colgroupsRerendered){var grid=this,hasFixedHeader=this.options.height!==null&&this.options.fixedHeaders===true&&this.options.showHeader&&this._headerParent,hasFixedFooter=this.options.height!==null&&this.options.fixedFooters===true&&this.options.showFooter&&this._footerParent,hasHeight=this.options.height&&parseInt(this.options.height,10)>0,hasWidthInPixels=this._gridHasWidthInPixels(),hasWidthInPercent=this._gridHasWidthInPercent(),hasVirtualization=this.options.virtualization===true||this.options.columnVirtualization===true||this.options.rowVirtualization===true,gridWidth,specialColumnsWidth;if(hasHeight&&!hasVirtualization){if(this.options.autoAdjustHeight&&this.element.height()<=this.scrollContainer().height()||!this.options.autoAdjustHeight&&this.options.avgRowHeight*this.element[0].rows.length<parseInt(this.options.height,10)){this._hasVerticalScrollbar=false}else{this._hasVerticalScrollbar=true}}if(colgroupsRerendered){if(hasVirtualization){if(hasFixedHeader){this._headerParent.css(this._padding,this._scrollbarWidth())}if(hasFixedFooter){this._footerParent.css(this._padding,this._scrollbarWidth())}}if(hasWidthInPixels||hasWidthInPercent){if(this._allColumnWidthsInPixels){gridWidth=this._totalColPixelWidth;specialColumnsWidth=this._calculateSpecialColumnsWidth();if(specialColumnsWidth>0){if(this._autoadjustedColumn&&this._lastColPixelWidth){if(this._autoadjustedColumn.difference<specialColumnsWidth){this._lastColPixelWidth-=this._autoadjustedColumn.difference;gridWidth-=this._autoadjustedColumn.difference-specialColumnsWidth}else{this._lastColPixelWidth-=specialColumnsWidth}this._autoadjustedColumn.width=this._lastColPixelWidth;if(hasFixedHeader){this._lastHeaderCol.css("width",this._lastColPixelWidth+"px")}if(hasFixedFooter){this._lastFooterCol.css("width",this._lastColPixelWidth+"px")}this._lastDataCol.css("width",this._lastColPixelWidth+"px")}else{gridWidth+=specialColumnsWidth}}if(!hasFixedHeader&&this._gridWidthGTColWidth&&this._hasVerticalScrollbar){gridWidth-=this._scrollbarWidth();this._lastColPixelWidth-=this._scrollbarWidth();this._lastDataCol.css("width",this._lastColPixelWidth+"px")}}else if(this._allColumnWidthsInPercentage){gridWidth=this.container().width();specialColumnsWidth=this._calculateSpecialColumnsWidth();if(this._allSpecialColumnsInPercentage()===true&&specialColumnsWidth>0){this._lastColPercentWidth=this._lastColPercentWidth-specialColumnsWidth}this._lastDataCol.css("width",this._lastColPercentWidth+"%");if(hasFixedHeader){this._lastHeaderCol.css("width",this._lastColPercentWidth+"%")}if(hasFixedFooter){this._lastFooterCol.css("width",this._lastColPercentWidth+"%")}}else if(hasWidthInPixels){gridWidth=parseInt(grid.options.width,10)}else if(hasWidthInPercent){gridWidth=this.container().width()}if(!this._allColumnWidthsInPercentage||!hasWidthInPercent){if(hasVirtualization===false){this._gridInnerWidth=this.scrollContainer().width()}else{this._gridInnerWidth=this._vdisplaycontainer().width()+this._scrollbarWidth()}grid._setGridContentWidth(gridWidth)}}}else{this._setGridContentWidth()}if(hasHeight&&!hasVirtualization){if(this.options.width!==null&&this.options.height!==null){if(this._hasVerticalScrollbar){this._hscrollbarcontent().css("overflow-y","scroll")}else{this._hscrollbarcontent().css("overflow-y","hidden")}}if(this._allColumnWidthsInPercentage&&hasWidthInPercent||!(hasWidthInPixels||hasWidthInPercent)){if(this._hasVerticalScrollbar){if(hasFixedHeader){this._headerParent.css(this._padding,this._scrollbarWidth())}if(hasFixedFooter){this._footerParent.css(this._padding,this._scrollbarWidth())}}else{if(hasFixedHeader){this._headerParent.css(this._padding,"")}if(hasFixedFooter){this._footerParent.css(this._padding,"")}}}else{this._updateVerticalScrollbarCellPadding()}}},_initializeHeights:function(){var initialHeight,hscrollerContainerHeight;if(this.options.height===null||this.options.height===undefined){return}initialHeight=parseInt(this.options.height,10);if(this.hasFixedColumns()){if(this.options.showHeader&&this.options.fixedHeaders===true&&this.options.height!==null){initialHeight-=this.fixedHeadersTable().height()}hscrollerContainerHeight=this._hscrollbar().height();if(this.fixedBodyContainer().height()<initialHeight+hscrollerContainerHeight){initialHeight-=hscrollerContainerHeight}}if(this.options.height.indexOf&&this.options.height.indexOf("%")!==-1){this.scrollContainer().height("100%")}else{this.scrollContainer().height(initialHeight)}this._initializeHeightsInternal()},_initializeHeightsInternal:function(){var children,height,i,$child,ch,heightChanged=false,dc=this._vdisplaycontainer(),sc=this._scrollContainer();ch=this.container().height();this._prevContainerHeight=ch;if(this.options.height!==null){children=this.container().children();height=0;for(i=0;i<children.length;i++){$child=$(children[i]);if(($child.attr("id")!==undefined&&!$child.attr("id").endsWith("_scroll")&&!$child.attr("data-fixed-container")&&!$child.attr("id").endsWith("_virtualContainer")&&!$child.attr("id").endsWith("_loading")||!$child.attr("id"))&&$child.is(":visible")&&$child.data("efh")!=="1"){if($child.is("table")&&$child.children().first().is("caption")){height+=$child.children().first().outerHeight()}else{height+=$child.outerHeight()}}}if(height>0){this.scrollContainer().height(ch-height);heightChanged=true}if(this.options.virtualization||this.options.rowVirtualization){if($.type(this.options.height)==="string"&&this.options.height.indexOf("%")!==-1||ch!==parseInt(this.options.height,10)){this.container().height(this.options.height);if($.type(this.options.height)==="string"&&this.options.height.indexOf("%")!==-1){ch=parseInt(this.container().height(),10)}}height+=this.container().find("#"+this.id()+"_headers_v").outerHeight();height+=this.container().find("#"+this.id()+"_footers_v").outerHeight();height+=this._fixedfooters().outerHeight();height+=this._vhorizontalcontainer().outerHeight();if(!this._virtualHeightReset){height=height*2;this._virtualHeightReset=true}if(height>0&&dc.height()!==ch-height){dc.height(ch-height);sc.height(ch-height);this.element.height(ch-height);this._initialVirtualHeight=ch-height;this._virtualDom=null;heightChanged=true}}if(heightChanged){this._trigger("_heightChanged",null,{ch:ch,h:height})}}},_registerAdditionalEvents:function(){var css="ui-state-hover",topmostGrid=this.element.closest(".ui-iggrid-root").data("igGrid")||this;if(this.options.enableHoverStyles){if(this._hovEvts){this.element.unbind(this._hovEvts)}this._hovEvts={mousemove:function(e){var par,tag,tr=e.target;while(tr){par=tr.parentNode;tag=tr.nodeName;if(tag==="TR"&&par.nodeName==="TBODY"){break}tr=tag==="TABLE"?null:par}if(_hovTR!==tr){if(_hovTR&&$(_hovTR).attr("data-container")!=="true"){$("td",_hovTR).removeClass(css)}if(tr&&$(tr).attr("data-container")!=="true"&&e.target.id.indexOf("_scrollContainer")===-1&&e.target.parentNode.id.indexOf("_scrollContainer")===-1){if(!topmostGrid._cancelHoveringEffects){$("td",tr).addClass(css)}}_hovTR=tr}},mouseleave:function(e){if(_hovTR){$("td",_hovTR).removeClass(css);_hovTR=null}}};this.element.bind(this._hovEvts)}},_renderColgroup:function(table,isHeader,isFooter,autofitLastColumn){var colgroup,i,cols=this._visibleColumns(),defWidth=this.options.defaultColumnWidth,totalColWidth=0,totalGridWidth,hasWidthInPixels=this._gridHasWidthInPixels(),hasWidthInPercent=this._gridHasWidthInPercent(),hasWidth=hasWidthInPixels||hasWidthInPercent,hasVirtualization=this.options.virtualization===true||this.options.columnVirtualization===true||this.options.rowVirtualization===true,hasColumnVirtualization=this.options.virtualization===true&&this.options.virtualizationMode==="fixed"||this.options.columnVirtualization===true,hasColumnsWithNoWidth=false,isPercentage=true,desiredColWidth,desiredColWidthNumber,lastCol,lastColWidth,difference;colgroup=$(table).find("colgroup");if(colgroup.length===0){colgroup=$("<colgroup></colgroup>").prependTo(table)}if(hasVirtualization&&this.options.virtualizationMode==="fixed"||hasColumnVirtualization){this._updateVirtColCounters();cols=cols.slice(0,this._virtualColumnCount)}for(i=0;i<cols.length;i++){if(cols[i].width){if(cols[i].oWidth){desiredColWidth=cols[i].oWidth}else{desiredColWidth=cols[i].width}}else{desiredColWidth=defWidth;cols[i].width=defWidth}if(desiredColWidth){if(!desiredColWidth.charAt||!desiredColWidth.endsWith("%")){isPercentage=false}desiredColWidthNumber=parseInt(desiredColWidth,10);if(desiredColWidthNumber<=0){desiredColWidthNumber=undefined}}else{desiredColWidthNumber=undefined;isPercentage=false}if(desiredColWidthNumber){lastCol=$("<col></col>").appendTo(colgroup).css("width",desiredColWidth);lastColWidth=desiredColWidthNumber;totalColWidth+=desiredColWidthNumber}else{lastCol=$("<col></col>").appendTo(colgroup);lastColWidth=undefined;hasColumnsWithNoWidth=true}}if(!hasColumnVirtualization&&autofitLastColumn&&hasWidth&&!hasColumnsWithNoWidth&&lastColWidth){if(isPercentage){if(totalColWidth<100){lastColWidth+=100-totalColWidth;lastCol.css("width",lastColWidth+"%");this._autoadjustedColumn=cols.slice(-1)[0];if(!this._autoadjustedColumn.oWidth){this._autoadjustedColumn.oWidth=this._autoadjustedColumn.width}this._autoadjustedColumn.width=lastColWidth+"%"}}else{if(hasWidthInPixels){totalGridWidth=parseInt(this.options.width,10)}else if(hasWidthInPercent){totalGridWidth=this.container().width()}if(totalGridWidth&&totalGridWidth>totalColWidth){difference=totalGridWidth-totalColWidth;lastColWidth+=difference;totalColWidth+=difference;lastCol.css("width",lastColWidth+"px");this._autoadjustedColumn=cols.slice(-1)[0];if(!this._autoadjustedColumn.oWidth){this._autoadjustedColumn.oWidth=this._autoadjustedColumn.width}this._autoadjustedColumn.width=lastColWidth+"px";this._autoadjustedColumn.difference=difference;this._gridWidthGTColWidth=true}}}else{this._autoadjustedColumn=undefined}if(hasWidth&&hasVirtualization&&!hasColumnsWithNoWidth&&lastColWidth){if(!isPercentage){lastColWidth-=this._scrollbarWidth();lastCol.css("width",lastColWidth+"px")}}if(isHeader){this._lastHeaderCol=lastCol}if(isFooter){this._lastFooterCol=lastCol}if(!isHeader&&!isFooter){this._lastDataCol=lastCol}this._allColumnWidthsInPercentage=isPercentage&&!hasColumnsWithNoWidth&&cols.length>0;this._allColumnWidthsInPixels=!isPercentage&&!hasColumnsWithNoWidth&&cols.length>0;if(this._allColumnWidthsInPixels){this._lastColPixelWidth=lastColWidth;this._totalColPixelWidth=totalColWidth}else if(this._allColumnWidthsInPercentage){this._lastColPercentWidth=lastColWidth;this._totalColPixelWidth=undefined}else{this._lastColPixelWidth=undefined;this._totalColPixelWidth=undefined}},_buildRowTemplateRaw:function(removeHiddenColumns){var tmpl="<tr>",i,c=this.options.columns,jsrnd=String(this.options.templatingEngine).toLowerCase()==="jsrender";for(i=0;i<c.length;i++){if(c[i].template){tmpl+="<td>"+c[i].template+"</td>"}else{tmpl+=(jsrnd?"<td>{{>":"<td>{{html ")+c[i].key+"}}</td>"}}tmpl+="</tr>";return tmpl},_generateRowTemplate:function(){var key,type,format,auto=this.options.autoFormat,ar=this.options.accessibilityRendering,firstRec=null,grid=this,i,prop,tmpl=grid.options.rowTemplate,cols=grid.options.columns,id='data-id="${ig_pk}"';if(this.options.virtualization&&this.options.virtualizationMode==="continuous"){id+=' data-row-idx="${ig_abs_idx}"'}if(this._tmpl){return this._tmpl}if(grid.dataSource.dataView().length>0){firstRec=grid.dataSource.dataView()[0]}if(tmpl){i=tmpl.indexOf("<tr");if(i>=0&&tmpl.indexOf(".ig_pk")<0){tmpl=tmpl.substring(0,i+3)+" "+id+tmpl.substring(i+3)}for(i=0;i<cols.length;i++){key=cols[i].key;if(cols[i].formatter){format="${$item."+key+"Formatter(this.data ? this.data."+key+" : undefined)}"}else{format=cols[i].format;type=cols[i].dataType;type=type==="date"||type==="number"?type:"";if(format||(auto===true||auto==="dateandnumber")&&type||auto&&auto===type){format="${"+key+"}"}}if(format){tmpl=tmpl.replace(new RegExp("\\$ *\\{ *"+key+" *\\}","g"),format)}}}else{if(ar){tmpl='<tr role="row" '}else{tmpl="<tr "}tmpl+=id;if(this.options.alternateRowStyles){tmpl+="class=\"{{if $i % 2 === 0}}''{{else}}"+this.css.recordAltClass+'{{/if}}">'}else{tmpl+=">"}if(cols.length>0){if(firstRec===null||firstRec.hasOwnProperty(cols[0].key)&&$.type(firstRec)!=="array"){for(i=0;i<cols.length;i++){key=cols[i].key;if(ar){tmpl+='<td role=gridcell aria-describedby="'+key+'">'}else{tmpl+="<td>"}if(cols[i].formatter!==undefined){tmpl+="${$item."+key+"Formatter(this.data ? this.data."+key+" : undefined)}</td>"}else{format=cols[i].format;type=cols[i].dataType;type=type==="date"||type==="number"?type:"";if(format||(auto===true||auto==="dateandnumber")&&type||auto&&auto===type){tmpl+="${"+key+"}</td>"}else if(type==="bool"){tmpl+="${"+key+"}</td>"}else{tmpl+="${"+key+"}</td>"}}}}else{tmpl+="{{each $data}}";if(ar){tmpl+='<td role="gridcell">${this}</td>'}else{tmpl+="<td>${this}</td>"}tmpl+="{{/each}}"}}else{if(grid.dataSource.dataView().length>0){for(prop in firstRec){if(firstRec.hasOwnProperty(prop)){if(ar){tmpl+='<td role="gridcell">${'+prop+"}</td>"}else{tmpl+="<td>${"+prop+"}</td>"}}}}else{throw new Error($.ig.DataSourceLocale.locale.cannotBuildTemplate)}}tmpl+="</tr>"}this._tmpl=tmpl;return tmpl},_renderRecords:function(start,end){var prime,grid=this,tbody=this.element.children("tbody"),tmpl,ph,rs,ds=this.dataSource.dataView(),i,d="",noCancel=true,tbodytmp;this._trigger("_rowsRendering",null,{owner:this,tbody:tbody,vrtWnd:{start:start,end:end}});noCancel=this._trigger(this.events.rowsRendering,null,{owner:this,tbody:tbody,vrtWnd:{start:start,end:end}});if(start===undefined){start=0;end=ds.length-1}if(start!==undefined&&end===undefined){end=start;if(end>ds.length-1){end=ds.length-1}start=0}if(start<0){start=0}if(end>ds.length-1){end=ds.length-1}if(noCancel){if(!grid.options.rowTemplate||grid.options.rowTemplate.length<=0){for(i=start;i<=end;i++){d+=grid._renderRecord(ds[i],i)}if(!this._canreplaceinner||$.ig.util.isWebKit){ph=document.createElement("div");ph.innerHTML="<table><tbody>"+d+"</tbody></table>";tbodytmp=ph.firstChild.firstChild;this.element[0].replaceChild(tbodytmp,tbody[0])}else if(this._canreplaceinner){MSApp.execUnsafeLocalFunction(function(){tbody[0].innerHTML=d})}d=""}else if(ds.length>0){tmpl=this._generateRowTemplate();if(tmpl.lastIndexOf("ui-iggrid-rowselector-class")>-1){rs=true}for(i=start;i<=end;i++){prime=_aNull(this.options.primaryKey)?ds[i].ig_pk:this._kval_from_key(this.options.primaryKey,ds[i]);ds[i].ig_pk=_aNull(prime)?i:prime;if(this.options.virtualization&&this.options.virtualizationMode==="continuous"){ds[i].ig_abs_idx=i}if(rs){ds[i].ig_rs_idx=$.ig.rowNumberingFunctionDelegate(ds[i].ig_pk)}d+=grid._renderRecord(ds[i],i)}tbody.html(d);d="";if(rs){for(i=0;i<ds.length;i++){ds[i].ig_rs_idx=null}}}this._buildVirtualDomForContinuousVirtualization();this._trigger(this.events.rowsRendered,null,{owner:this,tbody:tbody})}},_buildFormatters:function(){var i,cols=this.options.columns,ret={};for(i=0;i<cols.length;i++){if(cols[i].formatter!==undefined){if($.type(cols[i].formatter)==="function"){ret[cols[i].key+"Formatter"]=cols[i].formatter}else{ret[cols[i].key+"Formatter"]=eval(cols[i].formatter)}}}return ret},_getVisibleIndexByKey:function(columnKey){var hasFixedColumns=this.hasFixedColumns(),fixedCounters,unfexedCounters,prevColumn,cols=this._visibleColumns(),index=-1;if(hasFixedColumns){fixedCounters=0;unfexedCounters=0;prevColumn=null;$.each(cols,function(ind,value){var isFixed=value.fixed===true,prevColumnFixed=prevColumn&&prevColumn.fixed===true;if(prevColumn===null||prevColumnFixed!==isFixed){if(value.fixed===true){fixedCounters=0}else{unfexedCounters=0}}prevColumn=value;if(isFixed!==true){unfexedCounters++}else{fixedCounters++}if(value.key===columnKey){if(isFixed){index=fixedCounters-1}else{index=unfexedCounters-1}return false}})}else{$.each(cols,function(ind,value){if(value.key===columnKey){index=ind;return false}})}return index},_isColumnHidden:function(columnKey){var cols=this.options.columns,i=cols.length;while(i-->=0){if(cols[i].key===columnKey){return cols[i].hidden||false}}return true},_visibleColumns:function(){if(this._visibleColumnsArray===undefined){this._visibleColumnsArray=$.grep(this.options.columns,function(col){return!col.hidden})}return this._visibleColumnsArray},_visibleMchColumns:function(curLvl){var vmch=[],cl=curLvl||this._oldCols,self=this;if(!cl){return null}$.each(cl,function(){if(!this.hidden||this.hidden===false){vmch.push($.extend({},this));if(this.group){vmch[vmch.length-1].group=self._visibleMchColumns(this.group)}}});return vmch},_renderVirtualRecordsFixed:function(){var i,j,row,c,val,headersTexts,headerText,vheaderNode,iRow,tr,ds=this.dataSource,data=ds.dataView(),key=this.options.primaryKey,visibleCols=this._visibleColumns();this._trigger("virtualrendering");if(this._startRowIndex===undefined||this._startRowIndex===null){this._startRowIndex=0}if(this._startColIndex===undefined||this._startColIndex===null){this._startColIndex=0}if(this._virtualDom===null||this._virtualDom===undefined){this._buildVirtualDom();if(this.options.adjustVirtualHeights===true){this._adjustVirtualHeights()}}else{for(i=0;i<this._virtualRowCount&&i<this._totalRowCount&&this._startRowIndex+i<data.length;i++){if(!this.options.rowTemplate||this.options.rowTemplate.length<=0){for(j=0;j<this._virtualColumnCount;j++){if(this.options.columns.length>0){val=data[this._startRowIndex+i][visibleCols[this._startColIndex+j].key];this._virtualDom[i][j].innerHTML=this._renderCell(val,visibleCols[this._startColIndex+j],data[this._startRowIndex+i])}else{val=data[this._startRowIndex+i][this._startColIndex+j];this._virtualDom[i][j].innerHTML=data[this._startRowIndex+i][this._startColIndex+j]}this._virtualDom[i][j].className=""}}else{if($.type(data[i])==="array"){row=$(this._renderRecord([data[this._startRowIndex+i]],i))}else{row=$(this._renderRecord(data[this._startRowIndex+i],i))}c=row.children();for(j=0;j<this._virtualColumnCount;j++){this._virtualDom[i][j].innerHTML=c[j+this._startColIndex].innerHTML;this._virtualDom[i][j].className=""}}iRow=this._startRowIndex+i;tr=this._virtualDom[i][0].parentNode;tr.className=i%2===0&&this.options.alternateRowStyles?"ui-iggrid-virtualrow ui-ig-altrecord":"ui-iggrid-virtualrow";if(data[iRow]){if(!_aNull(key)){tr.setAttribute("data-id",this._kval_from_key(key,data[iRow]))}else if(!_aNull(data[iRow].ig_pk)){tr.setAttribute("data-id",data[iRow].ig_pk)}}}}if(this._isHorizontal){this._isHorizontal=false;if((this.options.virtualization===true||this.options.columnVirtualization===true)&&parseInt(this.options.width,10)>0){if(!this._vheaders){headersTexts=this.headersTable().find("thead > tr > th > a > span:first-child");if(headersTexts.length>0){this._vheaders=headersTexts}else{this._vheaders=this.headersTable().find("thead > tr > th > span")}}for(j=0;j<this._virtualColumnCount;j++){headerText=visibleCols[j+this._startColIndex].headerText;vheaderNode=$(this._vheaders[j]);vheaderNode.closest("th").attr("id",this.element[0].id+"_"+visibleCols[j+this._startColIndex].key);vheaderNode.html(headerText)}}}if(!this._calledScroll){this._trigger("virtualrecordsrender",null,{owner:this,tbody:this.element.children("tbody"),dom:this._virtualDom})}},_updateVirtColCounters:function(){var visibleColsLength=this._visibleColumns().length;if(this.options.columns){this._totalColumnCount=visibleColsLength;this._maxVirtualColumnCount=this.options.columns.length}else{this._totalColumnCount=this.dataSource.dataView()[0].length;this._maxVirtualColumnCount=this._totalColumnCount}if(this.options.columnVirtualization===false&&this.options.virtualization===false){this._virtualColumnCount=visibleColsLength}else{if(this.options.width===null){this._virtualColumnCount=this._totalColumnCount}else{this._virtualColumnCount=Math.ceil(parseInt(this.options.width,10)/this._avgColumnWidth());this._maxVirtualColumnCount=Math.min(this._maxVirtualColumnCount,this._virtualColumnCount);this._virtualColumnCount=Math.min(this._totalColumnCount,this._virtualColumnCount);this._vhorizontalcontainer().children().first().css("width",this._calculateContainerWidth(false))}}},_buildVirtualDom:function(){var grid=this,markup="",row,i,j,dataLinkFn,ar=this.options.accessibilityRendering,shouldHide=false,visibleCols=this._visibleColumns(),key=this.options.primaryKey,data=this.dataSource.dataView();if(this._startRowIndex===undefined||this._startRowIndex===null){this._startRowIndex=0;this._startColIndex=0;this._oldStartRowIndex=0;this._oldStartColIndex=0}this._virtualDom=[];this._totalRowCount=data.length;if(this.options.height===null){this._virtualRowCount=this._totalRowCount}else{if(this.options.height.indexOf&&this.options.height.indexOf("%")!==-1){this._virtualRowCount=Math.ceil(this._vdisplaycontainer().innerHeight()/parseInt(this.options.avgRowHeight,10),10)}else{this._virtualRowCount=Math.ceil(this._vdisplaycontainer().innerHeight()/parseInt(this.options.avgRowHeight,10),10)}}this._updateVirtColCounters();if(this.options.height!==null){this._setScrollContainerHeight(this._totalRowCount*parseInt(this.options.avgRowHeight,10))}dataLinkFn=function(row,i,vc){for(j=0;j<vc;j++){if(j<grid._totalColumnCount){grid._virtualDom[i][j]=row[0].cells[j]}}};this.element.children("tbody").empty();for(i=0;i<this._virtualRowCount;i++){shouldHide=false;this._virtualDom[i]=[];markup="";for(j=this._startColIndex;j<this._virtualColumnCount+this._startColIndex;j++){if(j>=this._totalColumnCount){break}if(ar){markup+='<td role="gridcell" '}else{markup+="<td "}if(this.options.columns.length>0){if(ar){markup+='aria-describedby="'+visibleCols[j].key+'"'}if(!data[i]){shouldHide=true;markup+="></td>"}else{if(this.options.autoFormat!==false){if(this.options.rowTemplate&&this.options.rowTemplate.length>0){markup+=this._renderTemplatedCell(data[i],visibleCols[j])+"</td>"}else{markup+=">"+this._renderCell(data[i][visibleCols[j].key],visibleCols[j],data[i])+"</td>"}}else{markup+=">"+data[i][visibleCols[j].key]+"</td>"}}}else{if(!data[i]){shouldHide=true;markup+="></td>"}else{markup+=data[i][j]+"</td>"}}}row=$("<tr>"+markup+"</tr>").appendTo(this.element.children("tbody"));if(shouldHide){row.css("visibility","hidden")}if(i%2===0&&this.options.alternateRowStyles){row.addClass("ui-ig-altrecord")}row.addClass("ui-iggrid-virtualrow");if(i%2===0&&this.options.alternateRowStyles){row.addClass("ui-ig-altrecord")}if(ar){row.attr("role","row")}if(data[i]){if(!_aNull(key)){row.attr("data-id",this._kval_from_key(key,data[i]))}else if(!_aNull(data[i].ig_pk)){row.attr("data-id",data[i].ig_pk)}}dataLinkFn(row,i,this._virtualColumnCount);if(i===data.length-1){break}}this._updateVirtualScrollContainer();this._trigger("virtualdombuilt",null,{rows:this.element.children("tbody").children("tr")})},_adjustVirtualHeights:function(){var c=this._vdisplaycontainer(),tbody=c.find("tbody"),h=tbody.children().first().height();if(this.options.height===null){return}if(this.options.avgRowHeight!==h){this.options.avgRowHeight=h;this._buildVirtualDom()}},_verticalScroller:function(){if(!this._verticalScrollerObj||this._verticalScrollerObj.length===0){this._verticalScrollerObj=this._scrollContainer().children().first()}return this._verticalScrollerObj},_hscrollbar:function(){return this.container().find("#"+this.id()+"_hscroller_container")},_hscrollbarcontent:function(){return this.container().find("#"+this.id()+"_hscroller")},_hscrollbarinner:function(){return this.container().find("#"+this.id()+"_hscroller_inner")},_avgColumnWidth:function(){var width=0,cols=this.options.columns,count=cols.length,def=this.options.defaultColumnWidth,i;if(this.options.avgColumnWidth!==null){return parseInt(this.options.avgColumnWidth,10)}for(i=0;i<count;i++){width+=parseInt(cols[i].width,10)}if((count===0||isNaN(width))&&def){return parseInt(def,10)}if(count>0&&this.options.autoGenerateColumns&&isNaN(width)){if(this.options.width===null||this.options.width===undefined){throw new Error($.ig.DataSourceLocale.locale.columnVirtualizationRequiresWidth)}return parseInt(this.options.width,10)/count}if(width===0||width<def){return def}return width/count},_scrollData:function(){var scroller=this._hscrollbarcontent(),scrollContainer;if(this.options.virtualization===true||this.options.rowVirtualization===true){scrollContainer=this._vdisplaycontainer()}else{scrollContainer=this.scrollContainer()}scrollContainer.scrollLeft(scroller.scrollLeft())},_scrollHeader:function(){var scroller=this._hscrollbarcontent(),headers=this.headersTable().parent();headers.scrollLeft(scroller.scrollLeft())},_scrollFooter:function(){var scroller=this._hscrollbarcontent(),footers=this._fixedfooters();footers.scrollLeft(scroller.scrollLeft())},_renderCaption:function(){var colgroup,caption;if(this.options.caption!==null){if(this.container().find(".ui-iggrid-headercaption").length>0){return}if(this.options.fixedHeaders===true&&this.options.showHeader===true){colgroup=this.headersTable().children("colgroup").first();if(colgroup.length===0){caption=$("<caption></caption>").prependTo(this.headersTable())}else{caption=$("<caption></caption>").insertAfter(colgroup)}caption.text(this.options.caption).attr("id",this.id()+"_caption").addClass(this.css.gridHeaderCaptionClass)}else{caption=$("<caption></caption>").appendTo($("<table></table>").prependTo(this.container()).css("width","100%").addClass(this.css.captionTable)).text(this.options.caption).attr("id",this.id()+"_caption").addClass(this.css.gridHeaderCaptionClass)}caption.parent().css("margin",0)}},_renderFixedCaption:function(){var colgroup,caption;if(this.options.caption!==null){if(this.options.fixedHeaders===true&&this.options.showHeader===true){colgroup=this.fixedHeadersTable().children("colgroup").first();if(colgroup.length===0){caption=$("<caption></caption>").prependTo(this.fixedHeadersTable())}else{caption=$("<caption></caption>").insertAfter(colgroup)}caption.text(this.options.caption).attr("id",this.id()+"_caption_fixed").addClass(this.css.gridHeaderCaptionClass)}caption.parent().css("margin",0)}},_createHeaderColumnMarkup:function(column,index){var headerClass=this.css.headerClass,ar=this.options.accessibilityRendering,headerText=$("<span>"+column.headerText+"</span>").addClass(this.css.headerTextClass),markup="<th></th>",headerCell;if(ar){headerCell=$(markup).append(headerText).attr("id",this.id()+"_"+column.key).attr("role","rowheader").addClass(headerClass).data("columnIndex",index)}else{headerCell=$(markup).append(headerText).attr("id",this.id()+"_"+column.key).addClass(headerClass).data("columnIndex",index)}return headerCell},_updateHeaderColumnIndexes:function(){var grid=this,cols=this.options.columns;if(this.options.virtualization===true&&this.options.virtualizationMode==="fixed"||this.options.columnVirtualization===true){cols=cols.slice(0,this._maxVirtualColumnCount)}grid._initialHiddenCells=[];$(cols).each(function(i){grid.container().find("#"+grid.id()+"_"+this.key).data("columnIndex",i)})},_renderHeaderColumns:function(header){var grid=this,cols=this.options.columns;if(this.options.virtualization===true&&this.options.virtualizationMode==="fixed"||this.options.columnVirtualization===true){cols=cols.slice(0,this._maxVirtualColumnCount)}grid._initialHiddenCells=[];$(cols).each(function(i){var headerCell,key=this.key;if(key){headerCell=grid._createHeaderColumnMarkup(this,i);header.append(headerCell);grid._trigger(grid.events.headerCellRendered,null,{owner:grid,th:headerCell,columnKey:this.key});$.each(grid._initialHiddenColumns,function(){if(this.key===key){grid._initialHiddenCells.push(headerCell);headerCell.css("display","none");return false}})}})},renderMultiColumnHeader:function(cols){var topmostGrid,layout;this._origSum=0;this.options.columns=cols;this.destroy(true);this._initialized=false;this.options.requiresDataBinding=true;this._renderHeaderCalled=false;if(this._isHierarchicalGrid){topmostGrid=this.element.closest(".ui-iggrid-root").data("igHierarchicalGrid");if(topmostGrid){if(topmostGrid.element[0].id!==this.element[0].id&&this.options.key){layout=topmostGrid._findLayout(topmostGrid.options.columnLayouts,this.options.key);layout.columns=cols;topmostGrid._setOption("columnLayouts",topmostGrid.options.columnLayouts);topmostGrid._create();return}topmostGrid._regevents(topmostGrid.element,topmostGrid)}}this._create()},_renderHeader:function(){var header,id,headerDom,headerMarkup="",scrollc=this.scrollContainer(),noCancel=true,headerParent=this.element[0],width,headerScrollDiv,existingHeader,o=this.options,v=o.virtualization===true||o.rowVirtualization===true||o.columnVirtualization===true;this._renderHeaderCalled=true;if(this.options.showHeader){noCancel=this._trigger(this.events.headerRendering,null,{owner:this});if(noCancel){id=this.id();headerMarkup="<thead><tr data-header-row></tr></thead>";headerParent=this.container();width=scrollc.css("width");if(this.options.showHeader&&this.options.fixedHeaders&&this.options.height!==null){if(v===false){if(headerParent.length===0){scrollc.removeClass(this.css.gridClasses).removeClass(this.css.baseClasses).css("width","").wrap("<div id='"+id+"_container'></div>");headerParent=this.container().addClass(this.css.baseClasses).addClass(this.css.gridClasses).css("width",width);this._isWrapped=true}}else{width=this.element.parents(".ui-widget").css("width");headerParent=this.container().find("#"+id+"_headers_v").css("width",width);if(this.options.expandColWidth&&!this.options.width){headerParent.css("width",parseInt(width,10)+this.options.expandColWidth+"px")}if(o.width!==null){headerParent.css("width",o.width).css("max-width",o.width).css("overflow-x","hidden")}}headerParent=$("<table id='"+id+"_headers'></table>").prependTo(headerParent).addClass(this.css.gridHeaderTableClass).attr("cellpadding",0).attr("cellspacing",0).attr("border","0");if(v===false){headerScrollDiv=$("<div></div>").prependTo(headerParent.parent());headerScrollDiv.css("overflow","hidden").css("position","relative").css("white-space","nowrap");headerScrollDiv.addClass("ui-widget-header ui-helper-reset");headerScrollDiv.append(headerParent)}else if(this.options.rowVirtualization===true){headerParent.addClass("ui-widget-header ui-helper-reset")}this._hscrollbarcontent().bind("scroll",$.proxy(this._scrollHeader,this));this._renderColgroup(headerParent,true,false,this.options.autofitLastColumn)}else if(this.options.fixedHeaders!==true&&this.options.showHeader){headerParent=this.element}if(this.options.width===null&&this.options.height===null){headerParent=this.element}if(this.options.width!==null&&this.options.height===null){this._fixScrollY=1;scrollc.css("overflow-y","hidden").css("overflow-x","auto");headerParent=this.element}if(this._isMultiColumnGrid===true){this._headerParent=headerParent;this._fireInternalEvent("_renderingMultiColumnHeader");if(this.options.virtualization===true||this.options.rowVirtualization===true){this.container().find("#"+id+"_headers_v").css("position","relative").addClass("ui-widget-header ui-helper-reset").addClass(this.css.baseClasses);headerParent.addClass(this.css.gridHeaderTableClass).attr("cellpadding",0).attr("cellspacing",0).attr("border","0")}}else{if(this.options.showHeader){if(this.options.headerTemplate===null||this.options.headerTemplate===undefined){if(this.options.virtualization===true||this.options.rowVirtualization===true){this.container().find("#"+id+"_headers_v").css("position","relative").addClass("ui-widget-header ui-helper-reset").addClass(this.css.baseClasses);headerParent.addClass(this.css.gridHeaderTableClass).attr("cellpadding",0).attr("cellspacing",0).attr("border","0")
}this.element.find(">thead").remove();existingHeader=headerParent.find(">thead");if(existingHeader.length===0){header=$(headerMarkup).appendTo(headerParent).children().first()}else{existingHeader.empty();header=$("<tr data-header-row></tr>").appendTo(existingHeader)}this._renderHeaderColumns(header)}else{headerDom=this.options.headerTemplate;if(this.options.virtualization===true||this.options.rowVirtualization===true){$(headerDom).children().each(function(){this.appendTo(this.container().find("#"+id+"_headers"))});header=this.headersTable().addClass(this.css.gridClasses)}else{header=$(headerMarkup).appendTo(headerParent).append(headerDom)}}}this._headerParent=headerParent;this._trigger(this.events.headerRendered,null,{owner:this,table:this.headersTable()});this._headerRenderCancel=false}}else{this._headerRenderCancel=true}}this._trigger("headerRenderedInternal",null,{owner:this,table:this.headersTable()})},_renderFooter:function(){var gridId=this.id(),o=this.options,elemParent,footerId=gridId+"_footer_container",footerMarkup='<tfoot class="'+this.css.gridFooterClass+'"></tfoot>',$footer=this.container().find("#"+footerId),$table,width,noCancel,tableGrid=this.element,$tableGridContainer;if(tableGrid.length===0){return}if($footer.length===0&&o.showFooter){noCancel=this._trigger(this.events.footerRendering,null,{owner:this});if(noCancel){if((o.virtualization===true||o.rowVirtualization===true||o.columnVirtualization===true)&&(o.height!==null&&o.height!==undefined||o.width!==null&&o.width!==undefined)){$tableGridContainer=this._vdisplaycontainer();this.options.fixedFooters=true;$tableGridContainer=$('<tr><td colspan="2" style="border-width: 0px;"></td></tr>').insertAfter($tableGridContainer.closest("tr"));$footer=$("<div></div>").attr("id",footerId).css({overflow:"hidden",position:"relative"}).addClass("ui-widget-footer").addClass(this.css.footerContainer).width(this.options.width).appendTo($tableGridContainer.find("td"));$table=$("<table></table>").attr("cellpadding",0).attr("cellspacing",0).attr("border",0).appendTo($footer).addClass(this.css.gridFooterTableClass).attr("id",gridId+"_footers");$table.width(o.width);this._renderColgroup($table,false,true,this.options.autofitLastColumn);$(footerMarkup).appendTo($table);if(this.options.showFooter&&this.options.fixedFooters===true&&this.options.height!==null){elemParent=this.element.parents(".ui-widget:first");if(elemParent.length===1&&elemParent[0].style){width=elemParent[0].style.width;if(width){$footer.css("width",width)}}}if(o.expandColWidth&&!o.width){$footer.css("width",parseInt($footer.width(),10)+o.expandColWidth+"px")}this._hscrollbarcontent().bind("scroll",$.proxy(this._scrollFooter,this))}else if(o.fixedFooters===true&&o.height!==null){if(o.width!==null){$tableGridContainer=this._hscrollbar()}else{$tableGridContainer=this.scrollContainer()}if($tableGridContainer.length===0){$tableGridContainer=tableGrid}$footer=$("<div></div>").attr("id",footerId).css({overflow:"hidden",position:"relative","white-space":"nowrap"}).addClass(this.css.footerContainer).addClass("ui-widget-footer").insertAfter($tableGridContainer);$table=$("<table></table>").attr("cellpadding",0).attr("cellspacing",0).attr("border",0).appendTo($footer).addClass(this.css.gridFooterTableClass).attr("id",gridId+"_footers");this._renderColgroup($table,false,true,this.options.autofitLastColumn);$(footerMarkup).appendTo($table);if(o.virtualization!==true&&o.rowVirtualization!==true&&o.columnVirtualization!==true){this._hscrollbarcontent().bind("scroll",$.proxy(this._scrollFooter,this))}}else{$tableGridContainer=tableGrid;$footer=$(footerMarkup).attr("id",footerId).insertBefore($tableGridContainer.find("tbody:eq(0)"))}$footer.css("display","none");this._footer=$footer;this._footerParent=$table;this._trigger(this.events.footerRendered,null,{owner:this,table:this.footersTable()})}}return $footer},_renderRecord:function(data,rowIndex){var i,key=this.options.primaryKey,ar=this.options.accessibilityRendering,grid=this,dstr="",cols=this.options.columns,noVisibleColumns;dstr+="<tr";if(rowIndex%2!==0&&this.options.alternateRowStyles){dstr+=' class="'+grid.css.recordAltClass+'"'}if(!_aNull(key)){dstr+=' data-id="'+this._kval_from_key(key,data)+'"'}else if(!_aNull(data.ig_pk)){dstr+=' data-id="'+data.ig_pk+'"'}if(this.options.virtualization&&this.options.virtualizationMode==="continuous"){dstr+=' data-row-idx="'+rowIndex+'"'}if(ar){dstr+=' role="row">'}else{dstr+=">"}if(cols.length>0){noVisibleColumns=true;$(cols).each(function(colIndex){if(cols[colIndex].hidden||cols[colIndex].fixed===true){return}noVisibleColumns=false;if(ar){dstr+='<td role="gridcell" aria-describedby="'+this.key+'"'}else{dstr+="<td"}if(data[this.key]===undefined){if(grid.options.rowTemplate&&grid.options.rowTemplate.length>0){dstr+=" ";dstr+=grid._renderTemplatedCell(data,this)}else{dstr+=">";dstr+=grid._renderCell(data[colIndex],this,data)}dstr+="</td>"}else{if(grid.options.rowTemplate&&grid.options.rowTemplate.length>0){dstr+=" ";dstr+=grid._renderTemplatedCell(data,this)}else{dstr+=">";dstr+=grid._renderCell(data[this.key],this,data)}dstr+="</td>"}});if(noVisibleColumns){dstr+='<td role="gridcell"></td>'}}else{if($.type(data)==="array"){for(i=0;i<data.length;i++){if(ar){dstr+='<td role="gridcell">'+data[i]+"</td>"}else{dstr+="<td>";dstr+=data[i];dstr+="</td>"}}}else{for(key in data){if(data.hasOwnProperty(key)){if(ar){dstr+='<td role="gridcell" aria-describedby="'+key+'">'+data[key]+"</td>"}else{dstr+="<td>";dstr+=data[key];dstr+="</td>"}}}}}dstr+="</tr>";return dstr},_enableHeaderCellFeature:function(th){var $th;if($.type(th)==="string"){$th=this.container().find("#"+this.id()+"_"+th)}else{$th=th}$th.addClass(this.css.headerCellFeatureEnabledClass)},_renderRecordInArray:function(darr,tbody,data,rowIndex){var i,key=this.options.primaryKey,ar=this.options.accessibilityRendering,grid=this,appendBehavior=false,cols=this.options.columns;if(darr===null){darr=[];appendBehavior=true}darr.push("<tr");if(rowIndex%2!==0&&this.options.alternateRowStyles){darr.push(' class="'+grid.css.recordAltClass+'"')}if(!_aNull(key)){darr.push(' data-id="'+this._kval_from_key(key,data)+'"')}else if(!_aNull(data.ig_pk)){darr.push(' data-id="'+data.ig_pk+'"')}if(ar){darr.push(' role="row">')}else{darr.push(">")}if(cols.length>0){$(cols).each(function(colIndex){if(cols[colIndex].hidden){return}if(ar){darr.push('<td role="gridcell" aria-describedby="'+this.key+'"')}else{darr.push("<td")}if(data[this.key]===undefined){if(grid.options.rowTemplate&&grid.options.rowTemplate.length>0){darr.push(" ");darr.push(grid._renderTemplatedCell(data,this))}else{darr.push(">");darr.push(grid._renderCell(data[colIndex],this,data))}darr.push("</td>")}else{if(grid.options.rowTemplate&&grid.options.rowTemplate.length>0){darr.push(" ");darr.push(grid._renderTemplatedCell(data,this))}else{darr.push(">");darr.push(grid._renderCell(data[this.key],this,data))}darr.push("</td>")}})}else{if($.type(data)==="array"){for(i=0;i<data.length;i++){if(ar){darr.push('<td role="gridcell">'+data[i]+"</td>")}else{darr.push("<td>");darr.push(data[i]);darr.push("</td>")}}}else{for(key in data){if(data.hasOwnProperty(key)){if(ar){darr.push('<td role="gridcell" aria-describedby="'+key+'">'+data[key]+"</td>")}else{darr.push("<td>");darr.push(data[key]);darr.push("</td>")}}}}}darr.push("</tr>");if(appendBehavior){tbody.append(darr.join(""))}},_fixDate:function(val,col){var d,i;if(!col||!val){return val}if(col.dataType==="date"&&!val.getTime){i=val.indexOf?val.indexOf("ate("):-1;if(i>0){d=val.substring(i+4);i=d.indexOf(")");if(i>0){d=parseInt(d.substring(0,i),10);if(!isNaN(d)){val=new Date(d)}}}}return val},_renderCell:function(val,col,record,displayStyle,returnObject){var type=col.dataType,format=col.format,o=this.options,auto=o.autoFormat;val=this._fixDate(val,col);if(col.formatter){return col.formatter(val,record)}if(!format&&type==="bool"&&o.renderCheckboxes){format="checkbox"}if(format==="checkbox"&&type!=="bool"){format=null}type=type==="date"||type==="number"?type:"";if(format||(auto===true||auto==="dateandnumber")&&type||auto&&auto===type){return $.ig.formatter(val,type,format,true,o.enableUTCDates,displayStyle)}if(returnObject){return val}return val||val===0||val===false?val.toString():"&nbsp;"},_renderTemplatedCell:function(val,col){var v,d=$.extend(true,{},val);if(val===undefined||val===null||val[col.key]===undefined){if(col.unbound===true){v="&nbsp;"}else{v=this._renderCell(val,col,val,null,true)}}else{v=this._renderCell(val[col.key],col,val,null,true)}if(this._tmap===null){this._initializeTmap()}d[col.key]=v;return this._tmplWrappers[this.id()+"_"+col.key](d,this._tmap[col.key])},_initializeTmap:function(){var tmpl=this.options.rowTemplate,i,cols=this.options.columns,tds,key,templatePart,tmplFunc,jsrnd=String(this.options.templatingEngine).toLowerCase()==="jsrender";this._tmap=[];if(this.options.rowTemplate===null||this.options.rowTemplate===undefined||this.options.rowTemplate===""){throw new Error($.ig.Grid.locale.templatingEnabledButNoTemplate)}tmpl=tmpl.replace("<tr>","").replace("</tr>","");tds=$.trim(tmpl).split("</td>");this._tmplWrappers=jsrnd?$.render:{};tmplFunc=this._defaultTemplateFunc;for(i=0;i<cols.length;i++){templatePart=$.trim(tds[i].replace("<td",""));key=this.id()+"_"+cols[i].key;if(jsrnd){$.templates(key,templatePart)}else{this._tmplWrappers[key]=tmplFunc}this._tmap[cols[i].key]=templatePart}},_defaultTemplateFunc:function(d,tmpl){return $.ig.tmpl(tmpl,d)},_scrollbarWidth:function(){if(!this._scrollbarWidthResolved){var $div=$('<div id="'+this.id()+'_tmp"></div>').css({width:50,height:50,position:"absolute",top:-500,left:-500}).prependTo("body").append("<div></div>").find("div").css({height:100}),w1,w2;if(document.documentMode===7||$.ig.util.isIE7){w1=$div.innerWidth();$div.parent().css("overflow-y","scroll");w2=$div.innerWidth();this._scrollbarWidthResolved=w1-w2}else{$div.parent().css({overflow:"auto"});$div.css({width:"100%"});this._scrollbarWidthResolved=50-$div.width()}$("#"+this.id()+"_tmp").remove()}return this._scrollbarWidthResolved},_fireInternalEvent:function(name,args){var i,f,featureName,feature;for(i=0;i<this.options.features.length;i++){f=this.options.features[i];if(f!==undefined&&f!==null&&f.name!==undefined){featureName="igGrid"+f.name;feature=this.element.data(featureName);if(feature!==null&&feature!==undefined&&feature[name]){if(args){feature[name](args)}else{feature[name]()}}}}},_initFeature:function(featureObject,dataOptions,destroy){if(!featureObject){return}if(featureObject.name===undefined){return}var widget="igGrid"+featureObject.name;if($.type(this.element[widget])!=="function"){throw new Error($.ig.Grid.locale.noSuchWidget+" "+widget)}if(this.element.data(widget)){this.element[widget]("destroy")}this.element[widget](featureObject);this.element.data(widget)._injectGrid(this)},_initFeatureSettings:function(featureObject){if(!featureObject){return}if(featureObject.name===undefined){return}var widget="igGrid"+featureObject.name;if($.type(this.element[widget])!=="function"){throw new Error($.ig.Grid.locale.noSuchWidget+" "+widget)}if(this.element.data(widget)){this.element.data(widget)._injectGrid(this,true)}},_onFeaturesSoftDirty:function(e,args){var i,feature;if(args.owner.options.type!=="remote"){return}for(i=0;i<this.options.features.length;i++){feature=this.element.data("igGrid"+this.options.features[i].name);if(feature&&feature!==args.owner&&feature.options&&feature.options.type==="local"){if(feature._onUIDirty&&$.type(feature._onUIDirty)==="function"){feature._onUIDirty(e,args)}}}},_kval_from_key:function(key,data){var k,k_val="",i;if(key.indexOf(",")!==-1){k=key.split(",");for(i=0;i<k.length;i++){k_val+=data[k[i]];if(i<k.length-1){k_val+=","}}}else{k_val=data[key]}return k_val},_rowId:function(rec,index){var key=this.options.primaryKey;key=key?this._kval_from_key(key,rec):null;if(!key){key=index;if(key!==0){key=this.rows().length-1}}return key},_inferOpType:function(){if(this.options.dataSourceUrl||this.dataSource.type()==="remoteUrl"){return"remote"}return"local"},_renderVirtualRecords:function(){this._trigger("virtualrendering");var mode=this.options.virtualizationMode;if(mode===undefined||mode===""){mode="continuous"}if(mode==="fixed"||this.options.columnVirtualization===true){this._renderVirtualRecordsFixed()}else if(mode==="continuous"){this._renderVirtualRecordsContinuous();this._trigger("virtualrecordsrender",null,{owner:this,dom:this._virtualDom})}},_getHScrollContainerInner:function(){var ret=this._hscrollbarinner();if(ret.length===0&&this.options.virtualizationMode==="continuous"){ret=this.container().find("#"+this.id()+"_horizontalScrollContainer div")}return ret},_getScrollContainerHeight:function(){return this._scrollContainer().children(":first-child").height()},_getDisplayContainerHeight:function(){return this._vdisplaycontainer().height()},_getDisplayContainerWidth:function(){return this._vdisplaycontainer().width()},_setDisplayContainerWidth:function(width){if(width===undefined){return}this._vdisplaycontainer().css("max-width",width);this._vdisplaycontainer().width(width)},_getVHeadersWidth:function(){return this.container().find("#"+this.id()+"_headers_v").width()},_setVHeadersWidth:function(width){if(width===undefined){return}this.container().find("#"+this.id()+"_headers_v").width(width)},_setScrollContainerHeight:function(height){var sc=this._scrollContainer(),self=this,isFixedVirtualization=this.options.virtualizationMode==="fixed";if(height===undefined){return}sc.children(":first-child").height(height);if($.ig.util.isIE){if(isFixedVirtualization&&!this._calledScroll){this._calledScroll=0}sc.scrollTop(sc.scrollTop()+2);sc.scrollTop(sc.scrollTop()-2);if(isFixedVirtualization){setTimeout(function(){self._calledScroll=0},1)}}},_setScrollContainerScrollTop:function(top){if(top===undefined){return}this._scrollContainer().scrollTop(top)},_getScrollContainerScrollTop:function(){return this._scrollContainer().scrollTop()},_setDisplayContainerScrollTop:function(top){if(top===undefined){return}this._vdisplaycontainer().scrollTop(top)},_getDisplayContainerScrollTop:function(){return this._vdisplaycontainer().scrollTop()},_setDisplayContainerScrollLeft:function(left){if(left===undefined){return}this._vdisplaycontainer().scrollLeft(left)},_getDisplayContainerScrollLeft:function(){return this._vdisplaycontainer().scrollLeft()},_calculateAvgRowHeight:function(){var rowHeightSum=this.container().find("#"+this.id()+" > tbody").height();if(rowHeightSum===0){rowHeightSum=parseInt(this.options.height,10)}if(this.options.virtualizationMode==="fixed"){if(this._fixedAvgRowHeight){return this._fixedAvgRowHeight}this._fixedAvgRowHeight=rowHeightSum/this._virtualRowCount}return rowHeightSum/this._virtualRowCount},_getDisplayContainerVisibleArea:function(){var scrollTop=this._getDisplayContainerScrollTop(),height=this._getDisplayContainerHeight();return{top:scrollTop,bottom:scrollTop+height}},virtualScrollTo:function(scrollerPosition){var avgRowHeight,$scrollContainer=this._scrollContainer(),pos=parseInt(scrollerPosition,10);if($.type(scrollerPosition)!=="string"){if(this._avgRowHeight){avgRowHeight=this._avgRowHeight}else{avgRowHeight=this._calculateAvgRowHeight()}scrollerPosition--;pos=avgRowHeight*scrollerPosition;pos=Math.ceil(pos)}$scrollContainer.scrollTop(pos)},_virtualScrollToInternal:function(virtualScrollerY){var tableId,firstRow,lastRow,scrollData,scrollResult;if(virtualScrollerY===this._oldScrollTop){return}tableId="#"+this.id();firstRow=this.container().find(tableId+" > tbody > tr:first");lastRow=this.container().find(tableId+" > tbody > tr:last");if(firstRow.length===0||lastRow.length===0){return}scrollData={virtualScrollerY:this._getScrollContainerScrollTop(),deltaScroll:virtualScrollerY-this._oldScrollTop,firstRow:firstRow,lastRow:lastRow,firstRowDataIndex:parseInt(firstRow.attr("data-row-idx"),0),lastRowDataIndex:parseInt(lastRow.attr("data-row-idx"),0),visibleArea:this._getDisplayContainerVisibleArea()};scrollResult={action:"SA_INITIAL"};if(!this._tryScroll(scrollData,scrollResult)){this._rebuildVirtualRows(scrollData,scrollResult)}this._correctScrollPosition(this._getTotalRowsCount())},_getTotalRowsCount:function(){return this.dataSource.dataView().length},_tryScroll:function(scrollData,scrollResult){var deltaScroll,firstRow,lastRow,displayContainerHeight,displayContainerScrollTop;if(scrollResult===undefined){throw new Error("scrollResult parameter should be provided")}deltaScroll=scrollData.deltaScroll;firstRow=scrollData.firstRow;lastRow=scrollData.lastRow;displayContainerHeight=this._getDisplayContainerHeight();displayContainerScrollTop=this._getDisplayContainerScrollTop();if(deltaScroll>0){if(lastRow[0].offsetTop+lastRow.outerHeight()>=displayContainerScrollTop+deltaScroll+displayContainerHeight||isNaN(scrollData.lastRowDataIndex)||scrollData.lastRowDataIndex===this.dataSource.dataView().length-1){this._setDisplayContainerScrollTop(displayContainerScrollTop+deltaScroll);scrollResult.action="SA_SUCCESSFUL";return true}if(deltaScroll<=this._avgRowHeight*this._virtualRowCount){scrollResult.action="SA_NEED_NEXT_PAGE";return false}}if(deltaScroll<0){if(firstRow[0].offsetTop<=displayContainerScrollTop+deltaScroll||scrollData.firstRowDataIndex===0){this._setDisplayContainerScrollTop(displayContainerScrollTop+deltaScroll);scrollResult.action="SA_SUCCESSFUL";return true}if(Math.abs(deltaScroll)<=this._avgRowHeight*this._virtualRowCount){scrollResult.action="SA_NEED_PREV_PAGE";return false}}scrollResult.action="SA_NEED_SOME_PAGE";return false},_rebuildVirtualRows:function(scrollData,scrollResult){var noCancel,virtualScrollerY,deltaScroll,tableId,visibleArea,tbody,expandedRowsHeight,trs,i,scrollerHeight,firstVisibleTR,firstVisibleTRRelativeOffset,startIndexToBeLoaded,newFirstVisibleRow,displayContainerScrollTop,maxScrollPos,avgRowHeight,tr,lastVisibleTR,lastVisibleTRIndex,firstVisibleTRIndex,endIndexToBeLoaded,dataRowIndexToBeFirst,hasOverflow;noCancel=this._trigger("rebuildingvirtualrows",null,{owner:this,scrollData:scrollData,scrollResult:scrollResult});if(noCancel===false){return}virtualScrollerY=scrollData.virtualScrollerY;deltaScroll=scrollData.deltaScroll;tableId="#"+this.id();visibleArea=scrollData.visibleArea;tbody=this.container().find(tableId+" > tbody");expandedRowsHeight=0;trs=this.container().find(tableId+" > tbody > tr[data-container='true']");for(i=0;i<trs.length;i++){expandedRowsHeight+=$(trs[i]).outerHeight()}if(expandedRowsHeight>0){scrollerHeight=this._getScrollContainerHeight();this._setScrollContainerHeight(scrollerHeight-expandedRowsHeight)}if(deltaScroll>0&&scrollResult.action==="SA_NEED_NEXT_PAGE"){firstVisibleTR=this._getFirstVisibleTR(visibleArea);firstVisibleTRRelativeOffset=Math.abs(firstVisibleTR[0].offsetTop-visibleArea.top);startIndexToBeLoaded=parseInt(firstVisibleTR.attr("data-row-idx"),0);dataRowIndexToBeFirst=startIndexToBeLoaded;endIndexToBeLoaded=parseInt(this._virtualRowCount,0)+startIndexToBeLoaded-1;hasOverflow=false;if(endIndexToBeLoaded>this.dataSource.dataView().length-1){endIndexToBeLoaded=this.dataSource.dataView().length-1;startIndexToBeLoaded=endIndexToBeLoaded-this._virtualRowCount+1;hasOverflow=true}tbody.empty();this._renderRecords(startIndexToBeLoaded,endIndexToBeLoaded);if(hasOverflow){tr=this.container().find(tableId+" > tbody > tr[data-row-idx='"+dataRowIndexToBeFirst+"']");firstVisibleTRRelativeOffset=tr[0].offsetTop+firstVisibleTRRelativeOffset}this._setDisplayContainerScrollTop(firstVisibleTRRelativeOffset+deltaScroll)}if(deltaScroll<0&&scrollResult.action==="SA_NEED_PREV_PAGE"){lastVisibleTR=this._getLastVisibleTR(visibleArea);lastVisibleTRIndex=parseInt(lastVisibleTR.attr("data-row-idx"),0);firstVisibleTR=this._getFirstVisibleTR(visibleArea);firstVisibleTRIndex=parseInt(firstVisibleTR.attr("data-row-idx"),0);endIndexToBeLoaded=lastVisibleTRIndex;startIndexToBeLoaded=endIndexToBeLoaded-parseInt(this._virtualRowCount,0)+1;if(startIndexToBeLoaded<0){startIndexToBeLoaded=0;endIndexToBeLoaded=startIndexToBeLoaded+this._virtualRowCount-1}tbody.empty();this._renderRecords(startIndexToBeLoaded,endIndexToBeLoaded);tableId="#"+this.id();newFirstVisibleRow=this.container().find(tableId+' > tbody > tr[data-row-idx="'+firstVisibleTRIndex+'"]');this._setDisplayContainerScrollTop(newFirstVisibleRow[0].offsetTop+deltaScroll)}if(scrollResult.action==="SA_NEED_SOME_PAGE"){startIndexToBeLoaded=Math.floor(virtualScrollerY/this._avgRowHeight);endIndexToBeLoaded=startIndexToBeLoaded+this._virtualRowCount-1;if(startIndexToBeLoaded<0){startIndexToBeLoaded=0;endIndexToBeLoaded=startIndexToBeLoaded+this._virtualRowCount-1}if(endIndexToBeLoaded>=this.dataSource.dataView().length-1){endIndexToBeLoaded=this.dataSource.dataView().length-1;startIndexToBeLoaded=endIndexToBeLoaded-this._virtualRowCount+1}tbody.empty();this._renderRecords(startIndexToBeLoaded,endIndexToBeLoaded);displayContainerScrollTop=0;maxScrollPos=this._getScrollContainerHeight()-this._getDisplayContainerHeight();if(maxScrollPos-3<=virtualScrollerY&&virtualScrollerY<=maxScrollPos+3){displayContainerScrollTop=1e4}this._setDisplayContainerScrollTop(displayContainerScrollTop)}avgRowHeight=this._calculateAvgRowHeight();if(avgRowHeight>this._avgRowHeight){this._avgRowHeight=avgRowHeight}this._startRowIndex=startIndexToBeLoaded;this._startColIndex=0;this._trigger("virtualrecordsrender",null,{owner:this,tbody:tbody,dom:this._virtualDom})},_correctScrollPosition:function(totalRowCount){var scrollTop,maxScrollPos,tableId,firstRow,firstRowDataIndex,lastRow,lastRowDataIndex,visibleArea,tbody,rowsLeft,displayContainerScrollTop;scrollTop=this._getScrollContainerScrollTop();maxScrollPos=this._getScrollContainerHeight()-this._getDisplayContainerHeight();tableId="#"+this.id();firstRow=this.container().find(tableId+" > tbody > tr:first");firstRowDataIndex=parseInt(firstRow.attr("data-row-idx"),0);lastRow=this.container().find(tableId+" > tbody > tr:last");lastRowDataIndex=parseInt(lastRow.attr("data-row-idx"),0);visibleArea=this._getDisplayContainerVisibleArea();tbody=this.container().find(tableId+" > tbody");if(scrollTop===0){if(visibleArea.top>0){this._scrollTo(visibleArea.top,true)}else if(firstRowDataIndex>0){this._scrollTo(firstRowDataIndex*this._avgRowHeight,true)}}else if(scrollTop>=maxScrollPos-3&&scrollTop<=maxScrollPos+3){if(visibleArea.bottom<tbody.height()&&lastRowDataIndex===totalRowCount-1){this._scrollTo(this._getScrollContainerScrollTop()-(tbody.height()-visibleArea.bottom),true)}else if(lastRowDataIndex<totalRowCount-1){rowsLeft=totalRowCount-lastRowDataIndex;this._setScrollContainerHeight(this._getScrollContainerHeight()+rowsLeft*this._avgRowHeight)}}displayContainerScrollTop=this._getDisplayContainerScrollTop();if(displayContainerScrollTop===0&&firstRowDataIndex===0&&this._getScrollContainerScrollTop()!==0){this._scrollTo(0,true)}if(displayContainerScrollTop===tbody.height()-this._getDisplayContainerHeight()&&lastRowDataIndex===totalRowCount-1){this._scrollTo(this._getScrollContainerHeight(),true)}},_scrollTo:function(scrollTop,suppressScrollEvent){if(suppressScrollEvent){this._suppressScroll=true}this._setScrollContainerScrollTop(scrollTop)},_getFirstVisibleTR:function(visibleArea){var tableId="#"+this.element[0].id,firstVisibleTR,visibleAreaTop=visibleArea.top;$(tableId+" > tbody > tr:visible").each(function(index){firstVisibleTR=$(this);if(this.offsetTop+firstVisibleTR.height()>visibleAreaTop){return false}});return firstVisibleTR},_getLastVisibleTR:function(visibleArea){var tableId="#"+this.id(),lastVisibleTR;lastVisibleTR=this.container().find(tableId+" > tbody > tr:visible").filter(function(index){return this.offsetTop<visibleArea.bottom}).last();return lastVisibleTR},_determineVirtualRowCount:function(){var div,rowNumber=10,ds,rows="",i,height,avgRowHeight,displayContainerHeight,rowsPerPage,result;ds=this.dataSource.dataView();if(rowNumber>ds.length){rowNumber=ds.length}div=$("<div></div>)").appendTo("body").css({position:"absolute",top:-1800,left:-1800,visibility:"hidden"});for(i=0;i<rowNumber;i++){rows+=this._renderRecord(ds[i],i)}div.html(rows);height=div.height();avgRowHeight=height/rowNumber;displayContainerHeight=this._getDisplayContainerHeight();rowsPerPage=displayContainerHeight/avgRowHeight;result=Math.ceil(rowsPerPage*3);div.remove();return result},_getTotalRowCount:function(){return this.dataSource.dataView().length},_renderVirtualRecordsContinuous:function(){this._totalRowCount=this._getTotalRowCount();if(this._totalRowCount===0){this._setScrollContainerHeight(0);this._virtualDom=[];return}this._virtualRowCount=this._determineVirtualRowCount();if(this._virtualRowCount>this._totalRowCount){this._virtualRowCount=this._totalRowCount}this._scrollTo(0,true);this._renderRecords(this._virtualRowCount-1);this._avgRowHeight=this._calculateAvgRowHeight();this._setScrollContainerHeight(this._totalRowCount*this._avgRowHeight)},_rerenderVirtualRecordsContinuous:function(){var tableId="#"+this.id(),lastRow,lastRowDataIndex;lastRow=this.container().find(tableId+" > tbody > tr:last");lastRowDataIndex=parseInt(lastRow.attr("data-row-idx"),0);this._renderRecords(this._startRowIndex,lastRowDataIndex);this._trigger("virtualrecordsrender",null,{owner:this,tbody:this.element.children("tbody"),dom:this._virtualDom})},_buildVirtualDomForContinuousVirtualization:function(){var rows,cells,i,j;if(this.options.virtualization===true&&this.options.virtualizationMode==="continuous"){this._virtualDom=[];rows=this.container().find("#"+this.id()+" > tbody > tr");for(i=0;i<rows.length;i++){this._virtualDom[i]=[];cells=rows[i].children;for(j=0;j<cells.length;j++){this._virtualDom[i][j]=cells[j]}}this._updateVirtualScrollContainer()}},_isFixedElement:function($td){if(this.hasFixedColumns()&&$td.closest("div").attr("data-fixed-container")!==undefined){return true}return false},_getColumnByTD:function($td){var i,ind=0,isFixed,$tr=$td.closest("tr"),res={},visibleInd,visibleColumns;if($tr.length===0){return null}if($td.attr("data-parent")||$td.attr("data-skip")){return null}visibleInd=$td.index()-$tr.find("td[data-parent='true'],td[data-skip='true']").length;if($td.is("td")){visibleInd-=$tr.find("th").length}if(visibleInd<0){return null}visibleColumns=this._visibleColumns();if(visibleColumns.length<=visibleInd){return null}if(this.hasFixedColumns()){res.index=visibleInd;isFixed=$td.closest("div").attr("data-fixed-container")!==undefined;for(i=0;i<visibleColumns.length;i++){if(isFixed&&visibleColumns[i].fixed===true||!isFixed&&visibleColumns[i].fixed!==true){if(ind++===visibleInd){res.column=visibleColumns[i];break}}}}else{res={column:visibleColumns[visibleInd],index:visibleInd}}return res},destroy:function(notToCallDestroy){var prev=this.container().prev(),i,prepend=false;if(this._scrollHeader&&this._hscrollbarcontent().length>0){this._hscrollbarcontent().unbind("scroll",$.proxy(this._scrollHeader,this))}this._headerInitCallbacks=[];this._footerInitCallbacks=[];this.tmpDataSource=null;for(i=0;i<this.options.features.length;i++){if(this.element.data("igGrid"+this.options.features[i].name)){this.element["igGrid"+this.options.features[i].name]("destroy")}}if(prev.length===0){prev=this.container().parent();prepend=true}if(prepend){prev.prepend(this.element)}else{this.element.insertAfter(prev)}this.element.unbind("click",this._cellClickHandler);delete this._cellClickHandler;this.element.find("thead").empty();this.element.find("colgroup").empty();if(notToCallDestroy!==true){$.Widget.prototype.destroy.call(this)}if(this._isWrapped&&this.container().parent().data("igGrid")){this.container().parent().removeData("igGrid");if($.ui.igGrid.prototype.widgetFullName&&$.ui.igGrid.prototype.widgetFullName!=="igGrid"&&this.container().parent().data($.ui.igGrid.prototype.widgetFullName)){this.container().parent().removeData($.ui.igGrid.prototype.widgetFullName)}}this.container().remove();this._container=null;this.element.find("tbody").empty().removeClass(this.css.gridTableBodyClass).removeClass(this.css.gridRecordClass);this.element.removeClass(this.css.gridTableClass);if(this._documentEvents){$(document).unbind(this._documentEvents)}this.element.unbind("iggriduisoftdirty",this._uiSoftDirtyHandler);this.element.trigger(this.events.destroyed,{owner:this});delete this._uiSoftDirtyHandler;if(this._resId){clearInterval(this._resId)}if(this._isWrapped){this.element.remove()}if(this._hovEvts){this.element.unbind(this._hovEvts);this._hovEvts=null}if(notToCallDestroy===true){return}if(this.dataSource){this._dataSource=null;this.dataSource=null}this._dataOptions=null;this._originalOptions=null;this._padding=null;this._originalOptions=null;this._loadingIndicator=null;this._headerParent=null;this._footerParent=null;this._footer=null;this._hovEvts=null;this._lastDataCol=null;this._lastFooterCol=null;this._lastHeaderCol=null;return this}});$.extend($.ui.igGrid,{version:"13.2.20132.2064"})})(jQuery);(function($){$(document).ready(function(){var wm=$("#__ig_wm__").length>0?$("#__ig_wm__"):$('<div id="__ig_wm__"></div>').appendTo(document.body);wm.css({position:"fixed",bottom:0,right:0,zIndex:1e3}).addClass("ui-igtrialwatermark")})})(jQuery);